<!DOCTYPE html>
<html>
<head>
    <title>Lokasi di Google Maps</title>
    <style>
        /* Mengatur ukuran map container agar peta tampil penuh */
        #map {
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
    <div id="map"></div>

    <script>
     
        const firebaseConfig = {
            apiKey: "AIzaSyAJPoqA190LutHQ7xnvnV96GTRHzz24IpI",
            authDomain: "nasukafoods1.firebaseapp.com",
            databaseURL: "https://nasukafoods1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "nasukafoods1",
            messagingSenderId: "84287800896",
            appId: "1:84287800896:web:83189d6766997b00f701a5"
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const nasukafoodsRef = database.ref('locations/nasukafoods');

        let map;
        let marker;

        // Fungsi untuk menginisialisasi peta
        function initMap(latitude, longitude) {
            const location = { lat: latitude, lng: longitude };

            // Buat peta baru jika belum ada
            if (!map) {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 15, // Tingkat zoom awal
                    center: location,
                });
            } else {
                // Perbarui posisi tengah peta jika peta sudah ada
                map.setCenter(location);
            }
            
            // Hapus marker lama jika ada
            if (marker) {
                marker.setMap(null);
            }

            // Tambahkan marker baru pada lokasi
            marker = new google.maps.Marker({
                position: location,
                map: map,
                title: 'Lokasi Terkini'
            });

            // Tambahkan event listener untuk zoom
            map.addListener("zoom_changed", () => {
                console.log("Zoom changed to: " + map.getZoom());
            });
        }

        // Mendengarkan perubahan data di Firebase secara real-time
        nasukafoodsRef.on('value', (snapshot) => {
            if (snapshot.exists()) {
                const data = snapshot.val();
                console.log('Lokasi baru diterima:', data);
                if (window.google && window.google.maps) {
                    initMap(data.latitude, data.longitude);
                } else {
                    // Jika Google Maps API belum dimuat, muat skripnya
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}`;
                    script.onload = () => {
                        initMap(data.latitude, data.longitude);
                    };
                    document.head.appendChild(script);
                }
            } else {
                console.log('Data lokasi tidak ditemukan.');
            }
        }, (error) => {
            console.error('Gagal memuat data dari Firebase:', error);
        });

    </script>

</body>
</html>
