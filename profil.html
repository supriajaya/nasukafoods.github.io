<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nasukafoods - Profil Pengguna</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; color: #333; font-size: 0.9em; }
    header { background-color: #4CAF50; color: white; padding: 1em 0; text-align: center; }
    nav { background-color: #333; color: white; padding: 0.5em 0; text-align: center; }
    nav a { color: white; margin: 0 15px; text-decoration: none; font-size: 1.1em; }
    .container { width: 80%; max-width: 800px; margin: 20px auto; padding: 30px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #4CAF50; font-size: 1.8em; margin-bottom: 30px; }
    footer { background-color: #333; color: white; text-align: center; padding: 0.8em 0; margin-top: 20px; font-size: 0.8em; }
    .profile-section { margin-bottom: 25px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; }
    .profile-info p { margin-bottom: 8px; font-size: 0.9em; }
    .profile-info p strong { display: inline-block; width: 140px; color: #555; }
    .profile-picture-display { text-align: center; margin-bottom: 20px; }
    .profile-picture-display img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 2px solid #4CAF50; }
    .edit-button {
      background-color: #007bff; color: white; padding: 10px 16px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.95em; margin: 0 auto; display: block;
    }
    .edit-button:hover { background-color: #0056b3; }

    .modal {
      display: none; position: fixed; z-index: 999; left: 0; top: 0;
      width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff; margin: 10% auto; padding: 20px; border: 1px solid #888;
      width: 90%; max-width: 500px; border-radius: 8px; position: relative;
    }
    .close { position: absolute; top: 10px; right: 15px; font-size: 22px; font-weight: bold; color: #aaa; cursor: pointer; }
    .close:hover { color: #000; }

    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; font-size: 0.9em; }
    .form-group input[type="text"], .form-group input[type="tel"], .form-group textarea {
      width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 0.9em;
    }
    .form-group input[type="file"] {
      width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background-color: #fff; cursor: pointer;
    }
    .form-group input[type="file"]::file-selector-button {
      background-color: #007bff; color: white; padding: 7px 10px; border: none; border-radius: 4px; cursor: pointer; margin-right: 8px;
    }
    .form-group input[type="file"]::file-selector-button:hover { background-color: #0056b3; }
    .save-button {
      background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em;
      width: 100%;
    }
    .save-button:hover { background-color: #218838; }
  </style>
</head>
<body>
  <header>
    <h1>Nasukafoods</h1>
  </header>
  <nav>
    <a href="index.html">Beranda</a>
    <a href="login.html">Login</a>
    <a href="#">Notif</a>
    <a href="#">Logout</a>
    <a href="profil.html">Profil</a>
  </nav>
  <div class="container">
    <h2>Profil Pengguna</h2>
    <div class="profile-section">
      <div class="profile-picture-display">
        <img id="display-profile-picture" src="https://via.placeholder.com/120?text=No+Pic" alt="Foto Profil" />
      </div>
      <div class="profile-info">
        <p><strong>ID Pengguna:</strong> <span id="display-id"></span></p>
        <p><strong>Nama Lengkap:</strong> <span id="display-nama"></span></p>
        <p><strong>Nomor HP:</strong> <span id="display-telepon"></span></p>
        <p><strong>Alamat Pengiriman:</strong> <span id="display-alamat"></span></p>
        <p><strong>Sosial Media:</strong> <span id="display-sosialMedia"></span></p>
        <p><strong>Kata Kata Hari Ini:</strong> <span id="display-kataKata"></span></p>
      </div>
      <button class="edit-button" id="editProfileBtn">Edit Profil</button>
    </div>
  </div>

  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h3>Edit Profil</h3>
      <form id="profileForm">
        <div class="form-group">
          <label for="input-nama">Nama Lengkap:</label>
          <input type="text" id="input-nama" required />
        </div>
        <div class="form-group">
          <label for="input-telepon">Nomor HP:</label>
          <input type="tel" id="input-telepon" required />
        </div>
        <div class="form-group">
          <label for="input-alamat">Alamat Pengiriman:</label>
          <textarea id="input-alamat" rows="3" required></textarea>
        </div>
        <div class="form-group">
          <label for="input-sosialMedia">Sosial Media:</label>
          <input type="text" id="input-sosialMedia" />
        </div>
        <div class="form-group">
          <label for="input-profile-picture">Foto Profil:</label>
          <input type="file" id="input-profile-picture" accept="image/*" />
        </div>
        <button type="submit" class="save-button">Simpan Perubahan</button>
      </form>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 Nasukafoods</p>
  </footer>

  <script>
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwL9L9lI4GViVClRwcGN4dg2iyqhN_bPGnuwFL5v1Q_UMp5uZqdbQJmy9LIYwG81Dqy/exec';

    document.addEventListener('DOMContentLoaded', () => {
      loadProfileData();
      document.getElementById('editProfileBtn').onclick = () => document.getElementById('editModal').style.display = 'block';
      document.getElementById('closeModal').onclick = () => document.getElementById('editModal').style.display = 'none';
      window.onclick = (e) => { if (e.target == document.getElementById('editModal')) document.getElementById('editModal').style.display = 'none'; };
      document.getElementById('profileForm').addEventListener('submit', saveProfileData);
    });

    function loadProfileData() {
      const data = JSON.parse(localStorage.getItem('profileData')) || {};
      document.getElementById('display-id').textContent = data.id || '';
      document.getElementById('display-nama').textContent = data.nama || '';
      document.getElementById('display-telepon').textContent = data.telepon || '';
      document.getElementById('display-alamat').textContent = data.alamat || '';
      document.getElementById('display-sosialMedia').textContent = data.sosialMedia || '';
      document.getElementById('display-kataKata').textContent = data.kataKata || '';
      document.getElementById('display-profile-picture').src = data.profilePictureUrl || 'https://via.placeholder.com/120?text=No+Pic';

      document.getElementById('input-nama').value = data.nama || '';
      document.getElementById('input-telepon').value = data.telepon || '';
      document.getElementById('input-alamat').value = data.alamat || '';
      document.getElementById('input-sosialMedia').value = data.sosialMedia || '';
    }

    async function saveProfileData(e) {
      e.preventDefault();
      let data = JSON.parse(localStorage.getItem('profileData')) || {};
      if (!data.id) {
        data.id = 'USR-' + Date.now();
        data.tanggalMasuk = new Date().toLocaleDateString('id-ID');
        data.saldo = '0';
      }

      data.nama = document.getElementById('input-nama').value;
      data.telepon = document.getElementById('input-telepon').value;
      data.alamat = document.getElementById('input-alamat').value;
      data.sosialMedia = document.getElementById('input-sosialMedia').value;

      const file = document.getElementById('input-profile-picture').files[0];
      const formData = new FormData();
      formData.append('action', 'saveProfile');
      formData.append('user_id', data.id);
      formData.append('nama', data.nama);
      formData.append('telepon', data.telepon);
      formData.append('alamat', data.alamat);
      formData.append('sosialMedia', data.sosialMedia);
      formData.append('saldo', data.saldo);
      formData.append('tanggalMasuk', data.tanggalMasuk);
      if (file) formData.append('profile_picture_file', file);
      else formData.append('current_profile_picture_url', data.profilePictureUrl || '');

      try {
        const res = await fetch(WEB_APP_URL, { method: 'POST', body: formData });
        const result = await res.text();
        if (result === "Success") {
          localStorage.setItem('profileData', JSON.stringify(data));
          loadProfileData();
          document.getElementById('editModal').style.display = 'none';
          alert('Profil berhasil disimpan!');
        } else {
          alert('Gagal: ' + result);
        }
      } catch {
        alert('Gagal terhubung ke server');
      }
    }
  </script>
</body>
</html>
