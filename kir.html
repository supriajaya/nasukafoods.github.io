<!DOCTYPE html>
<html>
<head>
    <title>KIRIM Lokasi Live (OpenStreetMap)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; margin: 15px; }
        #map { height: 350px; border: 1px solid #ccc; border-radius: 8px; margin-top: 15px; }
        .status { padding: 10px; background-color: #d4edda; color: #155724; border-radius: 4px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <h1>Pengirim Lokasi Live ðŸŸ¢ (OSM)</h1>
    <p>Lokasi Anda dikirim secara real-time ke database.</p>
    
    <div id="status" class="status">Menunggu inisialisasi...</div>
    <div id="map"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // PASTIKAN MENGGANTI INI DENGAN KONFIGURASI FIREBASE ANDA SENDIRI
        const firebaseConfig = {
            apiKey: "AIzaSyAJPoqA190LutHQ7xnvnV96GTRHzz24IpI", // GANTI
            authDomain: "nasukafoods1.firebaseapp.com", // GANTI
            databaseURL: "https://nasukafoods1-default-rtdb.asia-southeast1.firebasedatabase.app", // GANTI
            projectId: "nasukafoods1", // GANTI
            messagingSenderId: "84287800896", // GANTI
            appId: "1:84287800896:web:83189d6766997b00f701a5" // GANTI
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const database = firebase.database();
        const locationRef = database.ref('live_location/kurir_motor_osm'); // Node yang baru
        const statusElement = document.getElementById('status');
        
        let map;
        let currentMarker;
        const defaultLatLng = [-6.2088, 106.8456]; // Jakarta

        // Inisialisasi Peta Leaflet (OpenStreetMap)
        function initMap() {
            map = L.map('map').setView(defaultLatLng, 10);

            // Tambahkan tile layer dari OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
            
            // Marker awal
            currentMarker = L.marker(defaultLatLng).addTo(map)
                .bindPopup('Lokasi Saya')
                .openPopup();

            // Mulai melacak setelah peta siap
            if (navigator.geolocation) {
                statusElement.innerHTML = "Mulai melacak lokasi...";
                navigator.geolocation.watchPosition(sendLocation, locationError, {
                    enableHighAccuracy: true,
                    timeout: 10000 
                });
            } else {
                statusElement.innerHTML = "Geolocation tidak didukung oleh browser Anda.";
            }
        }

        function sendLocation(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const latLng = [lat, lng];
            const timestamp = new Date().toLocaleTimeString();

            // MENGIRIM lokasi ke Firebase
            locationRef.set({ 
                lat: lat, 
                lng: lng,
                time: timestamp,
                accuracy: position.coords.accuracy
            }).then(() => {
                statusElement.innerHTML = `Lokasi terkirim. Terakhir: ${timestamp}. Lat: ${lat.toFixed(6)}`;
            }).catch(error => {
                statusElement.innerHTML = `Gagal mengirim ke DB: ${error.message}`;
            });

            // Update Marker dan peta
            currentMarker.setLatLng(latLng);
            map.setView(latLng, 15); // Pindah pandangan dan zoom ke lokasi baru
        }

        function locationError(error) {
            statusElement.innerHTML = `Gagal melacak lokasi: ${error.message}`;
        }
        
        // Panggil fungsi inisialisasi
        initMap();
    </script>
</body>
</html>
