<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nasuka Foods</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script> 
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
    
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 450px;
            margin: 0 auto;
            background-color: white;
            min-height: 10vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        #login-container, #signup-container, #profil-container, #editprofil-container, #payment-container, #receipt-popup, #video-container, #download-container, #qris-container, #leaderboard-container { /* Tambahkan #qris-container dan #leaderboard-container di sini */
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 200005; 
            overflow-y: auto;
        }
        
        .header {
            background: linear-gradient(180deg, #007bff, #0056b3);
            color: white;
            padding: 20px 15px 100px 15px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('placeholder-building-bg.png'); 
            background-size: cover;
            background-position: center top;
            opacity: 0.2; 
            z-index: 1;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .welcome {
            font-size: 18px;
            font-weight: 500;
        }

        .help-center {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
        }

        .help-center i {
            margin-right: 5px;
        }

        .balance-card {
            background-color: white;
            color: #333;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            position: absolute; 
            top: 100px; 
            left: 15px;
            right: 15px;
            z-index: 10;
        }

        .balance-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .balance-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: 700;
        }

        .balance-icon {
            font-size: 20px;
            color: #007bff; 
            cursor: pointer;
        }
        
        .download-header, .qris-header, .leaderboard-header { /* Menambahkan .qris-header dan .leaderboard-header */
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }
        
        .download-header i, .qris-header i, .leaderboard-header i { /* Menambahkan .qris-header i dan .leaderboard-header i */
            font-size: 24px;
            margin-right: 15px;
            cursor: pointer;
        }
        
        /* Gaya untuk QRIS Container */
        #qris-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f2f5; 
            z-index: 200006; 
            justify-content: center;
            align-items: flex-start; 
            padding: 0;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .qris-card-modified {
            background: white;
            padding: 0;
            border-radius: 0; 
            width: 100%;
            max-width: 450px; 
            margin: 0 auto;
            box-shadow: none; 
            text-align: left;
            min-height: 100vh;
        }

        .qris-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .qris-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            flex-grow: 1;
            text-align: center;
            padding-right: 24px; 
        }

        .qris-header i {
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }
        
        .qris-content-section {
            padding: 15px;
            background-color: white; 
            padding-top: 0;
        }

        .qris-logo-section {
            padding: 20px 20px 10px 20px;
            text-align: center;
            margin-bottom: 15px;
            background-color: #fff;
        }

        .qris-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 50%;
            margin-bottom: 10px;
            border: 3px solid #007bff;
        }

        .qris-title {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .qris-subtitle {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        .qris-code-box {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid #eee;
        }

        .qris-code-image {
            width: 180px;
            height: 180px;
            object-fit: contain;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .qris-info p {
            margin: 5px 0;
            font-size: 14px;
            color: #555;
            text-align: left;
        }
        
        .qris-code-box .qris-info p {
             text-align: center; /* Sesuaikan agar info di dalam box tetap di tengah */
        }

        .qris-instruction-box {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid #eee;
        }

        .qris-instruction-box h4 {
            margin-top: 0;
            font-size: 16px;
            color: #007bff;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .qris-instruction-box ul {
            padding-left: 20px;
            margin: 0;
            font-size: 14px;
            color: #333;
        }

        .qris-instruction-box li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .qris-warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-top: 15px;
        }

        .qris-warning i {
            margin-right: 10px;
            font-size: 18px;
        }

        .qris-promo-section {
            background-color: #e6f7ff;
            color: #007bff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .download-content {
            padding: 15px;
            max-width: 450px;
            margin: 0 auto;
        }

        .app-info-top {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-top: 10px;
        }

        .app-logo {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            object-fit: cover;
            margin-right: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .app-text {
            flex-grow: 1;
        }

        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin: 0 0 5px 0;
        }

        .app-version {
            font-size: 16px;
            color: #666;
            margin-bottom: 5px;
        }

        .app-publisher {
            font-size: 14px;
            color: #007bff;
        }

        .app-stats {
            display: flex;
            justify-content: space-between;
            text-align: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-item {
            flex: 1;
            padding: 0 10px;
            border-right: 1px solid #eee;
        }

        .stat-item:last-child {
            border-right: none;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 3px;
        }

        .stat-label {
            font-size: 12px;
            color: #999;
        }

        .stat-value i {
            color: gold;
            margin-right: 5px;
        }

        .download-description h4 {
            font-size: 18px;
            color: #333;
            margin: 20px 0 10px 0;
            font-weight: 600;
        }

        .download-description p {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .download-footer-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 450px;
            width: 100%;
            background-color: #007bff; 
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.15);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: white;
            font-weight: 600;
        }

        .download-footer-text {
            font-size: 16px;
        }
        
        .download-footer-version {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 2px;
        }

        .download-footer-icon {
            font-size: 24px;
        }

        .all-accounts {
            background-color: #f0f2f5;
            color: #007bff; 
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            cursor: pointer;
        }

        .main-features {
            display: flex;
            justify-content: space-around;
            padding: 20px 10px;
            margin-top: 100px; 
            margin-bottom: 10px;
            background-color: white; 
            border-bottom: 1px solid #eee;
        }
        
        .feature-item, .feature-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            font-size: 12px;
            color: #555;
            cursor: pointer;
            width: 20%; 
            text-decoration: none; 
        }

        .feature-icon-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 5px;
            font-size: 22px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .transfer-icon { background-color: #e6f7ff; color: #007bff; }
        .briva-icon { background-color: #e6fffb; color: #00bcd4; }
        .pdam-icon { background-color: #e6f0ff; color: #007bff; } 
        .pulsa-icon { background-color: #e6ffe6; color: #28a745; }

        .feature-icon-circle i {
            font-size: 24px;
        }
        
        /* Gaya untuk gambar Leaderboard */
        .leaderboard-icon-img {
            width: 25px; /* Sesuaikan ukuran gambar */
            height: 25px;
            object-fit: contain;
            /* Tambahan untuk animasi jika GIF */
        }

        .banner {
            margin: 0 15px 20px 15px;
            padding: 15px;
            border-radius: 12px;
            background: linear-gradient(90deg, #007bff, #0056b3); 
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .banner-text {
            flex-grow: 1;
            line-height: 1.4;
        }

        .banner-text strong {
            font-size: 16px;
            font-weight: 700;
        }

        .banner-button {
            background-color: white;
            color: #007bff; 
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-left: 10px;
        }

        .search-bar {
            margin: 0 15px 20px 15px;
            padding: 10px 15px;
            background-color: #f0f2f5;
            border-radius: 8px;
            color: #666;
            display: flex;
            align-items: center;
            font-size: 16px;
            cursor: text;
        }

        .search-bar i {
            margin-right: 10px;
            color: #999;
        }
        
        /* Gaya tambahan untuk Marquee agar sesuai dengan kolom search */
        .search-bar .marquee-content {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .search-bar marquee {
            width: 100%;
            margin: 0;
            padding: 0;
            display: block; /* Memastikan marquee mengambil ruang yang tersedia */
        }

        .other-features {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px 10px;
            padding: 0 15px 20px 15px;
        }

        .other-feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            font-size: 12px;
            color: #555;
            cursor: pointer;
        }

        .other-feature-icon {
            width: 50px;
            height: 50px;
            background-color: #fff;
            border: 1px solid #eee;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 5px;
            font-size: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            overflow: hidden; 
        }
        
        .product-icon-img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            border-radius: 10px; 
        }

        .top-up-icon { color: #28a745; }
        .brizzi-icon { color: #00bcd4; }
        .tagihan-icon { color: #007bff; } 
        .setor-tarik-icon { color: #007bff; }
        .lifestyle-icon { color: #e83e8c; }
        .virtual-icon { color: #007bff; }
        .catatan-icon { color: #007bff; } 
        .investasi-icon { color: #007bff; } 


        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 450px;
            width: 100%;
            background-color: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-around;
            padding: 5px 0;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 10px;
            color: #999;
            padding: 5px;
            cursor: pointer;
        }

        .nav-item.active {
            color: #007bff; 
            font-weight: 600;
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 2px;
        }
        
        .nav-item .leaderboard-img {
            width: 20px;
            height: 20px;
            margin-bottom: 2px;
            object-fit: contain;
        }

        .qris-button {
            position: absolute;
            bottom: 30px; 
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background-color: #007bff; 
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 28px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border: 5px solid white; 
            z-index: 101;
            cursor: pointer;
        }
        
        #editprofil-container textarea {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 24px;
            resize: vertical;
        }
        
        /* --- START: Modified Auth Styles to match Image --- */
        .auth-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white; /* Changed to white or a light color */
            z-index: 200001;
            justify-content: center;
            align-items: flex-start; /* Start from the top */
            padding: 0; 
            box-sizing: border-box;
            overflow-y: auto;
        }
        .auth-card {
            background: white;
            padding: 20px 20px 40px 20px; /* Reduced vertical padding, increased horizontal */
            border-radius: 0; /* No border-radius for full screen container */
            width: 100%;
            max-width: 450px; /* Max width to contain on larger screens */
            box-shadow: none; /* No shadow */
            text-align: left; /* Aligned left for inputs/labels */
            min-height: 100vh;
            margin: 0 auto;
        }
        
        .auth-logo-section {
            text-align: center;
            padding: 30px 0 10px 0;
        }
        
        .auth-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 50%;
            border: 3px solid #007bff;
            margin-bottom: 10px;
        }

        .auth-card h2 {
            font-size: 24px;
            margin-bottom: 30px; /* Increased margin */
            color: #333;
            text-align: center;
            font-weight: 700;
        }
        
        .auth-input-group {
            margin-bottom: 20px; /* Increased space between inputs */
        }
        
        .auth-input-group label {
             display: block;
             font-size: 14px;
             color: #666;
             margin-bottom: 5px;
             font-weight: 500;
        }
        
        .auth-card input[type="text"],
        .auth-card input[type="password"] {
            width: 100%;
            padding: 12px; /* Slightly smaller padding */
            margin-bottom: 0; /* Handled by auth-input-group */
            border: 1px solid #ccc; /* Thinner, lighter border */
            border-radius: 6px; /* Smaller radius */
            box-sizing: border-box;
            font-size: 16px; /* Smaller font size */
        }
        
        .auth-card button.btn-primary {
            width: 100%;
            padding: 12px;
            background-color: #007bff; /* Primary color */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .auth-card button.btn-primary:hover {
            background-color: #0056b3;
        }
        
        .auth-card .link-switch {
            margin-top: 20px;
            font-size: 14px; /* Smaller font size */
            text-align: center;
        }
        .auth-card .link-switch a {
            color: #007bff; /* Primary link color */
            text-decoration: none;
            font-weight: 600;
        }
        .auth-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px; /* Smaller font size */
            text-align: center;
        }
        
        .auth-card button.btn-secondary {
            width: 100%;
            padding: 12px;
            background-color: white; /* Secondary style */
            color: #007bff;
            border: 1px solid #007bff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        .auth-card button.btn-secondary:hover {
            background-color: #e6f7ff;
        }
        /* --- END: Modified Auth Styles to match Image --- */


        
        #profil-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f2f5; 
            z-index: 200002;
            overflow-y: auto; 
            padding: 0;
            box-sizing: border-box;
        }
        .profil-card {
            background: none; 
            padding: 0;
            border-radius: 0;
            width: 100%;
            max-width: 450px; 
            margin: 0 auto;
            box-shadow: none;
            text-align: left;
            min-height: 100vh;
        }
        .profil-card h2 {
            display: none; 
        }

        .profil-header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .profil-header-nav h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 500;
        }
        .profil-header-nav i {
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }

        .driver-info {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: white;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .driver-foto {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            border: 3px solid #007bff;
        }
        .driver-text h4 {
            margin: 0 0 5px 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        .driver-details {
            font-size: 12px;
            color: #666;
        }

        .safety-report {
            background-color: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            cursor: pointer;
        }
        .safety-report-left {
            display: flex;
            align-items: center;
        }
        .safety-icon {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #007bff;
            margin-right: 10px;
        }
        .safety-text {
            font-size: 14px;
            color: #333;
        }
        .safety-text span {
            display: block;
            font-size: 12px;
            color: #666;
        }

        .rating-section {
            background-color: white;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .rating-main {
            text-align: center;
            margin-right: 20px;
        }
        .rating-score {
            font-size: 32px;
            font-weight: 700;
            color: #333;
        }
        .rating-label {
            font-size: 12px;
            color: #666;
        }
        .rating-breakdown {
            flex-grow: 1;
            font-size: 12px;
            color: #666;
        }
        .rating-bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 2px;
        }
        .rating-bar-row span:first-child {
            width: 10px;
            text-align: right;
            margin-right: 5px;
        }
        .rating-bar {
            flex-grow: 1;
            height: 6px;
            background-color: #eee;
            border-radius: 3px;
            margin-right: 10px;
        }
        .rating-fill {
            height: 100%;
            background-color: #ffc107; 
            border-radius: 3px;
        }

        .profil-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            background-color: white;
        }
        .profil-tab-item {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .profil-tab-item.active {
            color: #007bff;
            border-bottom: 2px solid #007bff;
        }

        .tab-content-section {
            padding: 15px;
            background-color: white;
            margin-top: 1px;
            margin-bottom: 70px; 
        }
        .badge-section h4 {
            margin-top: 0;
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }
        .badge-card {
            display: flex;
            padding: 15px;
            border-radius: 8px;
            background-color: #f7f7f7;
            align-items: center;
        }
        .badge-image {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-right: 15px;
        }
        .badge-text strong {
            font-size: 14px;
            color: #333;
        }
        .badge-text span {
            display: block;
            font-size: 12px;
            color: #007bff;
            margin-top: 5px;
            cursor: pointer;
        }

        .passenger-comments {
            padding: 15px;
            background-color: white;
            margin-top: 10px;
        }
        .passenger-comments h4 {
            margin: 0 0 15px 0;
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }
        .magnifying-glass {
            display: block;
            margin: 20px auto;
            width: 80px;
            height: 80px;
            
        }
        
        #editprofil-container {
            background-color: #f0f2f5; 
            align-items: flex-start; 
            padding: 0;
            overflow-y: auto;
        }

        #editprofil-container .auth-card {
            background: #f0f2f5; 
            padding: 0;
            border-radius: 0;
            box-shadow: none;
            max-width: 450px;
            margin: 0 auto;
            width: 100%;
            min-height: 100vh; 
        }

        .edit-header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .edit-header-nav h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .edit-header-nav .fas {
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }

        .edit-profile-photo-section {
            padding: 20px;
            background-color: white;
            text-align: center;
            margin-bottom: 10px;
        }

        .edit-profile-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
            border: 4px solid #007bff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .change-photo-text {
            color: #007bff;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
        }

        .edit-form-section {
            background-color: white;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .edit-form-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            color: #333;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .edit-form-section input[type="text"],
        .edit-form-section input[type="password"],
        .edit-form-section textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            color: #333;
            -webkit-appearance: none; 
            -moz-appearance: none; 
            appearance: none;
        }

        .edit-form-section textarea {
            resize: vertical;
            min-height: 80px;
        }

        #editProfilForm button[type="submit"] {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            margin-top: 5px;
            margin-bottom: 15px;
            transition: background-color 0.3s;
        }

        #editProfilForm button[type="submit"]:hover {
            background-color: #0056b3;
        }

        .edit-footer-buttons {
            padding: 15px;
            background-color: white;
            text-align: center;
            position: sticky;
            bottom: 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
        }

        .edit-footer-buttons button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            border: 1px solid #ccc;
        }

        .edit-footer-buttons .btn-batal {
            background-color: white;
            color: #f44336;
            margin-bottom: 10px;
        }

        .edit-footer-buttons .btn-logout {
            background-color: #f44336;
            color: white;
            border: none;
        }

        .edit-footer-buttons .btn-batal:hover {
            background-color: #f0f0f0;
        }
        
        #payment-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f2f5; 
            z-index: 200003;
            justify-content: center;
            align-items: flex-start; 
            padding: 0;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .payment-card-modified {
            background: white;
            padding: 0;
            border-radius: 0; 
            width: 100%;
            max-width: 450px; 
            margin: 0 auto;
            box-shadow: none; 
            text-align: left;
            min-height: 100vh;
        }

        .payment-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .payment-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            flex-grow: 1;
            text-align: center;
            padding-right: 24px; 
        }

        .payment-header i {
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }
        
        .product-image-slider, .slider-nav, .slider-dots { 
             display: none;
        }
        
        .product-image-container {
            width: 100%;
            height: 250px; 
            overflow: hidden;
            position: relative;
        }

        .product-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            display: block;
        }

        .product-details-section {
            padding: 15px;
            background-color: white;
            border-bottom: 8px solid #f0f2f5; 
        }

        .product-details-section h4 {
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 20px;
            color: #333;
            font-weight: 700;
        }

        .product-price-display {
            font-size: 16px;
            color: #f44336; 
            font-weight: 600;
            margin-bottom: 15px;
        }

        .product-description-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .product-keterangan-manual {
            font-size: 14px;
            color: #007bff;
            font-style: italic;
            margin-top: 10px;
        }

        .payment-info-section {
            padding: 15px;
            background-color: white;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            color: #333;
            font-weight: 500;
            text-align: right;
        }
        
        .info-value.address {
            max-width: 60%;
        }

        .Saldo-row {
            font-size: 16px;
            font-weight: 700;
            color: #007bff; 
        }
        
        .total-bayar-row {
            font-weight: 700; 
            font-size: 18px; 
            margin-top: 10px; 
            border-top: 1px solid #ddd;
        }

        .total-bayar-row .info-value {
             color: #f44336; 
        }

        .payment-action-section {
            padding: 15px;
            background-color: white;
            position: sticky;
            bottom: 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }

        .btn-bayar-Saldo {
            width: 100%;
            padding: 15px;
            background-color: #007bff; 
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .btn-bayar-Saldo:hover {
            background-color: #0056b3;
        }

        #video-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f2f5; 
            z-index: 200004; 
            justify-content: center;
            align-items: flex-start; 
            padding: 0;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .video-card-modified {
            background: white;
            padding: 0;
            border-radius: 0; 
            width: 100%;
            max-width: 450px; 
            margin: 0 auto;
            box-shadow: none; 
            text-align: left;
            min-height: 100vh;
        }

        .video-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .video-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            flex-grow: 1;
            text-align: center;
            padding-right: 24px; 
        }

        .video-header i {
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }
        
        .video-content-section {
            padding: 10px 15px;
            background-color: #f0f2f5; 
            padding-bottom: 80px; 
        }
        
        .video-item {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .video-thumbnail {
            width: 100%;
            height: 200px;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .video-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover; 
        }
        
        .video-details {
            padding: 10px 15px;
        }
        
        .video-details h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            font-weight: 600;
        }
        
        .video-details p {
            margin: 0;
            font-size: 12px;
            color: #666;
        }
        
        /* Gaya untuk Leaderboard Container */
        #leaderboard-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f2f5;
            z-index: 200006;
            justify-content: center;
            align-items: flex-start;
            padding: 0;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .leaderboard-card-modified {
            background: white;
            padding: 0;
            border-radius: 0;
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
            box-shadow: none;
            text-align: left;
            min-height: 100vh;
        }
        
        .leaderboard-content-section {
            padding: 15px;
            background-color: #f0f2f5; 
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            font-size: 16px;
        }

        .leaderboard-rank {
            font-weight: 700;
            color: #007bff;
            width: 30px;
            text-align: left;
            font-size: 18px;
        }

        .leaderboard-name {
            flex-grow: 1;
            font-weight: 500;
            color: #333;
            padding-left: 10px;
        }

        .leaderboard-score {
            font-weight: 700;
            color: #ffc107;
        }

        .leaderboard-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            flex-grow: 1;
            text-align: center;
            padding-right: 24px;
        }

        .leaderboard-header i {
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }

        
    </style>
</head>
<body>
    
<div class="container">
    
    <div id="home-container" style="display: block;">
        
        <div class="header">
            <div class="header-content">
                <div class="top-nav">
                    <span class="welcome">Nasuka Foods<br></span> 
                    <div class="help-center" id="Profil">
                        <i class="fas fa-user"></i>
                        <span id="userNameDisplay">...</span> </div>
                </div>
            </div>
        </div>

        <div class="balance-card">
            <div class="balance-title">Saldo</div>
            <div class="balance-details">
                <span class="balance-amount" id="SaldoAmountDisplay">...</span> <i class="fas fa-mobile-alt balance-icon" onclick="showDownload()"></i>
            </div>
            <div class="all-accounts">
                <span>(segera)</span>
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>

        <div class="main-features">
            <a href="https://nasukafoods.site/giveaway.html" target="_blank" class="feature-link">
                <div class="feature-icon-circle transfer-icon">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <span>Give Away</span>
            </a>
            
            <div class="feature-item" onclick="showVideo()">
                <div class="feature-icon-circle briva-icon">
                    <i class="fas fa-video"></i>
                </div>
                <span>Video</span>
            </div>
            
            <a href="" target="_blank" class="feature-link">
                <div class="feature-icon-circle pdam-icon">
                    <i class="fas fa-plus"></i> 
                </div>
                <span>Saldo</span>
            </a>
            
            <a href="https://nasukafoods.site/posisi-mang-cilok.html" target="_blank" class="feature-link">
                <div class="feature-icon-circle pulsa-icon" style="overflow: hidden; padding: 0;">
                    <img src="https://nasukafoods.site/lacak-lokasi.gif" alt="Lacak Lokasi" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                </div>
                <span>Lihat Posisi</span>
            </a>
            </div>

        <div class="banner">
            <div class="banner-text">
                <strong>Promo Hari Ini</strong>
                <br>Harga khusus warga bojongloa kidul
            </div>
            <div class="banner-button">
                cek <i class="fas fa-chevron-right"></i>
            </div>
        </div>

        <div class="search-bar">
            <i class="fas fa-search"></i>
            <span>Produk</span>
        </div>

        <div class="other-features">
            <div class="other-feature-item" onclick="showPayment(' Cilok Premium', 'Cilok dengan kualitas terbaik, rasa original gurih.', 900, ['https://nasukafoods.site/cilokpro.jpg'], 'Isi 1 biji.')">
                <div class="other-feature-icon top-up-icon">
                    <img src="https://nasukafoods.site/cilokpro.jpg" alt="cilok 1" class="product-icon-img">
                </div>
                <span>Rp 900</span>
            </div>
            
            
            <div class="other-feature-item" onclick="showPayment('Paket Hemat 1', 'Paket hemat diskon 20%.', 44000, ['https://nasukafoods.site/cilokpro.jpg'], 'Isi 50 cilok.')">
                <div class="other-feature-icon brizzi-icon">
                    <img src="https://nasukafoods.site/cilokpro.jpg" alt="Paket hemat 1" class="product-icon-img">
                </div>
                <span>Rp 44.000</span>
            </div>
            <div class="other-feature-item" onclick="showPayment('Cilok Premium: Paket Keluarga', 'Porsi besar untuk acara keluarga.', 87000, ['https://nasukafoods.site/cilokpro.jpg'], 'Isi 100 cilok, saus extra pedas. Promo terbatas!')">
                <div class="other-feature-icon tagihan-icon">
                    <img src="https://nasukafoods.site/cilokpro.jpg" alt="Paket premium" class="product-icon-img">
                </div>
                <span>Rp 87.000</span>
            </div>
            <div class="other-feature-item" onclick="showPayment('Paket Premium Sultan', 'Cilok frozen siap masak untuk stok di rumah.', 850000, ['https://nasukafoods.site/cilokpro.jpg'], 'Stok 1 bulan. Gratis ongkos kirim seluruh kota bandung.')">
                <div class="other-feature-icon setor-tarik-icon">
                    <img src="https://nasukafoods.site/cilokpro.jpg" alt="Sultan" class="product-icon-img">
                </div>
                <span>Rp 850.000</span>
            </div>
            </div>
            
              <div class="search-bar" id="marquee-search-bar">
                <i class="fas fa-search"></i>
                <div class="marquee-content">
                    <span id="running-text"></span>
                </div>
            </div>
        </div> 
        
 <div class="other-features">
            
            <div class="other-feature-item">
                <div class="other-feature-icon lifestyle-icon">
                    <i class="fas fa-shopping-bag"></i>
                </div>
                <span>Lifestyle</span>
            </div>
            
            <a href="https://nasukafoods.site/test-giveaway.html" target="_blank" class="other-feature-item" style="text-decoration: none; color: inherit;">
                <div class="other-feature-icon virtual-icon">
                    <i class="fas fa-file-invoice"></i>
                </div>
                <span>Simulasi</span>
            </a>
            
            <a href="https://nasukafoods.site/burung.html" target="_blank" class="other-feature-item" style="text-decoration: none; color: inherit;">
                <div class="other-feature-icon catatan-icon" style="overflow: hidden; padding: 0;">
                    <img src="https://nasukafoods.site/nasukabird.jpg" alt="Daftar" class="product-icon-img">
                </div>
                <span>Tap Bird</span>
            </a>
            
            <a href="https://nasukafoods.site/roll.html" target="_blank" class="other-feature-item" style="text-decoration: none; color: inherit;">
                <div class="other-feature-icon investasi-icon" style="overflow: hidden; padding: 0;">
                    <img src="https://nasukafoods.site/roll.jpg" alt="Masuk" class="product-icon-img">
                </div>
                <span>Roll</span>
            </a>
            
        </div>
        
        
        
        
        
        <div class="other-feature-icon investasi-icon" style="margin: 0 auto; display: block; width: 50px; height: 50px;"> 
            <i class="fas fa-chart-line"></i>
        </div>
      
        
        <div class="qris-button" onclick="showQris()"> <i class="fas fa-qrcode"></i>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" id="nav-home" onclick="showHome()">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" id="nav-leaderboard" onclick="showLeaderboard()">
                <img src="https://nasukafoods.site/wingbiru.gif" alt="Leaderboard" class="leaderboard-img">
                <span>Leaderboard</span>
            </div>
            <div class="nav-item">
                <i class="fas fa-list-alt"></i>
                <span>Aktivitas</span>
            </div>
            <div class="nav-item" onclick="localStorage.getItem('ID') ? showProfil() : showLogin()">
                <i class="fas fa-user-circle"></i>
                <span>Akun</span>
            </div>
        </div>
        
        
 
            
            
            
        </div> 
   
    
    
    
    
    
    
    
    
    
    
    
    
    <div id="login-container" class="auth-container">
        <div class="auth-card">
            <div class="auth-logo-section">
                <img src="https://nasukafoods.site/nasukafoods.jpg" alt="Nasuka Foods Logo" class="auth-logo">
            </div>
            <h2>Masuk Akun Anda</h2>
            <form id="loginForm">
                <div class="auth-input-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" placeholder="Masukkan Username Anda" required>
                </div>
                <div class="auth-input-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Masukkan Password Anda" required>
                </div>
                <button type="submit" class="btn-primary">Login</button>
                <div id="loginStatus" class="auth-status"></div>
            </form>
            <div class="link-switch">Belum punya akun? <a href="#" onclick="showSignup()">Daftar di sini</a></div>
            <button onclick="showHome()" class="btn-secondary">Batal / Kembali ke Beranda</button>
        </div>
    </div>

    <div id="signup-container" class="auth-container">
        <div class="auth-card">
            <div class="auth-logo-section">
                <img src="https://nasukafoods.site/nasukafoods.jpg" alt="Nasuka Foods Logo" class="auth-logo">
            </div>
            <h2>Daftar Akun Baru</h2>
            <form id="signupForm">
                <div class="auth-input-group">
                    <label for="signupUsername">Username</label>
                    <input type="text" id="signupUsername" placeholder="Buat Username" required>
                </div>
                <div class="auth-input-group">
                    <label for="signupNama">Nama Lengkap</label>
                    <input type="text" id="signupNama" placeholder="Nama Lengkap Anda" required>
                </div>
                <div class="auth-input-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Buat Password" required>
                </div>
                <button type="submit" class="btn-primary">Daftar</button>
                <div id="signupStatus" class="auth-status"></div>
            </form>
            <div class="link-switch">Sudah punya akun? <a href="#" onclick="showLogin()">Masuk di sini</a></div>
            <button onclick="showHome()" class="btn-secondary">Batal / Kembali ke Beranda</button>
        </div>
    </div>

    <div id="profil-container">
        <div class="profil-card">
            
            <div class="profil-header-nav">
                <i class="fas fa-arrow-left" onclick="showHome()"></i>
                <h3>Profil Saya</h3>
                <div>
                    <i class="fas fa-pencil-alt" onclick="showEditProfil()"></i>
                    <i class="fas fa-question-circle" style="margin-left: 15px;"></i>
                </div>
            </div>

            <div class="driver-info">
                <img id="profilFoto" class="driver-foto" src="https://nasukafoods.site/gambarkosong.jpg" alt="Foto Profil">
                <div class="driver-text">
                    <h4 id="profilNamaDriver">...</h4>
                    <div class="driver-details">
                        Gabung bulan <span id="profilBulanJoin">...</span> | 
                        <span id="profilIDPlat">...</span> 
                    </div>
                </div>
            </div>
            
            <div class="rating-section" style="padding: 10px 15px; margin-bottom: 5px; background-color: #fff8e1; border-radius: 8px; border: 1px solid #ffecb3;">
                <div style="font-size: 14px; font-weight: 600; color: #ff9800;">Saldo Anda</div>
                <div style="font-size: 20px; font-weight: 700; color: #333;" id="profilSaldoDisplay">...</div>
            </div>


            <div class="safety-report" onclick="showHistory()"> <div class="safety-report-left">
                    <div class="safety-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="safety-text">
                        Riwayat pembelian
                        <span>Lihat transaksi anda</span>
                    </div>
                </div>
                <i class="fas fa-chevron-right"></i>
            </div>
            
            <div class="rating-section" style="padding-bottom: 5px;">
                <div class="rating-breakdown" style="margin-right: 0;">
                    <div style="font-size: 10px; color: #666; margin-bottom: 5px;">Aktivitas 10 order terakhir</div>
                    <div style="font-size: 10px; color: #666; margin-bottom: 10px;">Diperbarui setiap hari</div>
                </div>
            </div>

            <div class="rating-section" style="margin-top: -10px; padding-top: 0; border-top: 1px solid #eee;">
                <div class="rating-main">
                    <div class="rating-score" id="profilRatingScore">5.00</div>
                    <div class="rating-label">Penilaian</div>
                </div>
                <div class="rating-breakdown">
                    <div class="rating-bar-row">
                        <span>5</span>
                        <div class="rating-bar"><div class="rating-fill" style="width: 100%;"></div></div>
                        <span id="ratingCount5">10</span>
                    </div>
                    <div class="rating-bar-row">
                        <span>4</span>
                        <div class="rating-bar"><div class="rating-fill" style="width: 0%;"></div></div>
                        <span id="ratingCount4">0</span>
                    </div>
                    <div class="rating-bar-row">
                        <span>3</span>
                        <div class="rating-bar"><div class="rating-fill" style="width: 0%;"></div></div>
                        <span id="ratingCount3">0</span>
                    </div>
                    <div class="rating-bar-row">
                        <span>2</span>
                        <div class="rating-bar"><div class="rating-fill" style="width: 0%;"></div></div>
                        <span id="ratingCount2">0</span>
                    </div>
                    <div class="rating-bar-row">
                        <span>1</span>
                        <div class="rating-bar"><div class="rating-fill" style="width: 0%;"></div></div>
                        <span id="ratingCount1">0</span>
                    </div>
                </div>
            </div>

            <div class="profil-tabs">
                <div class="profil-tab-item active" id="tabPencapaian">Umum</div>
                <div class="profil-tab-item" id="tabPerbaikan">PERBAIKAN</div>
            </div>

            <div id="contentPencapaian" class="tab-content-section">
                <div class="badge-section">
                    <h4>Informasi</h4>
                    <div class="badge-card">
                        <img src="https://nasukafoods.site/nasukafoods.jpg" alt="Lencana" class="badge-image">
                        <div class="badge-text">
                            <strong>Alamat pengiriman</strong>
                            <span id="profilAlamatPengiriman">...</span>
                          
                        </div>
                    </div>
                </div>
                
                <div class="passenger-comments">
                    <h4>Apa Kata Anda</h4>
                    <img src="https://nasukafoods.site/nasukafoods.jpg" alt="Mencari Komentar" class="magnifying-glass">
                    <p style="text-align: center; color: #666; margin-top: 10px;">Belum ada kata kata untuk ditampilkan</p>
                </div>
            </div>

            <div id="contentPerbaikan" class="tab-content-section" style="display: none; text-align: center;">
                <p style="color: #666; font-style: italic;">Tidak ada saran perbaikan saat ini.</p>
                <button id="btnLogout" class="btn-kembali" onclick="logoutUser()" style="background-color: #f44336; margin-top: 20px;">Logout</button>
            </div>
            
        </div>
    </div>
    <div id="editprofil-container" class="auth-container">
    </div>

    <div id="payment-container">
    </div>
    
    <div id="receipt-popup" class="auth-container">
        <div class="auth-card" style="max-width: 350px; padding: 20px; text-align: left; background: #fff;">
            <div id="receipt-content">
                </div>
            <button onclick="hideReceiptAndShowHome()" style="width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; margin-top: 20px;">
                Selesai
            </button>
        </div>
    </div>

    <div id="video-container" class="auth-container">
        <div class="video-card-modified">
            <div class="video-header">
                <i class="fas fa-arrow-left" onclick="showHome()"></i>
                <h3>Pilihan Video</h3>
            </div>
            
            <div class="video-content-section">
                <div id="video-list">
                    <p style="text-align: center; color: #666; margin-top: 20px;">Memuat video...</p>
                </div>
            </div>
            
        </div>
    </div>
    
    <div id="download-container">
        <div class="download-header">
            <i class="fas fa-arrow-left" onclick="showHome()"></i>
            Nasuka Foods
        </div>
        
        <div class="download-content">
            <div class="app-info-top">
                <img src="https://nasukafoods.site/nasukafoods.jpg" alt="App Logo" class="app-logo">
                <div class="app-text">
                    <div class="app-title">Nasuka Foods App</div>
                    <div class="app-version">Versi: 1.0.2</div>
                    <div class="app-publisher">Nasuka Wireless</div>
                </div>
            </div>
            
            <div class="app-stats">
                <div class="stat-item">
                    <div class="stat-value"><i class="fas fa-star" style="color: #ffc107;"></i> 4.9</div>
                    <div class="stat-label">Rating</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">100+</div>
                    <div class="stat-label">Ulasan</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">4 MB</div>
                    <div class="stat-label">Ukuran File</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">200+</div>
                    <div class="stat-label">Unduhan</div>
                </div>
            </div>
            
            <div class="download-description">
                <h4>Deskripsi Aplikasi</h4>
                <p>
                    Aplikasi resmi Nasuka Foods hadir untuk memudahkan Anda memesan produk favorit kami, mengumpulkan Saldo, dan mendapatkan berbagai promo eksklusif. Rasakan pengalaman berbelanja Cilok dan menu lainnya dengan lebih cepat dan praktis!
                </p>
                <p>
                    <strong>Fitur Unggulan:</strong>
                    <ul>
                        <li>Pemesanan Cepat dan Aman.</li>
                        <li>Integrasi Saldo Hadiah.</li>
                       
                        <li>Notifikasi promo terbaru.</li>
                    </ul>
                </p>
                
                <h4>Informasi Tambahan</h4>
                <p>
                    Diperbarui: 15 Okt 2025<br>
                    Membutuhkan Android: 5.0 ke atas<br>
                    Ditawarkan oleh developer: Nasuka Wireless
                </p>
                <div style="height: 60px;"></div> 
            </div>
        </div>
        
        <a href="https://nasukafoods.site/nasuka.apk" target="_blank" class="download-footer-bar">
            <div>
                <div class="download-footer-text">Dapatkan versi terbaru</div>
                <div class="download-footer-version">1.0.2 • 15 Okt 2025</div>
            </div>
            <i class="fas fa-download download-footer-icon"></i>
        </a>
    </div>

    <div id="qris-container">
        <div class="qris-card-modified">
            <div class="qris-header">
                <i class="fas fa-arrow-left" onclick="showHome()"></i>
                <h3>Pembayaran QRIS</h3>
            </div>
            
            <div class="qris-content-section">
                <div class="qris-logo-section">
                    <img src="https://nasukafoods.site/nasukafoods.jpg" alt="Nasuka Foods Logo" class="qris-logo">
                    <div class="qris-title">NASUKA FOODS</div>
                    <div class="qris-subtitle">Pembayaran Digital QRIS</div>
                </div>
                
                <div class="qris-code-box">
                    <img src="https://nasukafoods.site/aqris.jpg" alt="QRIS Code Placeholder" class="qris-code-image" id="qrisCodeImage">
                    <div class="qris-info">
                        <p style="text-align: center; font-weight: 700; color: #007bff; margin-bottom: 10px;">Kode QRIS untuk Pembelian Anda</p>
                        <p><strong>Merchant ID:</strong> ID2025NF001</p>
                        <p><strong>Status:</strong> QRIS Statis (Masukkan Nominal Manual)</p>
                    </div>
                </div>
                
                <div class="qris-promo-section">
                    <i class="fas fa-gift"></i> &nbsp; Dapatkan diskon 5% untuk pembelian di atas 50.000 menggunakan E-Wallet!
                </div>
                
                <div class="qris-instruction-box">
                    <h4>Cara Pembayaran</h4>
                    <ul>
                        <li>Pastikan Anda telah mencatat total nominal belanja Anda.</li>
                        <li>Buka aplikasi Bank / E-Wallet Anda (Gopay, Dana, OVO, dll.) yang mendukung **QRIS**.</li>
                        <li>Pilih menu **Scan** atau Pindai QRIS.</li>
                        <li>Pindai kode QRIS di atas.</li>
                        <li>Masukkan nominal yang sesuai dengan total belanja Anda.</li>
                        <li>Selesaikan pembayaran, dan konfirmasi ke admin kami.</li>
                    </ul>
                </div>
                
                <div class="qris-warning">
                    <i class="fas fa-exclamation-triangle"></i> Periksa kembali! Pastikan nama Merchant yang muncul adalah NASUKA FOODS
                </div>
                
            </div>
            <div style="height: 20px;"></div> 
        </div>
    </div>
    
    <div id="leaderboard-container">
        <div class="leaderboard-card-modified">
            <div class="leaderboard-header">
                <i class="fas fa-arrow-left" onclick="showHome()"></i>
                <h3>Leaderboard</h3>
            </div>
            <div class="leaderboard-content-section">
                <div style="background-color: white; padding: 20px; text-align: center; border-radius: 8px;">
                    <img src="https://nasukafoods.site/wingbiru.gif" alt="Leaderboard Wings" style="width: 50px; height: 50px; margin-bottom: 10px;">
                    <p style="font-size: 16px; font-weight: 600; color: #007bff;">Peringkat Pelanggan Istimewa</p>
                    <p style="font-size: 14px; color: #666; margin-bottom: 20px;">King & Queen <p>Best sultan cibaduyut raya</p></p>
                </div>

                <div id="leaderboard-list">
                    <p style="text-align: center; color: #666; margin-top: 20px;">Leaderboard masih kosong.</p>
                </div>
            </div>
        </div>
    </div>
    </div>
    
    
<script>
    
const firebaseConfig = {
    apiKey: "AIzaSyAJPoqA190LutHQ7xnvnV96GTRHzz24IpT",
    authDomain: "nasukafoods1.firebaseapp.com",
    databaseURL: "https://nasukafoods1-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "nasukafoods1",
    messagingSenderId: "84287800896",
    appId: "1:84287800896:web:83189d6766997b00f701a5"
};
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();

const localUser = {
  Username: localStorage.getItem("Username"),
  Nama: localStorage.getItem("Nama"),
  ID: localStorage.getItem("ID"),
  Saldo: parseInt(localStorage.getItem("Saldo")) || 0,
  Alamat: localStorage.getItem("Alamat") || "Alamat belum diatur",
  NomorHP: localStorage.getItem("NomorHP") || "Nomor HP belum diatur",
  Foto: localStorage.getItem("Foto") || "https://nasukafoods.site/gambarkosong.jpg",
};

if (localUser.ID) {
    const userRef = db.ref(`users/${localUser.ID}`);
    userRef.on('value', (snapshot) => {
      const userData = snapshot.val();
      if (userData !== null) {
        localUser.Saldo = userData.Saldo || 0;
        localUser.Alamat = userData.Alamat || "Alamat belum diatur";
        localUser.NomorHP = userData.NomorHP || "Nomor HP belum diatur";
        localUser.Foto = userData.Foto || "https://nasukafoods.site/gambarkosong.jpg";
        localUser.Nama = userData.Nama || localUser.Nama;
        
        localStorage.setItem("Saldo", localUser.Saldo);
        localStorage.setItem("Alamat", localUser.Alamat);
        localStorage.setItem("NomorHP", localUser.NomorHP);
        localStorage.setItem("Foto", localUser.Foto);
        localStorage.setItem("Nama", localUser.Nama);
        
        updateSaldoDisplay();
      }
    });
}

function updateHomeDisplay() {
    const userNameEl = document.getElementById('userNameDisplay');
    const SaldoEl = document.getElementById('SaldoAmountDisplay');
    const welcomeEl = document.querySelector('.welcome');
    const isLoggedIn = !!localUser.ID;
    
    const navHome = document.getElementById('nav-home');
    const navLeaderboard = document.getElementById('nav-leaderboard');
    
    // Perbarui status active di bottom nav
    if (navHome) navHome.classList.add('active');
    if (navLeaderboard) navLeaderboard.classList.remove('active');

    if (!userNameEl || !SaldoEl || !welcomeEl) return;

    if (isLoggedIn) {
        const displayName = localUser.Nama ? localUser.Nama.split(' ')[0] : localUser.Username || 'Pengguna';
        
        userNameEl.textContent = displayName;
        SaldoEl.textContent = (localUser.Saldo || 0).toLocaleString('id-ID');
        
        welcomeEl.innerHTML = `Selamat Datang,<br><strong>${displayName}!</strong>`;
        
    } else {
        userNameEl.textContent = "Masuk";
        SaldoEl.textContent = "0"; 
        
        welcomeEl.innerHTML = `Nasuka Foods<br>`; 
    }
}

function updateSaldoDisplay() {
    updateHomeDisplay();
}


function initializeHome() {
  initializeUserProfile();
  updateHomeDisplay();
  
  // LOGIC TEKS BERJALAN DITAMBAHKAN DI SINI
  const runningTextEl = document.getElementById('running-text');
  if (runningTextEl) {
    // Membuat elemen <marquee> secara dinamis
    const marqueeEl = document.createElement('marquee');
    marqueeEl.setAttribute('behavior', 'scroll');
    marqueeEl.setAttribute('direction', 'left');
    marqueeEl.setAttribute('scrollamount', '8'); // Kecepatan scroll
    marqueeEl.textContent = 'Gratis ongkos kirim se cibaduyut raya';
    
    // Mengganti konten <span> dengan elemen <marquee>
    runningTextEl.parentNode.replaceChild(marqueeEl, runningTextEl);
  }
}

function initializeUserProfile() {
  const userID = localStorage.getItem("ID") || "";
  const profilLink = document.getElementById("Profil");
  
  // NOTE: showLogin/showSignup in JavaScript will no longer be used for the icons
  // because they now point to external links. The nav-item 'Akun' still uses showLogin.
  
  if (!userID) {
    if (profilLink) {
      profilLink.href = "#";
      // This is for the top right profile icon, keeping it functional but not a link to prevent accidental navigation
      profilLink.onclick = () => { if (!localStorage.getItem('ID')) showLogin(); else showProfil(); };
    }
    return;
  }
  
  if (profilLink) {
    profilLink.href = "#";
    profilLink.onclick = showProfil;
  }

  if (!localUser.Nama) {
      fetchUserProfileFromDB(userID);
  } else {
      updateProfileDisplay(localUser.Nama, localUser.Foto, userID);
  }
}

function updateProfileDisplay(nama, foto, userID) {
  const profilLink = document.getElementById("Profil");
  if (profilLink) {
    profilLink.onclick = showProfil;
  }
  updateHomeDisplay();
}

function fetchUserProfileFromDB(userID) {
  db.ref(`users/${userID}`).once("value").then(snapshot => {
    const val = snapshot.val();
    if (val) {
      const nama = val.Nama || "Tanpa Nama";
      const foto = val.Foto || "https://nasukafoods.site/gambarkosong.jpg";
      
      localUser.Nama = nama;
      localUser.Foto = foto;
      localUser.Alamat = val.Alamat || "Alamat belum diatur";
      localUser.NomorHP = val.NomorHP || "Nomor HP belum diatur";
      localUser.Saldo = val.Saldo || 0;
      
      localStorage.setItem("Nama", nama);
      localStorage.setItem("Foto", foto);
      localStorage.setItem("Alamat", localUser.Alamat);
      localStorage.setItem("NomorHP", localUser.NomorHP);
      localStorage.setItem("Saldo", localUser.Saldo);

      updateProfileDisplay(nama, foto, userID);
    } else {
      localUser.ID = null;
      localStorage.clear();
      updateHomeDisplay(); 
    }
  }).catch(error => {
      console.error("Error fetching user profile:", error);
      updateHomeDisplay();
  });
}

function hideAllContainers() {
    document.querySelectorAll('#home-container, #login-container, #signup-container, #profil-container, #payment-container, #editprofil-container, #receipt-popup, #video-container, #download-container, #qris-container, #leaderboard-container').forEach(el => { /* Tambahkan #qris-container dan #leaderboard-container */
        if (el) el.style.display = 'none';
    });
}


function showHome() {
    hideAllContainers();
    const homeContainer = document.getElementById('home-container');
    if (homeContainer) {
        homeContainer.style.display = 'block';
        initializeHome();
    }
}

// Keeping showLogin/showSignup for the Nav-Item 'Akun' fallback and switch links in auth popups
function showLogin() {
    hideAllContainers();
    document.getElementById('login-container').style.display = 'flex';
    document.getElementById('loginStatus').innerHTML = '';
    document.getElementById('loginForm').reset();
}

function showSignup() {
    hideAllContainers();
    document.getElementById('signup-container').style.display = 'flex';
    document.getElementById('signupStatus').innerHTML = '';
    document.getElementById('signupForm').reset();
}

function showDownload() {
    hideAllContainers();
    const downloadContainer = document.getElementById('download-container');
    if (downloadContainer) {
        downloadContainer.style.display = 'block'; 
        downloadContainer.scrollTop = 0; 
    }
}

// Fungsi showQris()
function showQris() {
    hideAllContainers();
    const qrisContainer = document.getElementById('qris-container');
    if (qrisContainer) {
        qrisContainer.style.display = 'flex'; 
        qrisContainer.scrollTop = 0; 
    }
}

// Fungsi showLeaderboard() yang baru
function showLeaderboard() {
    hideAllContainers();
    const leaderboardContainer = document.getElementById('leaderboard-container');
    const navLeaderboard = document.getElementById('nav-leaderboard');
    const navHome = document.getElementById('nav-home');
    
    if (leaderboardContainer) {
        leaderboardContainer.style.display = 'flex';
        leaderboardContainer.scrollTop = 0;
    }
    
    // Atur status active di bottom nav
    if (navLeaderboard) navLeaderboard.classList.add('active');
    if (navHome) navHome.classList.remove('active');

    // Logic placeholder untuk Leaderboard
    const leaderboardListEl = document.getElementById('leaderboard-list');
    if (leaderboardListEl) {
        // Contoh data Leaderboard (bisa diganti dengan data dari Firebase di masa depan)
        const mockLeaderboardData = [
            { rank: 1, name: "Setya Ningsih", score: 980900 },
            { rank: 2, name: "Anip", score: 750000 },
            { rank: 3, name: "Salwa Cute", score: 585000 },
            { rank: 4, name: "Farrah", score: 187000 },
            { rank: 5, name: "Norze", score: 84000 },
        ];

        let listHTML = '';
        mockLeaderboardData.forEach(item => {
            listHTML += `
                <div class="leaderboard-item">
                    <span class="leaderboard-rank">${item.rank}</span>
                    <span class="leaderboard-name">${item.name}</span>
                    <span class="leaderboard-score">Rp ${item.score.toLocaleString('id-ID')}</span>
                </div>
            `;
        });
        
        if (mockLeaderboardData.length > 0) {
            leaderboardListEl.innerHTML = listHTML;
        } else {
             leaderboardListEl.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">Belum ada data Leaderboard.</p>';
        }
    }
}
// Akhir fungsi showLeaderboard()


function loginUser() {
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    const statusDiv = document.getElementById('loginStatus');
    statusDiv.className = 'auth-status';
    statusDiv.innerHTML = 'Memproses...';
    if (!username || !password) {
        statusDiv.innerHTML = 'Username dan Password wajib diisi.';
        statusDiv.classList.add('error');
        return;
    }
    db.ref("users").orderByChild("Username").equalTo(username).once("value")
        .then(snapshot => {
            const userData = snapshot.val();
            if (userData) {
                const userKey = Object.keys(userData)[0];
                const user = userData[userKey];
                if (user.Password === password) {
                    localStorage.setItem("ID", user.ID);
                    localStorage.setItem("Username", user.Username);
                    localStorage.setItem("Nama", user.Nama || 'Tanpa Nama');
                    localStorage.setItem("Saldo", user.Saldo || 0);
                    localStorage.setItem("Foto", user.Foto || "https://nasukafoods.site/gambarkosong.jpg");
                    localStorage.setItem("Alamat", user.Alamat || "Alamat belum diatur");
                    localStorage.setItem("NomorHP", user.NomorHP || "Nomor HP belum diatur");
                    localStorage.setItem("TanggalJoin", user.TanggalJoin || new Date().toISOString());

                    localUser.ID = user.ID;
                    localUser.Username = user.Username;
                    localUser.Nama = user.Nama || 'Tanpa Nama';
                    localUser.Saldo = user.Saldo || 0;
                    localUser.Foto = user.Foto || "https://nasukafoods.site/gambarkosong.jpg";
                    localUser.Alamat = user.Alamat || "Alamat belum diatur";
                    localUser.NomorHP = user.NomorHP || "Nomor HP belum diatur";
                    
                    statusDiv.innerHTML = 'Login Berhasil! Mengalihkan...';
                    statusDiv.classList.add('success');
                    setTimeout(showHome, 1500);
                } else {
                    statusDiv.innerHTML = 'Password salah.';
                    statusDiv.classList.add('error');
                }
            } else {
                statusDiv.innerHTML = 'Username tidak ditemukan.';
                statusDiv.classList.add('error');
            }
        })
        .catch(error => {
            statusDiv.innerHTML = 'Terjadi kesalahan saat login.';
            statusDiv.classList.add('error');
        });
}

function signupUser() {
    const username = document.getElementById('signupUsername').value.trim();
    const nama = document.getElementById('signupNama').value.trim();
    const password = document.getElementById('signupPassword').value.trim();
    const statusDiv = document.getElementById('signupStatus');
    statusDiv.className = 'auth-status';
    statusDiv.innerHTML = 'Memproses...';
    if (!username || !nama || !password) {
        statusDiv.innerHTML = 'Semua field wajib diisi.';
        statusDiv.classList.add('error');
        return;
    }
    if (username.length < 5 || password.length < 5) {
        statusDiv.innerHTML = 'Username dan Password harus minimal 5 karakter.';
        statusDiv.classList.add('error');
        return;
    }
    db.ref("users").orderByChild("Username").equalTo(username).once("value")
        .then(snapshot => {
            if (snapshot.exists()) {
                statusDiv.innerHTML = 'Username sudah digunakan. Silakan pilih yang lain.';
                statusDiv.classList.add('error');
            } else {
                const newID = db.ref().child('users').push().key;
                const newUser = {
                    ID: newID,
                    Username: username,
                    Nama: nama,
                    Password: password,
                    Saldo: 500,
                    Foto: "https://nasukafoods.site/gambarkosong.jpg",
                    Jenis: "Member",
                    Alamat: "Alamat belum diatur",
                    NomorHP: "Nomor HP belum diatur",
                    TanggalJoin: new Date().toISOString(), 
                };
                db.ref(`users/${newID}`).set(newUser)
                    .then(() => {
                        localStorage.setItem("ID", newUser.ID);
                        localStorage.setItem("Username", newUser.Username);
                        localStorage.setItem("Nama", newUser.Nama);
                        localStorage.setItem("Saldo", newUser.Saldo);
                        localStorage.setItem("Foto", newUser.Foto);
                        localStorage.setItem("Alamat", newUser.Alamat);
                        localStorage.setItem("NomorHP", newUser.NomorHP);
                        localStorage.setItem("TanggalJoin", newUser.TanggalJoin);
                        
                        localUser.ID = newUser.ID;
                        localUser.Username = newUser.Username;
                        localUser.Nama = newUser.Nama;
                        localUser.Saldo = newUser.Saldo;
                        localUser.Foto = newUser.Foto;
                        localUser.Alamat = newUser.Alamat;
                        localUser.NomorHP = newUser.NomorHP;
                        
                        statusDiv.innerHTML = 'Pendaftaran Berhasil! Anda mendapatkan 500 Saldo gratis. Mengalihkan ke Beranda...';
                        statusDiv.classList.add('success');
                        setTimeout(showHome, 1500);
                    })
                    .catch(error => {
                        statusDiv.innerHTML = 'Gagal mendaftar. Silakan coba lagi.';
                        statusDiv.classList.add('error');
                    });
            }
        })
        .catch(error => {
            statusDiv.innerHTML = 'Terjadi kesalahan sistem. Silakan coba lagi.';
            statusDiv.classList.add('error');
        });
}

function logoutUser() {
    if (confirm("Anda yakin ingin keluar?")) {
        localStorage.clear(); 
        
        localUser.ID = null;
        localUser.Username = null;
        localUser.Nama = null;
        localUser.Saldo = 0;
        localUser.Alamat = "Alamat belum diatur";
        localUser.NomorHP = "Nomor HP belum diatur";
        localUser.Foto = "https://nasukafoods.site/gambarkosong.jpg";
        
        alert("Anda telah keluar.");
        showHome();
    }
}

function showProfil() {
    hideAllContainers();
    const userID = localStorage.getItem("ID");
    if (!userID) {
        alert("Silahkan login terlebih dahulu.");
        showLogin();
        return;
    }
    
    const profilContainer = document.getElementById('profil-container');
    profilContainer.style.display = 'block'; 
    
    // Pastikan nav-item 'Akun' aktif dan yang lain tidak
    document.querySelectorAll('.bottom-nav .nav-item').forEach(item => {
        item.classList.remove('active');
    });
    const navAkun = document.querySelector('.bottom-nav').lastElementChild;
    if(navAkun) navAkun.classList.add('active');


    const renderProfil = () => {
        const nama = localUser.Nama || 'Nama belum diatur';
        const foto = localUser.Foto || "https://nasukafoods.site/gambarkosong.jpg";
        const Saldo = (localUser.Saldo || 0).toLocaleString('id-ID');
        
        const tanggalJoinISO = localStorage.getItem("TanggalJoin") || new Date().toISOString();
        const tanggalObj = new Date(tanggalJoinISO);
        const bulanJoin = tanggalObj.toLocaleString('id-ID', { month: 'short', year: 'numeric' });
        
        const displayNomorHP = localUser.NomorHP || 'Nomor HP belum diatur'; 
        
        
        document.getElementById('profilFoto').src = foto;
        document.getElementById('profilNamaDriver').textContent = nama;
        document.getElementById('profilBulanJoin').textContent = bulanJoin;
        
        
        document.getElementById('profilIDPlat').textContent = 'Nomor HP: ' + displayNomorHP; 
        
        document.getElementById('profilSaldoDisplay').textContent = Saldo + ' Saldo';
        
        const alamatPengirimanEl = document.getElementById('profilAlamatPengiriman');
        if (alamatPengirimanEl) {
            alamatPengirimanEl.textContent = localUser.Alamat || "Alamat belum diatur";
        }
        
        const safetyReport = document.querySelector('.safety-report');
        if (safetyReport) {
             safetyReport.onclick = showHistory;
        }

        
        document.getElementById('profilRatingScore').textContent = '5.00';
        document.getElementById('ratingCount5').textContent = '10';
        document.getElementById('ratingCount4').textContent = '0';
        document.getElementById('ratingCount3').textContent = '0';
        document.getElementById('ratingCount2').textContent = '0';
        document.getElementById('ratingCount1').textContent = '0';
        
        updateHomeDisplay();
    };
    
    renderProfil(); 
    
    const tabPencapaian = document.getElementById('tabPencapaian');
    const tabPerbaikan = document.getElementById('tabPerbaikan');
    const contentPencapaian = document.getElementById('contentPencapaian');
    const contentPerbaikan = document.getElementById('contentPerbaikan');
    
    const switchTab = (activeTab) => {
        tabPencapaian.classList.remove('active');
        tabPerbaikan.classList.remove('active');
        contentPencapaian.style.display = 'none';
        contentPerbaikan.style.display = 'none';

        if (activeTab === 'pencapaian') {
            tabPencapaian.classList.add('active');
            contentPencapaian.style.display = 'block';
             if (contentPencapaian.querySelector('#history-list')) {
                contentPencapaian.innerHTML = `
                    <div class="badge-section">
                        <h4>Informasi</h4>
                        <div class="badge-card">
                            <img src="https://nasukafoods.site/nasukafoods.jpg" alt="Lencana" class="badge-image">
                            <div class="badge-text">
                                <strong>Alamat pengiriman</strong>
                                <span id="profilAlamatPengiriman">${localUser.Alamat || "Alamat belum diatur"}</span>
                            </div>
                        </div>
                    </div>
                    <div class="passenger-comments">
                        <h4>Apa Kata Anda</h4>
                        <img src="https://nasukafoods.site/nasukafoods.jpg" alt="Mencari Komentar" class="magnifying-glass">
                        <p style="text-align: center; color: #666; margin-top: 10px;">Belum ada kata kata untuk ditampilkan</p>
                    </div>
                `;
            }
        } else {
            tabPerbaikan.classList.add('active');
            contentPerbaikan.style.display = 'block';
        }
    };
    
    tabPencapaian.onclick = () => switchTab('pencapaian');
    tabPerbaikan.onclick = () => switchTab('perbaikan');
    
    switchTab('pencapaian');
}

function showHistory() {
    const contentPencapaian = document.getElementById('contentPencapaian');
    
    contentPencapaian.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <h4 style="margin-top: 0; color: #333; font-size: 16px; font-weight: 600;">Riwayat Pembelian</h4>
            <div id="history-list" style="margin-top: 15px; background-color: white; padding: 10px; border-radius: 8px;">
                <p style="color: #007bff;"><i class="fas fa-spinner fa-spin"></i> Memuat riwayat...</p>
            </div>
            <button onclick="showProfil()" style="margin-top: 20px; padding: 10px 20px; background-color: #f44336; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                Kembali ke Profil
            </button>
        </div>
    `;
    
    document.getElementById('tabPencapaian').classList.add('active');
    document.getElementById('tabPerbaikan').classList.remove('active');

    db.ref(`transactions/${localUser.ID}`).orderByChild('timestamp').limitToLast(20).once('value')
        .then(snapshot => {
            const historyListEl = document.getElementById('history-list');
            historyListEl.innerHTML = ''; 
            const transactions = [];
            snapshot.forEach(childSnapshot => {
                transactions.push(childSnapshot.val());
            });
            
            if (transactions.length === 0) {
                historyListEl.innerHTML = '<p style="color: #666; font-style: italic;">Belum ada riwayat pembelian.</p>';
                return;
            }

            transactions.reverse(); 

            transactions.forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleString('id-ID', { dateStyle: 'medium', timeStyle: 'short' });
                const txItem = document.createElement('div');
                txItem.style.cssText = `
                    padding: 10px 0;
                    border-bottom: 1px solid #eee;
                    text-align: left;
                    cursor: pointer;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                txItem.innerHTML = `
                    <div>
                        <strong style="color: ${tx.status === 'Success' ? '#28a745' : '#f44336'};">${tx.productName}</strong><br>
                        <span style="font-size: 12px; color: #666;">${date} | ID: ${tx.transactionID.substring(0, 8)}...</span><br>
                        <span style="font-size: 14px; font-weight: 500;">Dipotong: -${tx.amount.toLocaleString('id-ID')} Saldo</span>
                    </div>
                    <i class="fas fa-chevron-right" style="font-size: 12px; color: #999;"></i>
                `;
                txItem.onclick = () => {
                    alert(`Detail Transaksi:\nID: ${tx.transactionID}\nProduk: ${tx.productName}\nJumlah Saldo: ${tx.amount.toLocaleString('id-ID')}\nStatus: ${tx.status}\nTanggal: ${date}\nAlamat Kirim: ${tx.deliveryAddress}`);
                };
                historyListEl.appendChild(txItem);
            });
        })
        .catch(error => {
            document.getElementById('history-list').innerHTML = `<p style="color: red;">Gagal memuat riwayat: ${error.message}</p>`;
        });
}

function showEditProfil() {
    hideAllContainers();
    const editContainer = document.getElementById('editprofil-container');
    editContainer.style.display = 'flex'; 

    const currentUsername = localUser.Username || '';
    const currentNama = localUser.Nama || '';
    const currentNomorHP = localUser.NomorHP === 'Nomor HP belum diatur' ? '' : localUser.NomorHP; 
    const currentAlamat = localUser.Alamat === 'Alamat belum diatur' ? '' : localUser.Alamat; 
    const currentFoto = localUser.Foto || "https://nasukafoods.site/gambarkosong.jpg";
    
    editContainer.style.position = 'fixed';
    editContainer.style.top = '0';
    editContainer.style.left = '0';
    editContainer.style.width = '100%';
    editContainer.style.height = '100%';
    editContainer.style.zIndex = '200003';
    editContainer.style.padding = '0';
    editContainer.style.backgroundColor = '#f0f2f5'; 
    editContainer.style.alignItems = 'flex-start'; 
    editContainer.style.overflowY = 'auto'; 

    editContainer.innerHTML = `
        <div class="auth-card">
            
            <div class="edit-header-nav">
                <i class="fas fa-arrow-left" onclick="showProfil()"></i>
                <h3>Edit Profil</h3>
                <i class="fas fa-question-circle"></i>
            </div>
            
            <div class="edit-profile-photo-section">
                <img id="editFotoProfil" class="edit-profile-photo" src="${currentFoto}" alt="Foto Profil">
                <div class="change-photo-text" onclick="alert('Fitur ganti foto belum tersedia.')">Ubah foto profil</div>
            </div>

            <form id="editProfilForm">
                <div class="edit-form-section">
                    <h4>Informasi Akun</h4>
                    <div class="form-group">
                        <label for="editUsername">Username</label>
                        <input type="text" id="editUsername" placeholder="Username" value="${currentUsername}" required>
                    </div>
                    <div class="form-group">
                        <label for="editNama">Nama Lengkap</label>
                        <input type="text" id="editNama" placeholder="Nama Lengkap" value="${currentNama}" required>
                    </div>
                    <div class="form-group">
                        <label for="editPassword">Password Baru (Kosongkan jika tidak ingin ganti)</label>
                        <input type="password" id="editPassword" placeholder="Password Baru">
                    </div>
                </div>

                <div class="edit-form-section">
                    <h4>Informasi Kontak & Pengiriman</h4>
                    <div class="form-group">
                        <label for="editNomorHP">Nomor HP</label>
                        <input type="text" id="editNomorHP" placeholder="Nomor HP" value="${currentNomorHP}" required>
                    </div>
                    <div class="form-group">
                        <label for="editAlamat">Alamat Pengiriman</label>
                        <textarea id="editAlamat" placeholder="Alamat Pengiriman" rows="3" required>${currentAlamat}</textarea>
                    </div>
                </div>

                <button type="submit">Simpan Perubahan</button>
                <div id="editStatus" class="auth-status" style="margin-bottom: 10px; margin-top: 0;"></div>
            </form>
            
            <div class="edit-footer-buttons" style="padding-bottom: 20px;">
                <button onclick="showProfil()" class="btn-batal">Batal</button>
               
            </div>
        </div>
    `;
    document.getElementById('editProfilForm').addEventListener('submit', function(e) {
        e.preventDefault();
        updateProfile();
    });
}

function updateProfile() {
    const userID = localUser.ID;
    const newUsername = document.getElementById('editUsername').value.trim();
    const nama = document.getElementById('editNama').value.trim();
    const nomorHP = document.getElementById('editNomorHP').value.trim();
    const alamat = document.getElementById('editAlamat').value.trim();
    const password = document.getElementById('editPassword').value.trim();
    const statusDiv = document.getElementById('editStatus');
    statusDiv.className = 'auth-status';
    statusDiv.innerHTML = 'Menyimpan...';
    
    if (!newUsername || !nama || !nomorHP || !alamat) {
        statusDiv.innerHTML = 'Username, Nama, Nomor HP, dan Alamat wajib diisi.';
        statusDiv.classList.add('error');
        return;
    }
    if (newUsername.length < 5) {
        statusDiv.innerHTML = 'Username minimal 5 karakter.';
        statusDiv.classList.add('error');
        return;
    }
    if (password && password.length < 5) {
        statusDiv.innerHTML = 'Password minimal 5 karakter.';
        statusDiv.classList.add('error');
        return;
    }

    const updates = {
        Nama: nama,
        NomorHP: nomorHP,
        Alamat: alamat
    };
    if (password) {
        updates.Password = password;
    }

    const processUpdate = () => {
        db.ref(`users/${userID}`).update(updates)
            .then(() => {
                localUser.Username = newUsername;
                localUser.Nama = nama;
                localUser.NomorHP = nomorHP;
                localUser.Alamat = alamat;
                localStorage.setItem("Username", newUsername);
                localStorage.setItem("Nama", nama);
                localStorage.setItem("NomorHP", nomorHP);
                localStorage.setItem("Alamat", alamat);
                
                statusDiv.innerHTML = 'Profil berhasil diperbarui!';
                statusDiv.classList.add('success');
                updateProfileDisplay(localUser.Nama, localUser.Foto, localUser.ID);
                setTimeout(showProfil, 1500);
            })
            .catch(error => {
                statusDiv.innerHTML = 'Gagal memperbarui profil. Silakan coba lagi.';
                statusDiv.classList.add('error');
            });
    };

    if (newUsername !== localUser.Username) {
        db.ref("users").orderByChild("Username").equalTo(newUsername).once("value")
            .then(snapshot => {
                let isTaken = false;
                snapshot.forEach(child => {
                    if (child.val().ID !== userID) {
                        isTaken = true;
                    }
                });
                if (isTaken) {
                    statusDiv.innerHTML = 'Username sudah digunakan oleh pengguna lain. Silakan pilih yang lain.';
                    statusDiv.classList.add('error');
                } else {
                    updates.Username = newUsername;
                    processUpdate();
                }
            })
            .catch(error => {
                statusDiv.innerHTML = 'Terjadi kesalahan saat memeriksa username.';
                statusDiv.classList.add('error');
            });
    } else {
        processUpdate();
    }
}


function logPurchaseToDB(productName, amount, newSaldo) {
    const userID = localUser.ID;
    if (!userID) return; 

    const transactionRef = db.ref(`transactions/${userID}`).push();
    const transactionID = transactionRef.key;
    const timestamp = new Date().toISOString();
    
    const transactionData = {
        transactionID: transactionID,
        userID: userID,
        productName: productName,
        amount: amount,
        timestamp: timestamp,
        status: 'Success',
        initialSaldo: localUser.Saldo + amount, 
        finalSaldo: newSaldo,
        deliveryAddress: localUser.Alamat,
        deliveryContact: localUser.NomorHP
    };

    transactionRef.set(transactionData)
        .then(() => {
            console.log("Transaction logged successfully with ID:", transactionID);
        })
        .catch(error => {
            console.error("Failed to log transaction:", error);
        });
        
    return transactionData;
}

function generateReceiptHTML(txData) {
    const date = new Date(txData.timestamp);
    const dateString = date.toLocaleString('id-ID', { dateStyle: 'medium' });
    const timeString = date.toLocaleString('id-ID', { timeStyle: 'short' });
    const totalSaldo = txData.amount.toLocaleString('id-ID');

    return `
        <div style="font-family: 'Courier New', Courier, monospace; font-size: 14px; color: #333; line-height: 1.4;">
            <h3 style="text-align: center; margin: 0 0 5px 0; font-size: 18px; font-weight: bold;">NASUKA FOODS</h3>
            <div style="text-align: center; margin-bottom: 15px;">Pembayaran Nasuka Pay</div>
            <div style="border-top: 1px dashed #333; border-bottom: 1px dashed #333; padding: 10px 0; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between;">
                    <span>TGL/JAM:</span>
                    <span>${dateString} ${timeString}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>TRX ID:</span>
                    <span>${txData.transactionID.substring(0, 15)}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>PELANGGAN:</span>
                    <span>${localUser.Nama}</span>
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 5px;">
                    <span>PRODUK</span>
                    <span>Harga</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>1 x ${txData.productName}</span>
                    <span>${totalSaldo}</span>
                </div>
            </div>

            <div style="border-top: 1px dashed #333; padding-top: 10px;">
                <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 16px;">
                    <span>Dibayar lunas:</span>
                    <span style="color: #f44336;">${totalSaldo}</span>
                </div>
            </div>
            
            <div style="margin-top: 15px; border-top: 1px dashed #333; padding-top: 10px;">
                <div style="font-weight: bold;">SISA Saldo ANDA:</div>
                <div style="font-size: 18px; color: #007bff; text-align: right; margin-top: 5px;">
                    ${txData.finalSaldo.toLocaleString('id-ID')}
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px; font-size: 12px; font-style: italic;">
                Terima kasih telah berbelanja! <br> Pesanan akan dikirim ke: <br> ${txData.deliveryAddress}
            </div>
        </div>
    `;
}

function hideReceiptAndShowHome() {
    document.getElementById('receipt-popup').style.display = 'none';
    showHome();
}

function processSaldoPayment(amount, productName) {
    const statusDiv = document.getElementById('payment-status');
    statusDiv.innerHTML = '';
    
    if (localUser.Saldo < amount) {
        statusDiv.innerHTML = `<div class="auth-status error" style="margin-top: 0; margin-bottom: 0;">Saldo Anda (${(localUser.Saldo || 0).toLocaleString('id-ID')}) tidak cukup untuk membeli ${productName} (${amount.toLocaleString('id-ID')}.</div>`;
        return;
    }
    
    if (!confirm(`Anda yakin ingin membeli "${productName}" seharga ${amount.toLocaleString('id-ID')} ?`)) {
        return;
    }
    
    const initialSaldo = localUser.Saldo;
    const newSaldo = initialSaldo - amount;
    statusDiv.innerHTML = `<div class="auth-status" style="background-color: #fff3e0; color: #ff9800; margin-top: 0; margin-bottom: 0;">Memproses pembelian...</div>`;
    
    db.ref(`users/${localUser.ID}`).update({ Saldo: newSaldo })
        .then(() => {
            localUser.Saldo = newSaldo;
            localStorage.setItem("Saldo", newSaldo);
            updateSaldoDisplay();
            
            const transactionData = logPurchaseToDB(productName, amount, newSaldo);
            
            statusDiv.innerHTML = `
                <div class="auth-status success" style="margin-top: 0; margin-bottom: 0;">
                    Pembelian Berhasil! ✅ Menampilkan struk...
                </div>
            `;
            
            document.getElementById('receipt-content').innerHTML = generateReceiptHTML(transactionData);
            document.getElementById('payment-container').style.display = 'none';
            document.getElementById('receipt-popup').style.display = 'flex';

        })
        .catch(error => {
            statusDiv.innerHTML = `<div class="auth-status error" style="margin-top: 0; margin-bottom: 0;">Pembelian gagal. Silakan coba lagi.</div>`;
        });
}

function showPayment(productName, productDescription, productPrice, productImageUrls, manualDescription) {
    hideAllContainers();
    if (!localStorage.getItem("ID")) {
        alert("Silahkan login terlebih dahulu untuk melanjutkan pembelian.");
        showLogin();
        return;
    }
    if (localUser.Alamat === "Alamat belum diatur" || localUser.NomorHP === "Nomor HP belum diatur") {
         alert("Mohon lengkapi Alamat Pengiriman dan Nomor HP Anda di menu Edit Profil sebelum melakukan pembelian.");
         showEditProfil();
         return;
    }
    
    const userName = localUser.Nama || "Nama belum di seting";
    const userAddress = localUser.Alamat || "Alamat pengantaran belum di seting";
    const userNomorHP = localUser.NomorHP || "Nomor HP belum di seting";
    const productPriceInSaldo = productPrice; 
    const paymentContainer = document.getElementById('payment-container');
    
    paymentContainer.style.display = 'flex';
    paymentContainer.style.backgroundColor = '#f0f2f5'; 

    const imageUrl = (productImageUrls && productImageUrls.length > 0) ? productImageUrls[0] : 'https://nasukafoods.site/cilokpro.jpg';


    paymentContainer.innerHTML = `
        <div class="payment-card-modified">
            
            <div class="payment-header">
                <i class="fas fa-arrow-left" onclick="showHome()"></i>
                <h3>Detail Produk</h3>
            </div>
            
            <div class="product-image-container">
                <img src="${imageUrl}" alt="${productName}">
            </div>

            <div class="product-details-section">
                <h4>${productName}</h4>
                <div class="product-price-display">
                    Harga: ${productPriceInSaldo.toLocaleString('id-ID')}
                </div>
                <p class="product-description-text">
                    ${productDescription}
                </p>
                <p class="product-keterangan-manual">
                    ${manualDescription}
                </p>
            </div>

            <div class="payment-info-section">
                <div style="font-size: 16px; font-weight: 600; margin-bottom: 10px; color: #333;">Info Pembeli & Pengiriman</div>
                
                <div class="info-row">
                    <span class="info-label">Pembeli</span>
                    <span class="info-value">${userName}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Nomor HP</span>
                    <span class="info-value">${userNomorHP}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Alamat Kirim</span>
                    <span class="info-value address">${userAddress}</span>
                </div>
                <div class="info-row Saldo-row">
                    <span class="info-label">Saldo Anda</span>
                    <span class="info-value" style="color: #007bff;">${(localUser.Saldo || 0).toLocaleString('id-ID')}</span>
                </div>
                <div class="info-row total-bayar-row">
                    <span class="info-label" style="color: #333;">Harga yang akan di bayar</span>
                    <span class="info-value">${productPriceInSaldo.toLocaleString('id-ID')}</span>
                </div>
            </div>
            
            <div id="payment-status" style="margin: 0 15px 15px 15px;"></div>

            <div class="payment-action-section">
                <button class="btn-bayar-Saldo" onclick="processSaldoPayment(${productPriceInSaldo}, '${productName}')">
                    Bayar ${productPriceInSaldo.toLocaleString('id-ID')} Sekarang
                </button>
            </div>
            
        </div>
    `;
    
}

function showVideo() {
    hideAllContainers();
    const videoContainer = document.getElementById('video-container');
    if (videoContainer) {
        videoContainer.style.display = 'flex';
    }

    const videoListEl = document.getElementById('video-list');
    if (!videoListEl) return;

    const videos = [
        { 
            title: "Nasuka Foods (Cilok Isian Gajih)", 
            uploader: "Natasya", 
            views: "2.2 Juta ", 
            videoUrl: "https://nasukafoods.site/nasukaads1.mp4", 
            posterUrl: "https://nasukafoods.site/cilokpro.jpg" 
        },
        { 
            title: "Logo", 
            uploader: "Supria", 
            views: "1.7 Juta ", 
            videoUrl: "https://nasukafoods.site/nasukaads2.mp4", 
            posterUrl: "https://nasukafoods.site/nasukafoods.jpg" 
        },
        { 
            title: "Produksi", 
            uploader: "Karlina", 
            views: "1.2 Juta ", 
            videoUrl: "https://nasukafoods.site/nasukaads3.mp4", 
            posterUrl: "https://nasukafoods.site/gambarkosong.jpg" 
        }
    ];

    videoListEl.innerHTML = ''; 

    videos.forEach(video => {
        const videoItem = document.createElement('div');
        videoItem.className = 'video-item';
        
        videoItem.innerHTML = `
            <div class="video-thumbnail">
                <video controls controlslist="nodownload" poster="${video.posterUrl}">
                    <source src="${video.videoUrl}" type="video/mp4">
                    Browser Anda tidak mendukung tag video.
                </video>
            </div>
            <div class="video-details">
                <h4>${video.title}</h4>
                <p>Oleh: ${video.uploader} | ${video.views}x ditonton</p>
            </div>
        `;
        
        videoListEl.appendChild(videoItem);
    });
    
    if (videos.length === 0) {
        videoListEl.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">Tidak ada video untuk saat ini.</p>';
    }
}


document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    loginUser();
});
document.getElementById('signupForm').addEventListener('submit', function(e) {
    e.preventDefault();
    signupUser();
});


$(document).ready(function() {
    showHome(); 
});
</script>

</body>
</html>
