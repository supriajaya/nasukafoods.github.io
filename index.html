<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nasuka.apk</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      color: white;
      background-color: black;
    }

    /* Top Bar */
    .top-bar {
      position: fixed;
      top: 0;
      width: 100%;
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      font-size: 12px;
      z-index: 999;
      background-color: rgba(0, 0, 0, 0.8);
    }

    .top-bar a {
      color: white;
      text-decoration: none;
      text-align: center;
    }

    /* Hero Section */
    .hero-section {
      position: relative;
      height: 20vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .hero-section video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .promo-text,
    .info,
    .sidebar {
     position: relative;
     z-index: 1;
    }

    .info, .sidebar {
      position: absolute;
      bottom: 20px;
    }

    .info {
      left: 10px;
    }

    .info .location {
      font-size: 12px;
      color: #ccc;
    }

    .info .username {
      font-weight: bold;
    }

    .info .desc {
      font-size: 14px;
      margin-top: 5px;
    }

    .info .music {
      font-size: 12px;
      color: #ffbb00;
    }

    .sidebar {
      right: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .sidebar div {
      margin: 8px 0;
      font-size: 12px;
    }

    /* Product Section */
    .product-list {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding: 10px;
      gap: 15px;
      margin-top: 10px;
    }

    .product-card {
      min-width: 75px; 
      text-align: center;
      color: white;
      text-decoration: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
    }

    .product-image-container {
      width: 75px; 
      height: 75px;
      overflow: hidden;
    }

    .product-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .product-title {
      font-size: 10px; 
      margin-top: 4px;
    }

    .product-price {
      font-weight: bold;
      font-size: 9px;
      margin-top: 2px;
      color: #ffbb00;
    }

    /* Modal Styles (Login, Topup, & Profile) */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.9);
      padding-top: 60px;
    }

    .modal-content {
      background-color: #1a1a1a;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 400px;
      border-radius: 8px;
    }

    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close-button:hover,
    .close-button:focus {
      color: #ffbb00;
      text-decoration: none;
      cursor: pointer;
    }

    .form-group {
        margin-bottom: 20px;
        text-align: left;
    }
    label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
    }
    input[type="text"], input[type="password"], input[type="number"], select {
        width: 100%;
        padding: 12px;
        border: 1px solid #333;
        background-color: #333;
        color: white;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
    }
    button[type="submit"] {
        width: 100%;
        padding: 15px;
        background-color: #25D366;
        border: none;
        color: white;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        border-radius: 4px;
        margin-top: 10px;
    }
    button[type="submit"]:hover {
        background-color: #1a8a47;
    }
    .status-message {
        margin-top: 20px;
        font-weight: bold;
        text-align: center;
    }
    .error {
        color: #dc3545;
    }
    .success {
        color: #25D366;
    }
    .register-link {
        margin-top: 15px;
        font-size: 14px;
        text-align: center;
    }
    .register-link a {
        color: #ffbb00;
        text-decoration: none;
    }

    /* Profile specific styles */
    .profile-info p {
        margin: 10px 0;
        padding-bottom: 5px;
        border-bottom: 1px solid #333;
    }
    .profile-info strong {
        color: #ffbb00;
    }
  </style>
</head>

<body>

  <div class="top-bar" id="top-bar-links">
    </div>

  <section class="hero-section">
    <video src="https://nasukafoods.site/kawasakih2.mp4" autoplay muted loop playsinline></video>
    <div class="info">
      <div class="location">Jawa Barat</div>
      <div class="username" id="user-greeting">Proyek Apk</div>
      <div class="desc">Pembangunan aplikasi</div>
      <div class="music">üéµ Nasuka Labs</div>
    </div>
    <div class="sidebar">
      <div>‚ù§Ô∏è 200.k</div>
      <div>üí¨ 4.M</div>
      <div>üîó Share</div>
    </div>
  </section>

  <div class="product-list">
    <a onclick="addToCart(this)" class="product-card">
      <div class="product-image-container">
        <img class="product-image" src="https://nasukafoods.site/wireless.jpg" alt="Produk 1">
      </div>
      <div class="product-title">Produk 1</div>
      <div class="product-price">Rp 50.000</div>
    </a>
    <a onclick="addToCart(this)" class="product-card">
      <div class="product-image-container">
        <img class="product-image" src="https://nasukafoods.site/wireless.jpg" alt="Produk 2">
      </div>
      <div class="product-title">Produk 2</div>
      <div class="product-price">Rp 75.000</div>
    </a>
    <a onclick="addToCart(this)" class="product-card">
      <div class="product-image-container">
        <img class="product-image" src="https://nasukafoods.site/wireless.jpg" alt="Produk 3">
      </div>
      <div class="product-title">Produk 3</div>
      <div class="product-price">Rp 120.000</div>
    </a>
    <a onclick="addToCart(this)" class="product-card">
      <div class="product-image-container">
        <img class="product-image" src="https://nasukafoods.site/wireless.jpg" alt="Produk 4">
      </div>
      <div class="product-title">Produk 4</div>
      <div class="product-price">Rp 45.000</div>
    </a>
  </div>

  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeLoginModal()">&times;</span>
      <h2 style="color: #ffbb00; text-align: center;">Login Member</h2>
      <form id="modalLoginForm">
          <div class="form-group">
              <label for="modalUsername">Username:</label>
              <input type="text" id="modalUsername" name="Username" required>
          </div>
          <div class="form-group">
              <label for="modalPassword">Password:</label>
              <input type="password" id="modalPassword" name="Password" required>
          </div>
          <button type="submit" id="modalLoginButton">Masuk</button>
      </form>
      <div id="modalStatusMessage" class="status-message"></div>
      <div class="register-link">
          Belum punya akun? <a href="daftar.html">Daftar sekarang</a>
      </div>
    </div>
  </div>

  <div id="topupModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeTopupModal()">&times;</span>
      <h2 style="color: #ffbb00; text-align: center;">Top Up Saldo</h2>
      <form id="modalTopupForm">
        <div class="form-group">
            <label for="topupAmount">Jumlah Deposit (Rp):</label>
            <input type="number" id="topupAmount" name="JumlahDeposit" min="10000" required>
        </div>
        <div class="form-group">
            <label for="paymentMethod">Metode Pembayaran:</label>
            <select id="paymentMethod" name="MetodePembayaran" required>
                <option value="">Pilih Metode</option>
                <option value="Transfer Bank">Transfer Bank</option>
                <option value="Dana">Dana</option>
                <option value="GoPay">GoPay</option>
            </select>
        </div>
        <button type="submit" id="modalTopupButton">Ajukan Top Up</button>
      </form>
      <div id="modalTopupStatus" class="status-message"></div>
    </div>
  </div>

  <div id="profileModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeProfileModal()">&times;</span>
      <h2 style="color: #ffbb00; text-align: center;">Profil Pengguna</h2>
      <div class="profile-info" id="profileInfoContent">
        </div>
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="logout()" style="width: auto; padding: 10px 20px; background-color: #dc3545;">Logout</button>
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby84KGedeLwHiRBb4O0_rkzhYQh6r2-HgwtD_gcq6ubVwFy8jn_GbSxiBjctKm2b9ruZg/exec';

    function addToCart(element) {
      const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
      
      if (!isLoggedIn) {
        alert('Anda harus login terlebih dahulu untuk menambahkan produk ke keranjang.');
        openLoginModal();
        return;
      }
      
      const title = element.querySelector('.product-title').innerText;
      const price = element.querySelector('.product-price').innerText;
      const img = element.querySelector('.product-image').src;
      
      const product = { 
          name: title, 
          price: price, 
          image: img,
          quantity: 1 
      };

      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart.push(product);

      localStorage.setItem('cart', JSON.stringify(cart));
      alert(`${title} berhasil ditambahkan ke keranjang.`);
    }

    function updateUIBasedOnLoginStatus() {
        const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
        const userData = localStorage.getItem('userData');
        const topBarLinks = document.getElementById('top-bar-links');
        const userGreeting = document.getElementById('user-greeting');

        let linksHTML = '';

        if (isLoggedIn && userData) {
            try {
                const user = JSON.parse(userData);
                
                if (user['Nama Lengkap']) {
                    userGreeting.textContent = user['Nama Lengkap'];
                } else if (user['Username']) {
                    userGreeting.textContent = user['Username'];
                }

                // Links for logged-in users
                linksHTML = `
                    <a href="index.html">üè†<br>Home</a>
                    <a href="#" onclick="openTopupModal()">üí∞<br>Topup</a>
                    <a href="#" onclick="openProfileModal()">üëÆ<br>Profil</a>
                    <a href="keranjang.html">üõí <br>Keranjang</a>
                `;
            } catch (e) {
                // If userData is corrupt, log out and reset
                localStorage.removeItem('userLoggedIn');
                localStorage.removeItem('userData');
                updateUIBasedOnLoginStatus(); 
                return;
            }
        } else {
            userGreeting.textContent = 'Proyek Apk'; 
            // Links for non-logged-in users
            linksHTML = `
                <a href="index.html">üè†<br>Home</a>
                <a href="login.html">üì•<br>Login</a>
                <a href="pendaftaran.html">üìù<br>Daftar</a>
                <a href="keranjang-non-member.html">üõí <br>Keranjang</a>
            `;
        }

        topBarLinks.innerHTML = linksHTML;
    }

    function logout() {
        localStorage.removeItem('userLoggedIn');
        localStorage.removeItem('userData');
        localStorage.removeItem('cart'); // Clear cart on logout
        window.location.href = 'index.html'; 
    }

    // --- Login Modal Functions ---
    const loginModal = document.getElementById('loginModal');
    const modalLoginForm = document.getElementById('modalLoginForm');
    const modalLoginButton = document.getElementById('modalLoginButton');
    const modalStatusMessage = document.getElementById('modalStatusMessage');

    function openLoginModal() {
        loginModal.style.display = 'block';
    }

    function closeLoginModal() {
        loginModal.style.display = 'none';
        modalStatusMessage.textContent = ''; 
        modalLoginButton.textContent = 'Masuk';
        modalLoginButton.disabled = false;
        modalLoginForm.reset();
    }

    // Handle login form submission inside the modal
    modalLoginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        modalLoginButton.disabled = true;
        modalLoginButton.textContent = 'Memproses...';
        modalStatusMessage.textContent = '';
        modalStatusMessage.classList.remove('success', 'error');

        const username = document.getElementById('modalUsername').value;
        const password = document.getElementById('modalPassword').value;

        const payload = new URLSearchParams({
            action: 'login',
            Username: username,
            Password: password
        });

        try {
            const response = await fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: payload.toString(),
            });

            const result = await response.json();

            if (result.status === 'success') {
                modalStatusMessage.textContent = 'Login berhasil. Mengalihkan...';
                modalStatusMessage.classList.add('success');
                
                // Store user data in localStorage
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userData', JSON.stringify(result.user));

                // Redirect or refresh UI after successful login
                setTimeout(() => {
                    closeLoginModal();
                    updateUIBasedOnLoginStatus();
                }, 500);

            } else {
                modalStatusMessage.textContent = result.message || 'Login gagal. Periksa username dan password Anda.';
                modalStatusMessage.classList.add('error');
                modalLoginButton.disabled = false;
                modalLoginButton.textContent = 'Masuk';
            }
        } catch (error) {
            modalStatusMessage.textContent = 'Terjadi kesalahan jaringan atau server.';
            modalStatusMessage.classList.add('error');
            modalLoginButton.disabled = false;
            modalLoginButton.textContent = 'Masuk';
        }
    });

    // --- Topup Modal Functions ---
    const topupModal = document.getElementById('topupModal');
    const modalTopupForm = document.getElementById('modalTopupForm');
    const modalTopupButton = document.getElementById('modalTopupButton');
    const modalTopupStatus = document.getElementById('modalTopupStatus');

    function openTopupModal() {
        const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
        if (!isLoggedIn) {
            openLoginModal();
            return;
        }
        topupModal.style.display = 'block';
    }

    function closeTopupModal() {
        topupModal.style.display = 'none';
        modalTopupStatus.textContent = '';
        modalTopupButton.textContent = 'Ajukan Top Up';
        modalTopupButton.disabled = false;
        modalTopupForm.reset();
    }

    // Handle topup form submission
    modalTopupForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const userData = JSON.parse(localStorage.getItem('userData'));
        if (!userData) {
            modalTopupStatus.textContent = 'Sesi login berakhir. Silakan login kembali.';
            modalTopupStatus.classList.add('error');
            return;
        }

        modalTopupButton.disabled = true;
        modalTopupButton.textContent = 'Mengirim Permintaan...';
        modalTopupStatus.textContent = '';
        modalTopupStatus.classList.remove('success', 'error');

        const amount = document.getElementById('topupAmount').value;
        const method = document.getElementById('paymentMethod').value;
        const customerName = userData['Nama Lengkap'];
        const customerPhone = userData['Nomor HP'];
        
        // Ensure data is available
        if (!customerName || !customerPhone) {
             modalTopupStatus.textContent = 'Data pengguna tidak lengkap. Silakan perbarui profil Anda.';
             modalTopupStatus.classList.add('error');
             modalTopupButton.disabled = false;
             modalTopupButton.textContent = 'Ajukan Top Up';
             return;
        }

        const payload = new URLSearchParams({
            action: 'recordDeposit',
            Tanggal: new Date().toISOString().slice(0, 10),
            NamaPelanggan: customerName,
            NomorHP: customerPhone,
            JumlahDeposit: amount,
            MetodePembayaran: method,
            Status: 'Pending'
        });

        try {
            const response = await fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: payload.toString(),
            });

            const result = await response.json();

            if (result.status === 'success') {
                modalTopupStatus.textContent = 'Pengajuan top up berhasil. Silakan lakukan transfer.';
                modalTopupStatus.classList.add('success');
                // Optionally redirect or inform user to check status
            } else {
                modalTopupStatus.textContent = result.message || 'Gagal mengajukan top up.';
                modalTopupStatus.classList.add('error');
            }
        } catch (error) {
            modalTopupStatus.textContent = 'Terjadi kesalahan jaringan atau server.';
            modalTopupStatus.classList.add('error');
        } finally {
            modalTopupButton.disabled = false;
            modalTopupButton.textContent = 'Ajukan Top Up';
        }
    });

    // --- Profile Modal Functions ---
    const profileModal = document.getElementById('profileModal');
    const profileInfoContent = document.getElementById('profileInfoContent');

    function openProfileModal() {
        const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
        if (!isLoggedIn) {
            openLoginModal();
            return;
        }

        const userData = JSON.parse(localStorage.getItem('userData'));
        if (userData) {
            populateProfileInfo(userData);
            profileModal.style.display = 'block';
        } else {
            // Handle case where user is technically logged in but userData is missing
            alert('Gagal memuat data profil. Silakan coba login ulang.');
            logout();
        }
    }

    function closeProfileModal() {
        profileModal.style.display = 'none';
    }

    function populateProfileInfo(user) {
        let profileHTML = '';

        // Displaying relevant profile fields based on stored sheet names (Customers)
        profileHTML += `<p><strong>ID Pelanggan:</strong> ${user['Customers ID'] || '-'}</p>`;
        profileHTML += `<p><strong>Nama Lengkap:</strong> ${user['Nama Lengkap'] || '-'}</p>`;
        profileHTML += `<p><strong>Username:</strong> ${user['Username'] || '-'}</p>`;
        profileHTML += `<p><strong>Nomor HP:</strong> ${user['Nomor HP'] || '-'}</p>`;
        profileHTML += `<p><strong>Alamat:</strong> ${user['Alamat Lengkap'] || '-'}</p>`;
        profileHTML += `<p><strong>Saldo:</strong> Rp ${user['Saldo'] || '0'}</p>`;
        profileHTML += `<p><strong>Tentang Saya:</strong> ${user['Tentang Saya'] || '-'}</p>`;
        profileHTML += `<p><strong>Tanggal Daftar:</strong> ${user['Tanggal Daftar'] || '-'}</p>`;

        // Note: Password and Foto Profil are not displayed for security/UI reasons here

        profileInfoContent.innerHTML = profileHTML;
    }

    document.addEventListener('DOMContentLoaded', updateUIBasedOnLoginStatus);
  </script>

</body>
</html>
