<!DOCTYPE html><html lang="id"><head>      <meta charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0"/>  
  
<title>Nasuka Wireless</title>      
<link rel="stylesheet" href="https://nasukafoods.site/indexnasuka.css">      
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>      
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>    <script src="https://nasukafoods.site/realtime.js"></script>


    </head>        
<body>     <span id="notifInbox" ...></span>  
  
<div class="nasuka-info centered">        
<div class="fake-online">üü¢ User Aktif</div>        
<div style="padding:10px;text-align:center">    
  <input id="cariUser" placeholder="" style=""/>      
  <div id="hasilUser" style="margin-top:10px"></div>      
</div>      
<div class="arya-bar raya">       
<div class="profil-overlay">      
<a id="linkProfil">    
  <img src="https://nasukafoods.site/nasukafoods.jpg" alt="Loading" class="arya-item raya" id="fotoProfil">       
</a>      
<span id="namaUser" class="blink-glow">Memuat....</span>     
</div>    
<div class="profil-overlay">      
  <img src="https://nasukafoods.site/tekn.jpg" alt="Loading" class="arya-item raya" id="fol">          
  <span>Premium</span>      
</div>     
<div class="arya-scol">      
  <div class="arya-overlay">              
    <a href="burung.html">      
      <img src="https://nasukafoods.site/nasukabird.jpg" alt="scol1"> <span></span>      
    </a>      
  </div>      
  <div class="arya-overlay">              
    <a href="roll.html">      
      <img src="https://nasukafoods.site/roll.jpg" alt="scol1"> <span></span>      
    </a>      
  </div>      
  <div class="arya-overlay">              
    <a href="puzzle.html">      
      <img src="https://nasukafoods.site/puzzle.jpg" alt="scol1"> <span></span>      
    </a>      
  </div>      
  <div class="arya-overlay">              
    <a href="">      
      <img src="https://nasukafoods.site/onprogres.jpg" alt="scol1"> <span></span>      
    </a>      
  </div>      
  <div class="arya-overlay">              
    <a href="https://nasukafoods.site/nasuka.apk">      
      <img src="https://nasukafoods.site/nasukafoods.jpg" alt="scol1"> <span>Download</span>      
    </a>      
  </div>      
</div>      
</div>     
</div>     
<div id="daftarPostingan" style="padding: 10px;"></div>      
<div id="modalGambar" style="display:none;position:fixed;z-index:9999;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center">      
  <img id="gambarModal" src="" style="max-width:95%;max-height:95%;border-radius:8px">      
</div>  
<script>    
        document.addEventListener("DOMContentLoaded", function () {    
    
  if (firebase.apps.length === 0) {    
    firebase.initializeApp(firebaseConfig);    
  }    
    
  const db = firebase.database();    
  const userID = localStorage.getItem("ID") || "";    
  const username = localStorage.getItem("Username");    
  const fotoEl = document.getElementById("fotoProfil");    
  const namaEl = document.getElementById("namaUser");    
  const profilLink = document.getElementById("linkProfil");    
    
  if (!userID) {    
    namaEl.textContent = "Silakan Masuk";    
    fotoEl.src = "https://nasukafoods.site/gambarkosong.jpg";    
    profilLink.href = "login.html";    
    
  } else {    
    const nama = localStorage.getItem("Nama");    
    const foto = localStorage.getItem("Foto");    
    
    if (nama && foto) {    
      namaEl.textContent = nama;    
      fotoEl.src = foto;    
      profilLink.href = `profil.html?id=${encodeURIComponent(userID)}`;    
    
    } else {    
    
      db.ref("users").once("value").then(snap => {    
        snap.forEach(child => {    
          const val = child.val();    
          if (val.ID === userID) {    
            const namaBaru = val.Nama || "Tanpa Nama";    
            const fotoBaru = val.Foto || "https://nasukafoods.site/gambarkosong.jpg";    
            localStorage.setItem("Nama", namaBaru);    
            localStorage.setItem("Foto", fotoBaru);    
            namaEl.textContent = namaBaru;    
            fotoEl.src = fotoBaru;    
            profilLink.href = `profil.html?id=${encodeURIComponent(userID)}`;    
          }    
        });    
      });    
    }    
    
    db.ref("users").orderByChild("ID").equalTo(userID).on("child_changed", snap => {    
      const val = snap.val();    
    
      if (val.ID === userID) {    
        localStorage.setItem("Nama", val.Nama || "Tanpa Nama");    
        localStorage.setItem("Foto", val.Foto || "https://nasukafoods.site/gambarkosong.jpg");    
        namaEl.textContent = val.Nama || "Tanpa Nama";    
        fotoEl.src = val.Foto || "https://nasukafoods.site/gambarkosong.jpg";    
      }    
    });    
  }    
    
  
  document.getElementById("cariUser").addEventListener("input", function () {    
    const k = this.value.trim().toLowerCase();    
    const h = document.getElementById("hasilUser");    
    h.innerHTML = "";    
    if (k.length < 2) return;    
    db.ref("users").once("value").then(snap => {    
      snap.forEach(child => {    
        const v = child.val();    
        if ((v.Nama || "").toLowerCase().includes(k)) {    
          const d = document.createElement("div");    
          d.innerHTML = `<div style="display:flex;align-items:center;gap:8px;background:#fff;padding:8px;border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,0.1)">    
            <img src="${v.Foto || 'https://nasukafoods.site/gambarkosong.jpg'}" style="width:40px;height:40px;border-radius:50%;object-fit:cover">    
            <div style="flex:1"><b>${v.Nama || 'Tanpa Nama'}</b><br><a href="profil.html?id=${encodeURIComponent(v.ID)}" style="font-size:12px;color:#2196F3">Lihat Profil</a></div></div>`;    
          h.appendChild(d);    
        }    
      });    
    });    
  });    
    
  window.kirimKomentar = function (postId) {    
    const nama = localStorage.getItem("Nama") || "Anonim";    
    const inputKomentar = document.getElementById("inputKomentar-" + postId);    
    if (!inputKomentar) return;    
    const teks = inputKomentar.value.trim();    
    if (teks === "") return;    
    const ref = db.ref("komentar/" + postId).push();    
    ref.set({    
      ID: userID,    
      Nama: nama,    
      Teks: teks,    
      Waktu: new Date().toISOString()    
    });    
    inputKomentar.value = "";    
  };    
    
  window.toggleLike = function (postId) {    
    if (!userID) return;    
    const ref = db.ref("likes/" + postId + "/" + userID);    
    ref.once("value").then(snap => {    
      if (snap.exists()) {    
        ref.remove();    
      } else {    
        ref.set(true);    
      }    
    });    
  };    
    
  db.ref("posts").orderByChild("Status").equalTo("publik").on("value", function (snapshot) {    
    const daftar = document.getElementById("daftarPostingan");    
    daftar.innerHTML = "";    
    let posts = [];    
    snapshot.forEach(postSnap => {    
      posts.push(postSnap);    
    });    
    posts.reverse().forEach(postSnap => {    
      const post = postSnap.val();    
      const postId = postSnap.key;    
      const userId = post.ID || "";    
      db.ref("users").orderByChild("ID").equalTo(userId).once("value").then(userSnap => {    
        let namaPemilik = "Tanpa Nama";    
        userSnap.forEach(u => {    
          const val = u.val();    
          if (val.Nama) namaPemilik = val.Nama;    
        });    
        const div = document.createElement("div");    
        div.className = "post-item";    
        div.style.flexDirection = "column";    
    
        div.innerHTML = `    
          <div style="text-align:center;font-weight:bold;font-size:14px;margin-bottom:6px">${namaPemilik}</div>    
          ${post.Foto ? `<img src="${post.Foto}" class="foto-post" style="width:100px;height:100px;margin:0 auto 8px;display:block;border-radius:8px;object-fit:cover;cursor:pointer" onclick="tampilkanGambarPenuh('${post.Foto}')">` : ""}    
          <div class="konten-post" style="width:100%;text-align:left">    
            <div style="font-size:13px;margin:4px 0"><b>${(post.Judul || '').replace(/\n/g, '<br>')}</b></div>    
            <div style="font-size:11px;color:gray;margin-top:4px">${post.Waktu ? new Date(post.Waktu).toLocaleString("id-ID") : ''}</div>    
          </div>    
          <div style="display:flex;align-items:center;gap:8px;margin-top:8px">    
            <button onclick="toggleLike('${postId}')" id="likeBtn-${postId}" style="padding:6px 10px;background:#eee;border-radius:6px;border:none;cursor:pointer;font-size:13px">‚ù§Ô∏è </button>    
            <span id="likeCount-${postId}" style="font-size:13px">0 suka</span>    
          </div>    
          <div id="komentar-${postId}" style="margin-top:10px; display:none;"></div>    
          <button id="lihatKomentarBtn-${postId}" style="margin-top:6px;padding:6px 10px;background:red;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:13px">Lihat Komentar</button>  
          <div style="display:flex;gap:6px;margin-top:6px">    
            <textarea id="inputKomentar-${postId}" placeholder="Tulis komentar..." style="flex:1;padding:6px;border:1px solid #ccc;border-radius:6px;font-size:13px;resize:none" rows="1"></textarea>  <button onclick="kirimKomentar('${postId}')" style="padding:6px 10px;background:#2196F3;color:white;border:none;border-radius:6px;font-size:13px">Ok</button>    
          </div>    
        `;    

        daftar.appendChild(div);    

        let komentarLoaded = false;
        const btnLihat = div.querySelector(`#lihatKomentarBtn-${postId}`);
        const wadahKomentar = div.querySelector(`#komentar-${postId}`);

        btnLihat.onclick = () => {
          if (wadahKomentar.style.display === "none") {
            wadahKomentar.style.display = "block";
            btnLihat.textContent = "Sembunyikan Komentar";
            if (!komentarLoaded) {
              db.ref("komentar/" + postId).on("value", snap => {
                wadahKomentar.innerHTML = "";
                snap.forEach(c => {
                  const v = c.val();
                  const d = document.createElement("div");
                  d.style = "background:#f9f9f9;padding:6px;margin-top:4px;border-radius:6px;font-size:12px";
                  const teksParagraf = (v.Teks || "").split('\n').map(p => `<p style="margin:0 0 6px 0">${p}</p>`).join('');
                  d.innerHTML = `<b>${v.Nama || "Anonim"}</b>: ${teksParagraf}`;
                  wadahKomentar.appendChild(d);
                });
              });
              komentarLoaded = true;
            }
          } else {
            wadahKomentar.style.display = "none";
            btnLihat.textContent = "Lihat Komentar";
          }
        };

        db.ref("likes/" + postId).on("value", snap => {    
          const likeCount = snap.numChildren();    
          const likeCountEl = document.getElementById("likeCount-" + postId);    
          if (likeCountEl) {    
            likeCountEl.textContent = `${likeCount} suka`;    
          }    
          const likeBtn = document.getElementById("likeBtn-" + postId);    
          if (likeBtn) {    
            if (snap.hasChild(userID)) {    
              likeBtn.textContent = "‚ù§Ô∏è";    
              likeBtn.style.background = "#f8d7da";    
            } else {    
              likeBtn.textContent = " üíî";    
              likeBtn.style.background = "#eee";    
            }    
          }    
        });    
      });    
    });    
  });  
  
});  
  
window.tampilkanGambarPenuh = function (src) {  
if (!src) return;  
gambarModal.src = src;  
modal.style.display = "flex";  
};  
const modal = document.getElementById("modalGambar");  
const gambarModal = document.getElementById("gambarModal");  
modal.addEventListener("click", () => modal.style.display = "none");  
  
const notifInbox = document.querySelector("#notifInbox");  
  
if (userID) {  
const daftarPengirim = {};  
  
firebase.database().ref("rooms").on("value", snap => {    
  notifInbox.style.display = "none";    
  notifInbox.innerHTML = "";    
  
  const temp = {};    
  
  snap.forEach(room => {    
    const key = room.key;    
    if (!key.includes("_")) return;    
  
    const [a, b] = key.split("_");    
    if (a === b || (a !== userID && b !== userID)) return;    
  
    let lawan = a === userID ? b : a;    
    let pesanTerakhir = null;    
    let waktuTerakhir = 0;    
  
    room.child("chats").forEach(chat => {    
      const data = chat.val();    
      if (!data || !data.Pesan) return;    
      if (data.ID !== userID && data.Waktu > waktuTerakhir) {    
        waktuTerakhir = data.Waktu;    
        pesanTerakhir = data;    
      }    
    });    
  
    if (pesanTerakhir) {    
      temp[lawan] = pesanTerakhir;    
    }    
  });    
  
  const entries = Object.entries(temp).sort((a, b) => b[1].Waktu - a[1].Waktu);    
  
  if (entries.length > 0) {    
    notifInbox.style.display = "inline";    
    notifInbox.innerHTML = "üì® Chat";    
  
    notifInbox.onclick = () => {    
      const popup = document.createElement("div");    
      popup.style.position = "fixed";    
      popup.style.top = "50px";    
      popup.style.left = "8px";    
      popup.style.background = "snow";    
      popup.style.padding = "10px";    
      popup.style.borderRadius = "6px";    
      popup.style.boxShadow = "0 0 10px rgba(0,0,0,0.4)";    
      popup.style.zIndex = "9999";    
  
      const btnClose = document.createElement("div");    
      btnClose.textContent = "Tutup";    
      btnClose.style.textAlign = "right";    
      btnClose.style.fontWeight = "bold";    
      btnClose.style.cursor = "pointer";    
      btnClose.style.marginBottom = "10px";    
      btnClose.onclick = () => {    
        popup.remove();    
        notifInbox.style.display = "inline";    
      };    
      popup.appendChild(btnClose);    
  
      entries.forEach(([pengirimID, data]) => {    
        const div = document.createElement("div");    
        div.textContent = `${data.Nama}: ${data.Pesan}`;    
        div.style.cursor = "pointer";    
        div.style.marginBottom = "6px";    
        div.onclick = () => {    
          localStorage.setItem("targetID", pengirimID);    
          localStorage.setItem("targetNama", data.Nama || "");    
          localStorage.setItem("targetFoto", "");    
          location.href = "inbox.html";    
        };    
        popup.appendChild(div);    
      });    
  
      document.body.appendChild(popup);    
      notifInbox.style.display = "none";    
    };    
  
  }    
});  
  
}  
  
</script>  
  
</body></html>
