<!DOCTYPE html>
<html>
<head>
<title>Toko Online Saya</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
body{font-family:Arial,sans-serif;margin:0;background-color:#f4f4f4;color:#333;line-height:1.6}.header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background-color:#fff;border-bottom:1px solid #eee}.header h1{margin:0;color:#4CAF50;font-size:1.8em}.welcome-message{font-size:1em;font-weight:bold;color:#555}.container{width:100%;max-width:960px;margin:auto;padding:20px;background-color:#fff;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.1);box-sizing:border-box}nav{text-align:center;margin-bottom:30px;display:flex;flex-wrap:nowrap;justify-content:space-around;gap:8px;overflow-x:hidden;padding-bottom:5px;width:100%;box-sizing:border-box}nav button{background-color:#007bff;color:white;padding:8px 12px;border:none;border-radius:5px;cursor:pointer;font-size:14px;flex-shrink:0;flex-grow:1;min-width:auto;white-space:nowrap;transition:background-color .3s ease}nav button:hover{background-color:#0056b3}.section{display:none;padding-top:20px}.section.active{display:block}h2{text-align:center;color:#555;margin-bottom:25px;font-size:1.8em}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;font-weight:bold;color:#555;font-size:.95em}.form-group input,.form-group textarea,.form-group select{width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;font-size:16px;box-sizing:border-box;max-width:100%}.form-group.hidden-for-member{display:none}.form-group.member-readonly{display:none}.button{background-color:#4CAF50;color:white;padding:12px 20px;border:none;border-radius:5px;cursor:pointer;font-size:16px;display:block;width:100%;max-width:250px;margin:20px auto 0;transition:background-color .3s ease;box-sizing:border-box}.button:hover{background-color:#45a049}.message{margin-top:20px;padding:15px;border-radius:5px;text-align:center;font-weight:bold;font-size:.95em}.message.success{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}.message.error{background-color:#f8d7da;color:#721c24;border:1px solid #721c24;border:1px solid #f5c6cb}.product-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-top:30px}.product-item{background-color:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:15px;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.05);transition:transform .2s ease}.product-item:hover{transform:translateY(-5px)}.product-item h3{color:#333;margin-bottom:8px;font-size:1.15em}.product-item p{color:#666;font-size:.9em;margin-bottom:12px}.product-item .product-price{font-size:1.1em;font-weight:bold;color:#007bff}.buy-now-button{background-color:#28a745;color:white;padding:8px 15px;border:none;border-radius:5px;cursor:pointer;font-size:14px;margin-top:10px;width:auto;display:inline-block}.buy-now-button:hover{background-color:#218838}.profile-data p,.order-item p{margin-bottom:8px;line-height:1.5;font-size:.95em}.profile-data strong,.order-item strong{display:inline-block;width:120px;color:#555}.order-item{border:1px solid #e9ecef;background-color:#fefefe;padding:12px;margin-bottom:12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.05)}.order-detail-summary{background-color:#e9f7ef;border:1px solid #cce8d6;border-radius:8px;padding:15px;margin-top:20px;margin-bottom:20px}.order-detail-summary p{margin-bottom:8px}.order-detail-summary strong{width:150px;color:#333}.form-group.hidden-field{display:none}footer{background-color:#333;color:white;text-align:center;padding:20px;margin-top:30px;font-size:.56em}.footer-links a{color:#fff;text-decoration:none;margin:0 10px}.footer-links a:hover{text-decoration:underline}@media (max-width:768px){.header{padding:10px 15px}.header h1{font-size:1.5em}.welcome-message{font-size:.9em}.container{margin:10px;padding:15px}h2{font-size:1.6em;margin-bottom:20px}.button{padding:10px 15px;font-size:15px}.product-list{grid-template-columns:1fr}.product-item{padding:15px}.product-item h3{font-size:1.1em}.product-item p{font-size:.85em}.product-item .product-price{font-size:1.05em}.buy-now-button{padding:8px 15px;font-size:14px}.profile-data strong,.order-item strong{width:100px}.order-detail-summary strong{width:120px}}@media (max-width:480px){.header{flex-direction:column;align-items:flex-start;padding:10px}.header h1{margin-bottom:5px}.welcome-message{margin-top:5px}.container{padding:10px}h1{font-size:1.5em}h2{font-size:1.4em}.form-group label{font-size:.9em}.form-group input,.form-group textarea,.form-group select{font-size:14px;padding:8px}.message{font-size:.85em;padding:10px}.buy-now-button{font-size:13px;padding:7px 12px}}

/* New styles for the larger new product section (existing) */
.new-product-section {
    margin-top: 20px;
    margin-bottom: 30px;
}

.new-product-section h2 {
    text-align: center;
    color: #555;
    margin-bottom: 25px;
    font-size: 1.8em;
}

.new-product-carousel {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch; /* For smoother scrolling on iOS */
    padding-bottom: 10px; /* Space for scrollbar */
    gap: 15px; /* Gap between product items */
}

.new-product-carousel::-webkit-scrollbar {
    height: 8px;
}

.new-product-carousel::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 4px;
}

.new-product-carousel::-webkit-scrollbar-track {
    background-color: #f1f1f1;
}

.new-product-item {
    flex: 0 0 auto; /* Prevent items from shrinking/growing */
    width: 150px; /* Fixed width for larger new products */
    height: 220px; /* Fixed height to accommodate content */
    background-color: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,.05);
    scroll-snap-align: start;
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* Distribute space vertically */
}

.new-product-item img {
    width: 100%;
    height: 80px; /* Fixed height for image to make it square-like */
    object-fit: cover; /* Cover the area, crop if necessary */
    border-radius: 4px;
    margin-bottom: 8px;
    background-color: #eee; /* Placeholder background */
}

.new-product-item h4 {
    margin: 0 0 5px 0;
    color: #333;
    font-size: 1em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.new-product-item p.description {
    font-size: 0.75em;
    color: #666;
    margin-bottom: 8px;
    height: 3em; /* Limit height to 3 lines */
    overflow: hidden;
    line-height: 1.2;
}

.new-product-item p.price {
    font-size: 0.9em;
    font-weight: bold;
    color: #007bff;
    margin-bottom: 10px;
}

.new-product-item .add-to-cart-button {
    background-color: #28a745;
    color: white;
    padding: 6px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85em;
    width: 100%;
    box-sizing: border-box;
    transition: background-color .3s ease;
}

.new-product-item .add-to-cart-button:hover {
    background-color: #218838;
}

/* Styles for the smaller new product section */
.smaller-product-section {
    margin-top: 20px;
    margin-bottom: 30px;
}

.smaller-product-section h2 {
    text-align: center;
    color: #555;
    margin-bottom: 25px;
    font-size: 1.8em;
}

.smaller-product-carousel {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 10px;
    gap: 10px; /* Smaller gap */
}

.smaller-product-carousel::-webkit-scrollbar {
    height: 8px;
}

.smaller-product-carousel::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 4px;
}

.smaller-product-carousel::-webkit-scrollbar-track {
    background-color: #f1f1f1;
}

.smaller-product-item {
    flex: 0 0 auto;
    width: 100px; /* 50% smaller than 150px = 75px, adjusted to 100px for readability */
    height: 150px; /* Adjusted height */
    background-color: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 6px; /* Smaller border-radius */
    padding: 8px; /* Smaller padding */
    text-align: center;
    box-shadow: 0 1px 3px rgba(0,0,0,.05); /* Lighter shadow */
    scroll-snap-align: start;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.smaller-product-item img {
    width: 100%;
    height: 50px; /* Adjusted height for image */
    object-fit: cover;
    border-radius: 3px;
    margin-bottom: 6px; /* Smaller margin */
    background-color: #eee;
}

.smaller-product-item h4 {
    margin: 0 0 3px 0; /* Smaller margin */
    color: #333;
    font-size: 0.8em; /* Smaller font size */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.smaller-product-item p.description {
    font-size: 0.6em; /* Smaller font size */
    color: #666;
    margin-bottom: 6px; /* Smaller margin */
    height: 2.4em; /* Limit height to 3 lines (0.8em * 3) */
    overflow: hidden;
    line-height: 1.2;
}

.smaller-product-item p.price {
    font-size: 0.75em; /* Smaller font size */
    font-weight: bold;
    color: #007bff;
    margin-bottom: 8px; /* Smaller margin */
}

.smaller-product-item .add-to-cart-button {
    background-color: #28a745;
    color: white;
    padding: 4px 8px; /* Smaller padding */
    border: none;
    border-radius: 3px; /* Smaller border-radius */
    cursor: pointer;
    font-size: 0.7em; /* Smaller font size */
    width: 100%;
    box-sizing: border-box;
    transition: background-color .3s ease;
}

.smaller-product-item .add-to-cart-button:hover {
    background-color: #218838;
}

/* Styles for the even smaller new product section */
.even-smaller-product-section {
    margin-top: 20px;
    margin-bottom: 30px;
}

.even-smaller-product-section h2 {
    text-align: center;
    color: #555;
    margin-bottom: 25px;
    font-size: 1.8em;
}

.even-smaller-product-carousel {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 10px;
    gap: 8px; /* Even smaller gap */
}

.even-smaller-product-carousel::-webkit-scrollbar {
    height: 8px;
}

.even-smaller-product-carousel::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 4px;
}

.even-smaller-product-carousel::-webkit-scrollbar-track {
    background-color: #f1f1f1;
}

.even-smaller-product-item {
    flex: 0 0 auto;
    width: 60px; /* 50% smaller than 100px = 50px, adjusted to 60px for readability */
    height: 90px; /* Adjusted height */
    background-color: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px; /* Even smaller border-radius */
    padding: 5px; /* Even smaller padding */
    text-align: center;
    box-shadow: 0 1px 2px rgba(0,0,0,.03); /* Lighter shadow */
    scroll-snap-align: start;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.even-smaller-product-item img {
    width: 100%;
    height: 30px; /* Adjusted height for image */
    object-fit: cover;
    border-radius: 2px;
    margin-bottom: 4px; /* Even smaller margin */
    background-color: #eee;
}

.even-smaller-product-item h4 {
    margin: 0 0 2px 0; /* Even smaller margin */
    color: #333;
    font-size: 0.6em; /* Even smaller font size */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.even-smaller-product-item p.description {
    font-size: 0.45em; /* Even smaller font size */
    color: #666;
    margin-bottom: 4px; /* Even smaller margin */
    height: 1.8em; /* Limit height to 3 lines (0.6em * 3) */
    overflow: hidden;
    line-height: 1.2;
}

.even-smaller-product-item p.price {
    font-size: 0.55em; /* Even smaller font size */
    font-weight: bold;
    color: #007bff;
    margin-bottom: 6px; /* Even smaller margin */
}

.even-smaller-product-item .add-to-cart-button {
    background-color: #28a745;
    color: white;
    padding: 3px 6px; /* Even smaller padding */
    border: none;
    border-radius: 2px; /* Even smaller border-radius */
    cursor: pointer;
    font-size: 0.6em; /* Even smaller font size */
    width: 100%;
    box-sizing: border-box;
    transition: background-color .3s ease;
}

.even-smaller-product-item .add-to-cart-button:hover {
    background-color: #218838;
}

</style>
</head>
<body>
<div class="header">
<h1 style="margin-bottom:0;">Toko Online</h1>
<div id="welcomeMessage" class="welcome-message">Hai, Tamu</div>
</div>
<div class="container">
<nav>
<button id="navHome" onclick="showSection('home')">Beranda</button>
<button id="navLogin" onclick="showSection('login')">Login</button>
<button id="navSignup" onclick="showSection('signup')">Daftar</button>
<button id="navOrder" onclick="showSection('order')">Order</button>
<button id="navProfile" onclick="showSection('profile')" style="display:none;">Profil</button>
<button id="navOrderHistory" onclick="showSection('orderHistory')" style="display:none;">Riwayat Pesanan</button>
<button id="navDeposit" onclick="showSection('deposit')" style="display:none;">Deposit</button>
<button id="navLogout" onclick="logout()" style="display:none;">Logout</button>
</nav>
<div id="homeSection" class="section active">
<h2>Produk Kami</h2>

<div class="even-smaller-product-section">
    <h2>Diskon Kilat</h2>
    <div class="even-smaller-product-carousel">
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/FF69B4/FFFFFF?text=XSm%201" alt="XSmall Produk 1">
            <h4>XSm Prod 1</h4>
            <p class="description">Desc. Prod XSm 1.</p>
            <p class="price">Rp 5.000</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 1" data-product-price="5000">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/BA55D3/FFFFFF?text=XSm%202" alt="XSmall Produk 2">
            <h4>XSm Prod 2</h4>
            <p class="description">Desc. Prod XSm 2.</p>
            <p class="price">Rp 6.000</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 2" data-product-price="6000">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/20B2AA/FFFFFF?text=XSm%203" alt="XSmall Produk 3">
            <h4>XSm Prod 3</h4>
            <p class="description">Desc. Prod XSm 3.</p>
            <p class="price">Rp 4.500</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 3" data-product-price="4500">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/FF8C00/FFFFFF?text=XSm%204" alt="XSmall Produk 4">
            <h4>XSm Prod 4</h4>
            <p class="description">Desc. Prod XSm 4.</p>
            <p class="price">Rp 7.000</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 4" data-product-price="7000">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/6A5ACD/FFFFFF?text=XSm%205" alt="XSmall Produk 5">
            <h4>XSm Prod 5</h4>
            <p class="description">Desc. Prod XSm 5.</p>
            <p class="price">Rp 5.500</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 5" data-product-price="5500">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/7FFF00/FFFFFF?text=XSm%206" alt="XSmall Produk 6">
            <h4>XSm Prod 6</h4>
            <p class="description">Desc. Prod XSm 6.</p>
            <p class="price">Rp 8.000</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 6" data-product-price="8000">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/DC143C/FFFFFF?text=XSm%207" alt="XSmall Produk 7">
            <h4>XSm Prod 7</h4>
            <p class="description">Desc. Prod XSm 7.</p>
            <p class="price">Rp 6.500</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 7" data-product-price="6500">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/00CED1/FFFFFF?text=XSm%208" alt="XSmall Produk 8">
            <h4>XSm Prod 8</h4>
            <p class="description">Desc. Prod XSm 8.</p>
            <p class="price">Rp 9.000</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 8" data-product-price="9000">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/DAA520/FFFFFF?text=XSm%209" alt="XSmall Produk 9">
            <h4>XSm Prod 9</h4>
            <p class="description">Desc. Prod XSm 9.</p>
            <p class="price">Rp 7.500</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 9" data-product-price="7500">Add</button>
        </div>
        <div class="even-smaller-product-item">
            <img src="https://via.placeholder.com/60x30/48D1CC/FFFFFF?text=XSm%2010" alt="XSmall Produk 10">
            <h4>XSm Prod 10</h4>
            <p class="description">Desc. Prod XSm 10.</p>
            <p class="price">Rp 10.000</p>
            <button class="add-to-cart-button" data-product-name="XSm Produk 10" data-product-price="10000">Add</button>
        </div>
    </div>
</div>

<hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

<div class="smaller-product-section">
    <h2>Promo Spesial</h2>
    <div class="smaller-product-carousel">
        <div class="smaller-product-item">
            <img src="https://via.placeholder.com/100x50/FFC0CB/FFFFFF?text=Mini%201" alt="Mini Produk 1">
            <h4>Mini Produk 1</h4>
            <p class="description">Deskripsi singkat mini produk 1.</p>
            <p class="price">Rp 20.000</p>
            <button class="add-to-cart-button" data-product-name="Mini Produk 1" data-product-price="20000">Add</button>
        </div>
        <div class="smaller-product-item">
            <img src="https://via.placeholder.com/100x50/87CEEB/FFFFFF?text=Mini%202" alt="Mini Produk 2">
            <h4>Mini Produk 2</h4>
            <p class="description">Deskripsi singkat mini produk 2.</p>
            <p class="price">Rp 25.000</p>
            <button class="add-to-cart-button" data-product-name="Mini Produk 2" data-product-price="25000">Add</button>
        </div>
        <div class="smaller-product-item">
            <img src="https://via.placeholder.com/100x50/ADFF2F/FFFFFF?text=Mini%203" alt="Mini Produk 3">
            <h4>Mini Produk 3</h4>
            <p class="description">Deskripsi singkat mini produk 3.</p>
            <p class="price">Rp 15.000</p>
            <button class="add-to-cart-button" data-product-name="Mini Produk 3" data-product-price="15000">Add</button>
        </div>
        <div class="smaller-product-item">
            <img src="https://via.placeholder.com/100x50/FFD700/FFFFFF?text=Mini%204" alt="Mini Produk 4">
            <h4>Mini Produk 4</h4>
            <p class="description">Deskripsi singkat mini produk 4.</p>
            <p class="price">Rp 30.000</p>
            <button class="add-to-cart-button" data-product-name="Mini Produk 4" data-product-price="30000">Add</button>
        </div>
        <div class="smaller-product-item">
            <img src="https://via.placeholder.com/100x50/FFA07A/FFFFFF?text=Mini%205" alt="Mini Produk 5">
            <h4>Mini Produk 5</h4>
            <p class="description">Deskripsi singkat mini produk 5.</p>
            <p class="price">Rp 22.000</p>
            <button class="add-to-cart-button" data-product-name="Mini Produk 5" data-product-price="22000">Add</button>
        </div>
        <div class="smaller-product-item">
            <img src="https://via.placeholder.com/100x50/E0BBE4/FFFFFF?text=Mini%206" alt="Mini Produk 6">
            <h4>Mini Produk 6</h4>
            <p class="description">Deskripsi singkat mini produk 6.</p>
            <p class="price">Rp 18.000</p>
            <button class="add-to-cart-button" data-product-name="Mini Produk 6" data-product-price="18000">Add</button>
        </div>
        <div class="smaller-product-item">
            <img src="https://via.placeholder.com/100x50/94B3FD/FFFFFF?text=Mini%207" alt="Mini Produk 7">
            <h4>Mini Produk 7</h4>
            <p class="description">Deskripsi singkat mini produk 7.</p>
            <p class="price">Rp 28.000</p>
            <button class="add-to-cart-button" data-product-name="Mini Produk 7" data-product-price="28000">Add</button>
        </div>
        <div class="smaller-product-item">
            <img src="https://via.placeholder.com/100x50/C6E377/FFFFFF?text=Mini%208" alt="Mini Produk 8">
            <h4>Mini Produk 8</h4>
            <p class="description">Deskripsi singkat mini produk 8.</p>
            <p class="price">Rp 35.000</p>
            <button class="add-to-cart-button" data-product-name="Mini Produk 8" data-product-price="35000">Add</button>
        </div>
    </div>
</div>

<hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

<div class="new-product-section">
    <h2>Produk Terbaru</h2>
    <div class="new-product-carousel">
        <div class="new-product-item">
            <img src="https://via.placeholder.com/150x80/87CEEB/FFFFFF?text=Produk%20A" alt="Produk A">
            <h4>Produk A</h4>
            <p class="description">Deskripsi singkat produk A yang menarik.</p>
            <p class="price">Rp 50.000</p>
            <button class="add-to-cart-button" data-product-name="Produk A" data-product-price="50000">Add</button>
        </div>
        <div class="new-product-item">
            <img src="https://via.placeholder.com/150x80/FFD700/FFFFFF?text=Produk%20B" alt="Produk B">
            <h4>Produk B</h4>
            <p class="description">Ini adalah deskripsi singkat untuk produk B.</p>
            <p class="price">Rp 75.000</p>
            <button class="add-to-cart-button" data-product-name="Produk B" data-product-price="75000">Add</button>
        </div>
        <div class="new-product-item">
            <img src="https://via.placeholder.com/150x80/90EE90/FFFFFF?text=Produk%20C" alt="Produk C">
            <h4>Produk C</h4>
            <p class="description">Deskripsi produk C dengan fitur-fitur unggulan.</p>
            <p class="price">Rp 120.000</p>
            <button class="add-to-cart-button" data-product-name="Produk C" data-product-price="120000">Add</button>
        </div>
        <div class="new-product-item">
            <img src="https://via.placeholder.com/150x80/FF6347/FFFFFF?text=Produk%20D" alt="Produk D">
            <h4>Produk D</h4>
            <p class="description">Produk D kualitas terbaik untuk Anda.</p>
            <p class="price">Rp 90.000</p>
            <button class="add-to-cart-button" data-product-name="Produk D" data-product-price="90000">Add</button>
        </div>
        <div class="new-product-item">
            <img src="https://via.placeholder.com/150x80/ADD8E6/FFFFFF?text=Produk%20E" alt="Produk E">
            <h4>Produk E</h4>
            <p class="description">Nikmati keunggulan produk E kami.</p>
            <p class="price">Rp 65.000</p>
            <button class="add-to-cart-button" data-product-name="Produk E" data-product-price="65000">Add</button>
        </div>
        <div class="new-product-item">
            <img src="https://via.placeholder.com/150x80/DA70D6/FFFFFF?text=Produk%20F" alt="Produk F">
            <h4>Produk F</h4>
            <p class="description">Produk F, pilihan cerdas untuk kebutuhan Anda.</p>
            <p class="price">Rp 110.000</p>
            <button class="add-to-cart-button" data-product-name="Produk F" data-product-price="110000">Add</button>
        </div>
    </div>
</div>

<hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

<div class="product-list">
<div class="product-item">
<h3>Paket Internet Cepat</h3>
<p>Kuota 100 GB, kecepatan hingga 50 Mbps. Ideal untuk streaming dan gaming.</p>
<p>Harga: <span class="product-price">100000</span></p>
<button class="button buy-now-button" data-product-name="Paket Internet Cepat" data-product-price="100000">Beli Sekarang</button>
</div>
<div class="product-item">
<h3>Voucher Game Premium</h3>
<p>Voucher untuk game populer, dapatkan item eksklusif.</p>
<p>Harga: <span class="product-price">150000</span></p>
<button class="button buy-now-button" data-product-name="Voucher Game Premium" data-product-price="150000">Beli Sekarang</button>
</div>
<div class="product-item">
<h3>Langganan Streaming Film</h3>
<p>Akses tak terbatas ke ribuan film dan serial TV.</p>
<p>Harga: <span class="product-price">80000</span></p>
<button class="button buy-now-button" data-product-name="Langganan Streaming Film" data-product-price="80000">Beli Sekarang</button>
</div>
<div class="product-item">
<h3>Pulsa Elektrik All Operator</h3>
<p>Isi ulang pulsa instan untuk semua operator seluler.</p>
<p>Harga: <span class="product-price">50000</span></p>
<button class="button buy-now-button" data-product-name="Pulsa Elektrik All Operator" data-product-price="50000">Beli Sekarang</button>
</div>
</div>
</div>
<div id="loginSection" class="section">
<h2>Login ke Akun Anda</h2>
<form id="loginForm">
<div class="form-group">
<label for="loginUsername">Username:</label>
<input type="text" id="loginUsername" name="username" required>
</div>
<div class="form-group">
<label for="loginPassword">Password:</label>
<input type="password" id="loginPassword" name="password" required>
</div>
<button type="submit" class="button">Login</button>
</form>
<div id="loginMessage" class="message" style="display:none;"></div>
</div>
<div id="signupSection" class="section">
<h2>Daftar Akun Baru</h2>
<form id="signupForm">
<div class="form-group">
<label for="namaLengkap">Nama Lengkap:</label>
<input type="text" id="namaLengkap" name="namaLengkap" required>
</div>
<div class="form-group">
<label for="alamatLengkap">Alamat Lengkap:</label>
<textarea id="alamatLengkap" name="alamatLengkap" rows="3" required></textarea>
</div>
<div class="form-group">
<label for="nomorHP">Nomor HP:</label>
<input type="text" id="nomorHP" name="nomorHP" value="62" required oninput="ensureCountryCode(this)">
</div>
<div class="form-group">
<label for="username">Username:</label>
<input type="text" id="username" name="username" required>
</div>
<div class="form-group">
<label for="tentangSaya">Tentang Saya (Opsional):</label>
<textarea id="tentangSaya" name="tentangSaya" rows="3"></textarea>
</div>
<div class="form-group">
<label for="password">Password:</label>
<input type="password" id="password" name="password" required>
</div>
<button type="submit" class="button">Daftar</button>
</form>
<div id="signupMessage" class="message" style="display:none;"></div>
</div>
<div id="profileSection" class="section">
<h2>Profil Pengguna</h2>
<div id="profileData" class="profile-data">
<p><strong>Customers ID:</strong> <span id="profileCustID"></span></p>
<p><strong>Nama Lengkap:</strong> <span id="profileNamaLengkap"></span></p>
<p><strong>Alamat Lengkap:</strong> <span id="profileAlamatLengkap"></span></p>
<p><strong>Nomor HP:</strong> <span id="profileNomorHP"></span></p>
<p><strong>Username:</strong> <span id="profileUsername"></span></p>
<p><strong>Tentang Saya:</strong> <span id="profileTentangSaya"></span></p>
<p><strong>Saldo:</strong> <span id="profileSaldo"></span></p>
<p><strong>Tanggal Daftar:</strong> <span id="profileTanggalDaftar"></span></p>
<button id="editProfileButton" class="button" style="display:none;">Edit Profil</button>
</div>
<div id="profileMessage" class="message" style="display:none;"></div>
</div>
<div id="editProfileSection" class="section">
<h2>Edit Profil</h2>
<form id="editProfileForm">
<input type="hidden" id="editProfileCustomerID" name="customerID">
<div class="form-group">
<label for="editNamaLengkap">Nama Lengkap:</label>
<input type="text" id="editNamaLengkap" name="namaLengkap" required>
</div>
<div class="form-group">
<label for="editAlamatLengkap">Alamat Lengkap:</label>
<textarea id="editAlamatLengkap" name="alamatLengkap" rows="3" required></textarea>
</div>
<div class="form-group">
<label for="editNomorHP">Nomor HP:</label>
<input type="text" id="editNomorHP" name="nomorHP" required>
</div>
<div class="form-group">
<label for="editPassword">Password (kosongkan jika tidak ingin diubah):</label>
<input type="password" id="editPassword" name="password">
</div>
<div class="form-group">
<label for="editTentangSaya">Tentang Saya (Opsional):</label>
<textarea id="editTentangSaya" name="tentangSaya" rows="3"></textarea>
</div>
<button type="submit" class="button">Simpan Perubahan</button>
</form>
<div id="editProfileMessage" class="message" style="display:none;"></div>
</div>
<div id="orderHistorySection" class="section">
<h2>Riwayat Pesanan</h2>
<div id="orderHistoryList">
<p id="noOrderHistoryMessage" style="display:none;">Tidak ada riwayat pesanan.</p>
</div>
<div id="orderHistoryMessage" class="message" style="display:none;"></div>
</div>
<div id="depositSection" class="section">
<h2>Deposit Saldo</h2>
<form id="depositForm">
<div class="form-group">
<label for="depNamaPelanggan">Nama Pelanggan:</label>
<input type="text" id="depNamaPelanggan" name="namaPelanggan" required>
</div>
<div class="form-group">
<label for="depNomorHP">Nomor HP:</label>
<input type="text" id="depNomorHP" name="nomorHP" required>
</div>
<div class="form-group">
<label for="jumlahDeposit">Jumlah Deposit:</label>
<input type="number" id="jumlahDeposit" name="jumlahDeposit" min="1" required>
</div>
<div class="form-group">
<label for="metodePembayaranDep">Metode Pembayaran:</label>
<select id="metodePembayaranDep" name="metodePembayaran" required>
<option value="">Pilih Metode</option>
<option value="Bank Transfer">Bank Transfer</option>
<option value="E-Wallet">E-Wallet</option>
</select>
</div>
<div class="form-group">
<label for="buktiTransferFile">Kirim Foto Bukti Transfer:</label>
<input type="file" id="buktiTransferFile" name="buktiTransferFile" accept="image/*" required>
</div>
<button type="submit" class="button">Ajukan Deposit</button>
</form>
<div id="depositMessage" class="message" style="display:none;"></div>
</div>
<div id="orderSection" class="section">
<h2>Detail Pesanan</h2>
<div id="orderDetailSummary" class="order-detail-summary" style="display:none;">
<p><strong>Tipe Pelanggan:</strong> <span id="summaryTipePelanggan"></span></p>
<p><strong>Nama Lengkap:</strong> <span id="summaryNamaLengkap"></span></p>
<p><strong>Nomor HP:</strong> <span id="summaryNomorHP"></span></p>
<p><strong>Alamat Pengiriman:</strong> <span id="summaryAlamat"></span></p>
<p><strong>Username:</strong> <span id="summaryUsername"></span></p>
<p><strong>Produk:</strong> <span id="summaryProduk"></span></p>
<p><strong>Kuantitas:</strong> <span id="summaryKuantitas"></span></p>
<p><strong>Total Harga:</strong> <span id="summaryTotalHarga"></span></p>
<p><strong>Sisa Saldo:</strong> <span id="summarySisaSaldo"></span></p>
<p><strong>Catatan:</strong> <span id="summaryCatatan"></span></p>
<p><strong>Metode Pembayaran:</strong> <span id="summaryMetodePembayaran"></span></p>
<p><strong>Status Pesanan:</strong> <span id="summaryStatusPesanan"></span></p>
<p><strong>Bonus:</strong> <span id="summaryBonus"></span></p>
</div>
<form id="orderForm">
<div class="form-group hidden-for-member" id="formGroupNomorHP">
<label for="ordNomorHP">Nomor HP Pelanggan:</label>
<input type="text" id="ordNomorHP" name="nomorHP">
</div>
<div class="form-group hidden-for-member" id="formGroupAlamat">
<label for="ordAlamat">Alamat Pengiriman:</label>
<textarea id="ordAlamat" name="alamat" rows="3"></textarea>
</div>
<div class="form-group hidden-for-member" id="formGroupUsername">
<label for="ordUsername">Username (Opsional):</label>
<input type="text" id="ordUsername" name="username">
</div>
<div class="form-group member-readonly" id="formGroupProduk">
<label for="produk">Produk:</label>
<input type="text" id="produk" name="produk" required>
</div>
<div class="form-group member-readonly" id="formGroupKuantitas">
<label for="kuantitas">Kuantitas:</label>
<input type="number" id="kuantitas" name="kuantitas" min="1" value="1" required>
</div>
<div class="form-group member-readonly" id="formGroupTotalHarga">
<label for="totalHarga">Total Harga:</label>
<input type="number" id="totalHarga" name="totalHarga" min="1" required>
</div>
<div class="form-group">
<label for="catatan">Catatan (Opsional):</label>
<textarea id="catatan" name="catatan" rows="3"></textarea>
</div>
<div class="form-group" id="formGroupMetodePembayaranOrd">
<label for="metodePembayaranOrd">Metode Pembayaran:</label>
<select id="metodePembayaranOrd" name="metodePembayaran" required>
<option value="">Pilih Metode</option>
<option value="Transfer Bank">Transfer Bank</option>
<option value="E-Wallet">E-Wallet</option>
<option value="Saldo Akun">Saldo Akun</option>
<option value="Cash on Delivery">Cash on Delivery</option>
</select>
</div>
<div class="form-group" id="formGroupBuktiPembayaran" style="display:none;">
<label for="buktiPembayaranFile">Kirim Foto Bukti Pembayaran:</label>
<input type="file" id="buktiPembayaranFile" name="buktiPembayaranFile" accept="image/*">
</div>
<div class="form-group hidden-field" id="formGroupStatusPesanan">
<label for="statusPesanan">Status Pesanan:</label>
<select id="statusPesanan" name="statusPesanan">
<option value="Pending">Pending</option>
<option value="Diproses">Diproses</option>
<option value="Dikirim">Dikirim</option>
<option value="Selesai">Selesai</option>
<option value="Dibatalkan">Dibatalkan</option>
</select>
</div>
<div class="form-group hidden-field" id="formGroupBonus">
<label for="bonus">Bonus (Opsional):</label>
<input type="text" id="bonus" name="bonus">
</div>
<button type="submit" class="button">Bayar Sekarang</button>
</form>
<div id="orderMessage" class="message" style="display:none;"></div>
</div>
</div>
<script>
// URL Google Apps Script yang baru Anda berikan
const GAS_URL = 'https://script.google.com/macros/s/AKfycby84KGedeLwHiRBb4O0_rkzhYQh6r2-HgwtD_gcq6ubVwFy8jn_GbSxiBjctKm2b9ruZg/exec';
const DRIVE_FOLDER_ID = '12x-IPybdd1h3JLjN-qEVDy9QHB1Or35A'; // ID Drive dari ingatan Gemini
let loggedInUser = null;

function saveUserToLocalStorage(userData) {
    localStorage.setItem('loggedInUser', JSON.stringify(userData));
    loggedInUser = userData;
    updateWelcomeMessage();
    updateNavigationButtons();
}

function loadUserFromLocalStorage() {
    const userDataString = localStorage.getItem('loggedInUser');
    if (userDataString) {
        loggedInUser = JSON.parse(userDataString);
        updateWelcomeMessage();
        return true;
    }
    return false;
}

function removeUserFromLocalStorage() {
    localStorage.removeItem('loggedInUser');
    loggedInUser = null;
    updateWelcomeMessage();
    updateNavigationButtons();
}

function updateWelcomeMessage() {
    const welcomeMessageDiv = document.getElementById('welcomeMessage');
    if (loggedInUser && loggedInUser['Nama Lengkap']) {
        welcomeMessageDiv.innerText = `Hai, ${loggedInUser['Nama Lengkap']}`;
    } else {
        welcomeMessageDiv.innerText = 'Hai, Tamu';
    }
}

function showSection(sectionId) {
    const sections = document.querySelectorAll('.section');
    sections.forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById(sectionId + 'Section').classList.add('active');

    document.querySelectorAll('.message').forEach(msg => msg.style.display = 'none');

    if (sectionId === 'profile') {
        if (loggedInUser) {
            displayProfile();
            document.getElementById('editProfileButton').style.display = 'block';
        } else {
            document.getElementById('profileMessage').classList.add('error');
            document.getElementById('profileMessage').innerText = 'Anda harus login untuk melihat profil.';
            document.getElementById('profileMessage').style.display = 'block';
            document.getElementById('profileData').style.display = 'none';
            document.getElementById('editProfileButton').style.display = 'none';
        }
    } else if (sectionId === 'editProfile') {
        if (loggedInUser) {
            populateEditProfileForm();
        } else {
            showSection('login');
        }
    } else if (sectionId === 'orderHistory') {
        if (loggedInUser) {
            loadOrderHistory(loggedInUser['Nomor HP']);
        } else {
            document.getElementById('orderHistoryMessage').classList.add('error');
            document.getElementById('orderHistoryMessage').innerText = 'Anda harus login untuk melihat riwayat pesanan.';
            document.getElementById('orderHistoryMessage').style.display = 'block';
            document.getElementById('orderHistoryList').innerHTML = '';
            document.getElementById('noOrderHistoryMessage').style.display = 'none';
        }
    } else if (sectionId === 'order') {
        updateOrderFormVisibility();
    }
}

function updateOrderFormVisibility() {
    const isMember = loggedInUser !== null;
    document.getElementById('formGroupNomorHP').style.display = isMember ? 'none' : 'block';
    document.getElementById('formGroupAlamat').style.display = isMember ? 'none' : 'block';
    document.getElementById('formGroupUsername').style.display = isMember ? 'none' : 'block';

    if (isMember) {
        document.getElementById('ordNomorHP').removeAttribute('required');
        document.getElementById('ordAlamat').removeAttribute('required');
        document.getElementById('ordUsername').removeAttribute('required');
    } else {
        document.getElementById('ordNomorHP').setAttribute('required', 'required');
        document.getElementById('ordAlamat').setAttribute('required', 'required');
        document.getElementById('ordUsername').removeAttribute('required');
    }

    const memberHiddenFields = ['formGroupProduk', 'formGroupKuantitas', 'formGroupTotalHarga', 'formGroupStatusPesanan', 'formGroupBonus'];
    memberHiddenFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        const inputElement = field.querySelector('input, textarea, select');
        if (isMember) {
            field.style.display = 'none';
            if (inputElement) {
                inputElement.readOnly = true;
                inputElement.disabled = true;
            }
        } else {
            if (fieldId === 'formGroupProduk' || fieldId === 'formGroupKuantitas' || fieldId === 'formGroupTotalHarga') {
                field.style.display = 'block';
            } else {
                field.style.display = 'none';
            }
            if (inputElement) {
                inputElement.readOnly = false;
                inputElement.disabled = false;
            }
        }
    });

    document.getElementById('orderDetailSummary').style.display = isMember ? 'block' : 'none';
    if (isMember) {
        document.getElementById('summaryTipePelanggan').innerText = 'Member';
        document.getElementById('summaryNamaLengkap').innerText = loggedInUser['Nama Lengkap'] || '-';
        document.getElementById('summaryNomorHP').innerText = loggedInUser['Nomor HP'] || '-';
        document.getElementById('summaryAlamat').innerText = loggedInUser['Alamat Lengkap'] || '-';
        document.getElementById('summaryUsername').innerText = loggedInUser['Username'] || '-';
        document.getElementById('summarySisaSaldo').innerText = loggedInUser['Saldo'] !== undefined ? `Rp ${parseFloat(loggedInUser['Saldo']).toLocaleString('id-ID')}` : '-';
    } else {
        document.getElementById('summarySisaSaldo').innerText = 'N/A';
    }

    // Toggle Bukti Pembayaran visibility based on payment method
    const metodePembayaranOrd = document.getElementById('metodePembayaranOrd').value;
    const buktiPembayaranGroup = document.getElementById('formGroupBuktiPembayaran');
    const buktiPembayaranFile = document.getElementById('buktiPembayaranFile');

    if (metodePembayaranOrd === 'Saldo Akun') {
        buktiPembayaranGroup.style.display = 'none';
        buktiPembayaranFile.removeAttribute('required');
    } else if (metodePembayaranOrd !== '') { // Show if a method other than Saldo Akun is selected
        buktiPembayaranGroup.style.display = 'block';
        buktiPembayaranFile.setAttribute('required', 'required');
    } else { // Hide if no method is selected
        buktiPembayaranGroup.style.display = 'none';
        buktiPembayaranFile.removeAttribute('required');
    }
}


async function submitForm(formId, actionType, messageId) {
    const form = document.getElementById(formId);
    const messageDiv = document.getElementById(messageId);
    messageDiv.style.display = 'none';
    messageDiv.className = 'message';

    let requestBody;

    if (actionType === 'login') {
        const usernameValue = document.getElementById('loginUsername').value;
        const passwordValue = document.getElementById('loginPassword').value;

        requestBody = new FormData();
        requestBody.append('action', 'login');
        requestBody.append('username', usernameValue);
        requestBody.append('password', passwordValue);

        try {
            const response = await fetch(GAS_URL, {
                method: 'POST',
                body: requestBody
            });
            const result = await response.json();

            if (result.status === 'success') {
                messageDiv.classList.add('success');
                messageDiv.innerText = result.message;
                saveUserToLocalStorage(result.data);
                updateNavigationButtons();
                showSection('home');
            } else {
                messageDiv.classList.add('error');
                messageDiv.innerText = result.message;
            }
            messageDiv.style.display = 'block';
        } catch (error) {
            messageDiv.classList.add('error');
            messageDiv.innerText = 'Terjadi kesalahan: ' + error.message;
            messageDiv.style.display = 'block';
        }
        return;
    } else if (actionType === 'deposit' || actionType === 'order') {
        requestBody = new FormData(form);
        let fileInputId = '';
        let fileParamName = '';

        if (actionType === 'deposit') {
            fileInputId = 'buktiTransferFile';
            fileParamName = 'buktiTransfer';
        } else { // actionType === 'order'
            const metodePembayaran = document.getElementById('metodePembayaranOrd').value;
            if (metodePembayaran === 'Saldo Akun') {
                // No file needed for Saldo Akun
            } else {
                fileInputId = 'buktiPembayaranFile';
                fileParamName = 'buktiPembayaranFile'; // Make sure this matches the backend parameter name
            }
        }
        
        const fileInput = document.getElementById(fileInputId);
        const file = fileInput ? fileInput.files[0] : null;

        if (fileInputId && !file && (actionType === 'deposit' || (actionType === 'order' && document.getElementById('metodePembayaranOrd').value !== 'Saldo Akun'))) { // Only require file if fileInputId is set and file is not present, and it's not Saldo Akun for order
            messageDiv.classList.add('error');
            messageDiv.innerText = 'Mohon unggah bukti yang diperlukan.';
            messageDiv.style.display = 'block';
            return;
        }

        if (file) {
            const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5 MB
            if (file.size > MAX_FILE_SIZE) {
                messageDiv.classList.add('error');
                messageDiv.innerText = 'Ukuran file terlalu besar. Maksimal 5MB.';
                messageDiv.style.display = 'block';
                return;
            }

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onloadend = async function() {
                const base64data = reader.result.split(',')[1];
                requestBody.append('action', actionType);
                requestBody.append(fileParamName, base64data);
                requestBody.append('fileName', file.name);
                requestBody.append('mimeType', file.type);

                if (actionType === 'order') {
                    if (loggedInUser) {
                        requestBody.set('tipePelanggan', 'Member');
                        requestBody.set('nomorHP', loggedInUser['Nomor HP']);
                        requestBody.set('alamat', loggedInUser['Alamat Lengkap'] || '');
                        requestBody.set('username', loggedInUser['Username'] || '');
                    } else {
                        requestBody.set('tipePelanggan', 'Tamu');
                    }
                     // Ensure produk, kuantitas, totalHarga are always sent for orders
                    requestBody.set('produk', document.getElementById('produk').value);
                    requestBody.set('kuantitas', document.getElementById('kuantitas').value);
                    requestBody.set('totalHarga', document.getElementById('totalHarga').value);
                    requestBody.set('statusPesanan', document.getElementById('statusPesanan').value || 'Pending');
                    requestBody.set('bonus', document.getElementById('bonus').value || '-');
                }

                try {
                    const response = await fetch(GAS_URL, {
                        method: 'POST',
                        body: requestBody
                    });
                    const result = await response.json();

                    if (result.status === 'success') {
                        messageDiv.classList.add('success');
                        messageDiv.innerText = result.message;
                        form.reset();
                        if (actionType === 'order' && document.getElementById('metodePembayaranOrd').value === 'Saldo Akun' && loggedInUser) {
                            const refreshFormData = new FormData();
                            refreshFormData.append('action', 'refreshUserData');
                            refreshFormData.append('customerID', loggedInUser['Customers ID']);
                            const refreshResponse = await fetch(GAS_URL, {
                                method: 'POST',
                                body: refreshFormData
                            });
                            const refreshResult = await refreshResponse.json();
                            if (refreshResult.status === 'success') {
                                saveUserToLocalStorage(refreshResult.data);
                                updateOrderFormVisibility(); // Refresh summary with new balance
                            } else {
                                console.error('Gagal memperbarui data user setelah order:', refreshResult.message);
                            }
                        }
                    } else {
                        messageDiv.classList.add('error');
                        messageDiv.innerText = result.message;
                    }
                    messageDiv.style.display = 'block';
                } catch (error) {
                    messageDiv.classList.add('error');
                    messageDiv.innerText = 'Terjadi kesalahan: ' + error.message;
                    messageDiv.style.display = 'block';
                }
            };
            reader.onerror = function(error) {
                messageDiv.classList.add('error');
                messageDiv.innerText = 'Error membaca file: ' + error.message;
                messageDiv.style.display = 'block';
            };
            return; // Exit after file handling
        } else { // No file to upload (e.g., Saldo Akun payment for order)
            requestBody.append('action', actionType);
             if (actionType === 'order') {
                if (loggedInUser) {
                    requestBody.set('tipePelanggan', 'Member');
                    requestBody.set('nomorHP', loggedInUser['Nomor HP']);
                    requestBody.set('alamat', loggedInUser['Alamat Lengkap'] || '');
                    requestBody.set('username', loggedInUser['Username'] || '');
                } else {
                    requestBody.set('tipePelanggan', 'Tamu');
                }
                // Ensure produk, kuantitas, totalHarga are always sent for orders
                requestBody.set('produk', document.getElementById('produk').value);
                requestBody.set('kuantitas', document.getElementById('kuantitas').value);
                requestBody.set('totalHarga', document.getElementById('totalHarga').value);
                requestBody.set('statusPesanan', document.getElementById('statusPesanan').value || 'Pending');
                requestBody.set('bonus', document.getElementById('bonus').value || '-');
             }

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: requestBody
                });
                const result = await response.json();

                if (result.status === 'success') {
                    messageDiv.classList.add('success');
                    messageDiv.innerText = result.message;
                    form.reset();
                    if (actionType === 'signup') {
                        form.reset();
                        showSection('login');
                    } else if (actionType === 'updateProfile' || (actionType === 'order' && document.getElementById('metodePembayaranOrd').value === 'Saldo Akun')) {
                        if (loggedInUser) { // Only refresh if user is logged in
                            const refreshFormData = new FormData();
                            refreshFormData.append('action', 'refreshUserData');
                            refreshFormData.append('customerID', loggedInUser['Customers ID']);
                            const refreshResponse = await fetch(GAS_URL, {
                                method: 'POST',
                                body: refreshFormData
                            });
                            const refreshResult = await refreshResponse.json();
                            if (refreshResult.status === 'success') {
                                saveUserToLocalStorage(refreshResult.data);
                                if (actionType === 'updateProfile') {
                                    displayProfile();
                                    showSection('profile');
                                } else if (actionType === 'order') {
                                    updateOrderFormVisibility(); // Refresh summary with new balance
                                }
                            } else {
                                console.error('Gagal memperbarui data user setelah aksi:', refreshResult.message);
                                if (actionType === 'updateProfile') {
                                    alert('Profil berhasil diperbarui, namun ada masalah dalam memuat data terbaru. Silakan refresh halaman.');
                                }
                            }
                        }
                    }
                    if (actionType === 'order') {
                         document.getElementById('summaryProduk').innerText = '';
                         document.getElementById('summaryKuantitas').innerText = '';
                         document.getElementById('summaryTotalHarga').innerText = '';
                         document.getElementById('summaryCatatan').innerText = '';
                         document.getElementById('summaryMetodePembayaran').innerText = '';
                         document.getElementById('summaryStatusPesanan').innerText = '';
                         document.getElementById('summaryBonus').innerText = '';
                         document.getElementById('metodePembayaranOrd').value = '';
                         document.getElementById('buktiPembayaranFile').value = ''; // Clear file input
                         updateOrderFormVisibility(); // Ensure correct state after reset
                    }
                } else {
                    messageDiv.classList.add('error');
                    messageDiv.innerText = result.message;
                }
                messageDiv.style.display = 'block';
            } catch (error) {
                messageDiv.classList.add('error');
                messageDiv.innerText = 'Terjadi kesalahan: ' + error.message;
                messageDiv.style.display = 'block';
            }
        }

        return;
    } else { // Signup and Update Profile (without file uploads)
        requestBody = new FormData(form);
        requestBody.append('action', actionType);

        try {
            const response = await fetch(GAS_URL, {
                method: 'POST',
                body: requestBody
            });
            const result = await response.json();

            if (result.status === 'success') {
                messageDiv.classList.add('success');
                messageDiv.innerText = result.message;
                if (actionType === 'signup') {
                    form.reset();
                    showSection('login');
                } else if (actionType === 'updateProfile') {
                    if (loggedInUser) { // Only refresh if user is logged in
                        const refreshFormData = new FormData();
                        refreshFormData.append('action', 'refreshUserData');
                        refreshFormData.append('customerID', loggedInUser['Customers ID']);
                        const refreshResponse = await fetch(GAS_URL, {
                            method: 'POST',
                            body: refreshFormData
                        });
                        const refreshResult = await refreshResponse.json();
                        if (refreshResult.status === 'success') {
                            saveUserToLocalStorage(refreshResult.data);
                            displayProfile();
                            showSection('profile');
                        } else {
                            console.error('Gagal memperbarui data user setelah aksi:', refreshResult.message);
                            alert('Profil berhasil diperbarui, namun ada masalah dalam memuat data terbaru. Silakan refresh halaman.');
                        }
                    }
                }
            } else {
                messageDiv.classList.add('error');
                messageDiv.innerText = result.message;
            }
            messageDiv.style.display = 'block';
        } catch (error) {
            messageDiv.classList.add('error');
            messageDiv.innerText = 'Terjadi kesalahan: ' + error.message;
            messageDiv.style.display = 'block';
        }
    }
}


async function loadOrderHistory(nomorHP) {
    const orderHistoryListDiv = document.getElementById('orderHistoryList');
    const orderHistoryMessageDiv = document.getElementById('orderHistoryMessage');
    const noOrderHistoryMessage = document.getElementById('noOrderHistoryMessage');
    orderHistoryListDiv.innerHTML = '';
    orderHistoryMessageDiv.style.display = 'none';
    noOrderHistoryMessage.style.display = 'none';

    const formData = new FormData();
    formData.append('action', 'getOrderHistory');
    formData.append('nomorHP', nomorHP);

    try {
        const response = await fetch(GAS_URL, {
            method: 'POST',
            body: formData
        });
        const result = await response.json();

        if (result.status === 'success' && result.data.length > 0) {
            result.data.forEach(order => {
                const orderItemDiv = document.createElement('div');
                orderItemDiv.classList.add('order-item');
                orderItemDiv.innerHTML = `
<p><strong>Tanggal:</strong> ${order['Tanggal'] || '-'}</p>
<p><strong>Tipe Pelanggan:</strong> ${order['Tipe Pelanggan'] || '-'}</p>
<p><strong>Nomor HP:</strong> ${order['Nomor HP'] || '-'}</p>
<p><strong>Alamat:</strong> ${order['Alamat'] || '-'}</p>
<p><strong>Username:</strong> ${order['Username'] || '-'}</p>
<p><strong>Produk:</strong> ${order['Produk'] || '-'}</p>
<p><strong>Kuantitas:</strong> ${order['Kuantitas'] !== undefined ? order['Kuantitas'] : '-'}</p>
<p><strong>Total Harga:</strong> Rp ${order['Total Harga'] !== undefined ? parseFloat(order['Total Harga']).toLocaleString('id-ID') : '-'}</p>
<p><strong>Catatan:</strong> ${order['Catatan'] || '-'}</p>
<p><strong>Metode Pembayaran:</strong> ${order['Metode Pembayaran'] || '-'}</p>
<p><strong>Bukti Pembayaran:</strong> ${order['Bukti Pembayaran'] ? `<a href="${order['Bukti Pembayaran']}" target="_blank">Lihat Bukti</a>` : '-'}</p>
<p><strong>Status Pesanan:</strong> ${order['Status Pesanan'] || '-'}</p>
<p><strong>Bonus:</strong> ${order['Bonus'] || '-'}</p>
`;
                orderHistoryListDiv.appendChild(orderItemDiv);
            });
        } else if (result.status === 'success' && result.data.length === 0) {
            noOrderHistoryMessage.style.display = 'block';
        } else {
            orderHistoryMessageDiv.classList.add('error');
            orderHistoryMessageDiv.innerText = result.message || 'Gagal memuat riwayat pesanan.';
            orderHistoryMessageDiv.style.display = 'block';
        }
    } catch (error) {
        orderHistoryMessageDiv.classList.add('error');
        orderHistoryMessageDiv.innerText = 'Terjadi kesalahan saat memuat riwayat pesanan: ' + error.message;
        orderHistoryMessageDiv.style.display = 'block';
    }
}

function displayProfile() {
    if (loggedInUser) {
        document.getElementById('profileCustID').innerText = loggedInUser['Customers ID'] || '-';
        document.getElementById('profileNamaLengkap').innerText = loggedInUser['Nama Lengkap'] || '-';
        document.getElementById('profileAlamatLengkap').innerText = loggedInUser['Alamat Lengkap'] || '-';
        document.getElementById('profileNomorHP').innerText = loggedInUser['Nomor HP'] || '-';
        document.getElementById('profileUsername').innerText = loggedInUser['Username'] || '-';
        document.getElementById('profileTentangSaya').innerText = loggedInUser['Tentang Saya'] || '-';
        document.getElementById('profileSaldo').innerText = loggedInUser['Saldo'] !== undefined ? `Rp ${parseFloat(loggedInUser['Saldo']).toLocaleString('id-ID')}` : '-';
        document.getElementById('profileTanggalDaftar').innerText = loggedInUser['Tanggal Daftar'] || '-';
        document.getElementById('profileData').style.display = 'block';
        document.getElementById('profileMessage').style.display = 'none';
    } else {
        document.getElementById('profileMessage').classList.add('error');
        document.getElementById('profileMessage').innerText = 'Anda belum login.';
        document.getElementById('profileMessage').style.display = 'block';
        document.getElementById('profileData').style.display = 'none';
    }
}

function populateEditProfileForm() {
    if (loggedInUser) {
        document.getElementById('editProfileCustomerID').value = loggedInUser['Customers ID'];
        document.getElementById('editNamaLengkap').value = loggedInUser['Nama Lengkap'] || '';
        document.getElementById('editAlamatLengkap').value = loggedInUser['Alamat Lengkap'] || '';
        document.getElementById('editNomorHP').value = loggedInUser['Nomor HP'] || '';
        document.getElementById('editTentangSaya').value = loggedInUser['Tentang Saya'] || '';
        document.getElementById('editPassword').value = '';
    }
}

function updateNavigationButtons() {
    const isLoggedIn = loggedInUser !== null;
    document.getElementById('navLogin').style.display = isLoggedIn ? 'none' : 'inline-block';
    document.getElementById('navSignup').style.display = isLoggedIn ? 'none' : 'inline-block';
    document.getElementById('navHome').style.display = 'inline-block';
    document.getElementById('navOrder').style.display = 'inline-block';

    document.getElementById('navProfile').style.display = isLoggedIn ? 'inline-block' : 'none';
    document.getElementById('navOrderHistory').style.display = isLoggedIn ? 'inline-block' : 'none';
    document.getElementById('navDeposit').style.display = isLoggedIn ? 'inline-block' : 'none';
    document.getElementById('navLogout').style.display = isLoggedIn ? 'inline-block' : 'none';
}

function logout() {
    removeUserFromLocalStorage();
    alert('Anda telah logout.');
    showSection('home');
}

function ensureCountryCode(inputElement) {
    const prefix = "62";
    let value = inputElement.value;
    if (!value.startsWith(prefix)) {
        value = prefix + value.replace(/^0+/, '').replace(/[^0-9]/g, '');
        if (value.length > prefix.length && value.startsWith('620')) {
            value = prefix + value.substring(3);
        } else if (value.length < prefix.length) {
            value = prefix;
        }
    }
    inputElement.value = value;
    if (document.activeElement === inputElement) {
        const len = inputElement.value.length;
        inputElement.setSelectionRange(len, len);
    }
}

document.getElementById('signupForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    await submitForm('signupForm', 'signup', 'signupMessage');
});

document.getElementById('loginForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    await submitForm('loginForm', 'login', 'loginMessage');
});

document.getElementById('depositForm').addEventListener('submit', function(event) {
    event.preventDefault();
    submitForm('depositForm', 'deposit', 'depositMessage');
});

document.getElementById('orderForm').addEventListener('submit', function(event) {
    event.preventDefault();
    submitForm('orderForm', 'order', 'orderMessage');
});

document.getElementById('editProfileForm').addEventListener('submit', function(event) {
    event.preventDefault();
    submitForm('editProfileForm', 'updateProfile', 'editProfileMessage');
});

document.getElementById('editProfileButton').addEventListener('click', function() {
    showSection('editProfile');
});

// Update event listener for ALL .add-to-cart-button (new and smaller new products) and .buy-now-button (old products)
document.querySelectorAll('.buy-now-button, .new-product-item .add-to-cart-button, .smaller-product-item .add-to-cart-button, .even-smaller-product-item .add-to-cart-button').forEach(button => {
    button.addEventListener('click', function() {
        const productName = this.dataset.productName;
        const productPrice = this.dataset.productPrice;

        document.getElementById('produk').value = productName;
        document.getElementById('kuantitas').value = 1;
        document.getElementById('totalHarga').value = productPrice;
        document.getElementById('catatan').value = `Pembelian: ${productName}`;
        document.getElementById('statusPesanan').value = 'Pending';
        document.getElementById('bonus').value = '';
        document.getElementById('metodePembayaranOrd').value = '';
        document.getElementById('buktiPembayaranFile').value = ''; // Clear file input on new product selection

        document.getElementById('summaryProduk').innerText = productName;
        document.getElementById('summaryKuantitas').innerText = 1;
        document.getElementById('summaryTotalHarga').innerText = `Rp ${parseFloat(productPrice).toLocaleString('id-ID')}`;
        document.getElementById('summaryCatatan').innerText = `Pembelian: ${productName}`;
        document.getElementById('summaryMetodePembayaran').innerText = 'Pilih Metode';
        document.getElementById('summaryStatusPesanan').innerText = 'Pending';
        document.getElementById('summaryBonus').innerText = '-';

        if (loggedInUser) {
            document.getElementById('ordNomorHP').value = loggedInUser['Nomor HP'];
            document.getElementById('ordAlamat').value = loggedInUser['Alamat Lengkap'] || '';
            document.getElementById('ordUsername').value = loggedInUser['Username'] || '';
            document.getElementById('summaryTipePelanggan').innerText = 'Member';
            document.getElementById('summaryNamaLengkap').innerText = loggedInUser['Nama Lengkap'] || '-';
            document.getElementById('summaryNomorHP').innerText = loggedInUser['Nomor HP'] || '-';
            document.getElementById('summaryAlamat').innerText = loggedInUser['Alamat Lengkap'] || '-';
            document.getElementById('summaryUsername').innerText = loggedInUser['Username'] || '-';
            document.getElementById('summarySisaSaldo').innerText = loggedInUser['Saldo'] !== undefined ? `Rp ${parseFloat(loggedInUser['Saldo']).toLocaleString('id-ID')}` : '-';
        } else {
            document.getElementById('ordNomorHP').value = '';
            document.getElementById('ordAlamat').value = '';
            document.getElementById('ordUsername').value = '';
            document.getElementById('summaryTipePelanggan').innerText = 'Tamu';
            document.getElementById('summaryNamaLengkap').innerText = 'N/A';
            document.getElementById('summaryNomorHP').innerText = 'N/A';
            document.getElementById('summaryAlamat').innerText = 'N/A';
            document.getElementById('summaryUsername').innerText = 'N/A';
            document.getElementById('summarySisaSaldo').innerText = 'N/A';
            alert('Silakan login atau masukkan Nomor HP dan Alamat Anda untuk melanjutkan pesanan.');
        }
        showSection('order');
        updateOrderFormVisibility(); // Update visibility after setting product and user status
    });
});

document.getElementById('metodePembayaranOrd').addEventListener('change', updateOrderFormVisibility);

document.getElementById('catatan').addEventListener('input', () => document.getElementById('summaryCatatan').innerText = document.getElementById('catatan').value);
document.getElementById('metodePembayaranOrd').addEventListener('change', () => document.getElementById('summaryMetodePembayaran').innerText = document.getElementById('metodePembayaranOrd').value);
document.getElementById('ordNomorHP').addEventListener('input', () => {
    if (!loggedInUser) document.getElementById('summaryNomorHP').innerText = document.getElementById('ordNomorHP').value
});
document.getElementById('ordAlamat').addEventListener('input', () => {
    if (!loggedInUser) document.getElementById('summaryAlamat').innerText = document.getElementById('ordAlamat').value
});
document.getElementById('ordUsername').addEventListener('input', () => {
    if (!loggedInUser) document.getElementById('summaryUsername').innerText = document.getElementById('ordUsername').value
});

document.addEventListener('DOMContentLoaded', () => {
    if (loadUserFromLocalStorage()) {
        updateNavigationButtons();
    } else {
        updateNavigationButtons();
    }
    showSection('home');
});
</script>
<footer>
<div class="footer-links">
<a href="#">Faq</a>
<a href="#">Syarat&amp;Ketentuan</a>
<a href="#">Refund Policy</a>
<a href="#">Kontak Admin</a>
</div>
<div class="copyright">@copyright : nasukawireless 2025 - Hak cipta dilindungi undang undang</div>
</footer>
</body>
</html>
