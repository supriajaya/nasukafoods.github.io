<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nasuka.apk</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      color: white;
      background-color: black;
    }

    /* Top Bar */
    .top-bar {
      position: fixed;
      top: 0;
      width: 100%;
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      font-size: 12px;
      z-index: 999;
      background-color: rgba(0, 0, 0, 0.8);
    }

    .top-bar a {
      color: white;
      text-decoration: none;
      text-align: center;
    }

    /* Hero Section */
    .hero-section {
      position: relative;
      height: 20vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .hero-section video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .promo-text,
    .info,
    .sidebar {
     position: relative;
     z-index: 1;
    }

    .info, .sidebar {
      position: absolute;
      bottom: 20px;
    }

    .info {
      left: 10px;
    }

    .info .location {
      font-size: 12px;
      color: #ccc;
    }

    .info .username {
      font-weight: bold;
    }

    .info .desc {
      font-size: 14px;
      margin-top: 5px;
    }

    .info .music {
      font-size: 12px;
      color: #ffbb00;
    }

    .sidebar {
      right: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .sidebar div {
      margin: 8px 0;
      font-size: 12px;
    }

    /* Product Section */
    .product-list {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding: 10px;
      gap: 15px;
      margin-top: 10px;
    }

    .product-card {
      min-width: 75px; 
      text-align: center;
      color: white;
      text-decoration: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
    }

    .product-image-container {
      width: 75px; 
      height: 75px;
      overflow: hidden;
    }

    .product-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .product-title {
      font-size: 10px; 
      margin-top: 4px;
    }

    .product-price {
      font-weight: bold;
      font-size: 9px;
      margin-top: 2px;
      color: #ffbb00;
    }

    /* Login Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.9);
      padding-top: 60px;
    }

    .modal-content {
      background-color: #1a1a1a;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 400px;
      border-radius: 8px;
    }

    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close-button:hover,
    .close-button:focus {
      color: #ffbb00;
      text-decoration: none;
      cursor: pointer;
    }

    .form-group {
        margin-bottom: 20px;
        text-align: left;
    }
    label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
    }
    input[type="text"], input[type="password"] {
        width: 100%;
        padding: 12px;
        border: 1px solid #333;
        background-color: #333;
        color: white;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
    }
    button[type="submit"] {
        width: 100%;
        padding: 15px;
        background-color: #25D366;
        border: none;
        color: white;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        border-radius: 4px;
        margin-top: 10px;
    }
    button[type="submit"]:hover {
        background-color: #1a8a47;
    }
    .status-message {
        margin-top: 20px;
        font-weight: bold;
        text-align: center;
    }
    .error {
        color: #dc3545;
    }
    .success {
        color: #25D366;
    }
    .register-link {
        margin-top: 15px;
        font-size: 14px;
        text-align: center;
    }
    .register-link a {
        color: #ffbb00;
        text-decoration: none;
    }
  </style>
</head>

<body>

  <div class="top-bar" id="top-bar-links">
    </div>

  <section class="hero-section">
    <video src="https://nasukafoods.site/kawasakih2.mp4" autoplay muted loop playsinline></video>
    <div class="info">
      <div class="location">Jawa Barat</div>
      <div class="username" id="user-greeting">Proyek Apk</div>
      <div class="desc">Pembangunan aplikasi</div>
      <div class="music">üéµ Nasuka Labs</div>
    </div>
    <div class="sidebar">
      <div>‚ù§Ô∏è 200.k</div>
      <div>üí¨ 4.M</div>
      <div>üîó Share</div>
    </div>
  </section>

  <div class="product-list">
    <a onclick="addToCart(this)" class="product-card">
      <div class="product-image-container">
        <img class="product-image" src="https://nasukafoods.site/wireless.jpg" alt="Produk 1">
      </div>
      <div class="product-title">Produk 1</div>
      <div class="product-price">Rp 50.000</div>
    </a>
    <a onclick="addToCart(this)" class="product-card">
      <div class="product-image-container">
        <img class="product-image" src="https://nasukafoods.site/wireless.jpg" alt="Produk 2">
      </div>
      <div class="product-title">Produk 2</div>
      <div class="product-price">Rp 75.000</div>
    </a>
    <a onclick="addToCart(this)" class="product-card">
      <div class="product-image-container">
        <img class="product-image" src="https://nasukafoods.site/wireless.jpg" alt="Produk 3">
      </div>
      <div class="product-title">Produk 3</div>
      <div class="product-price">Rp 120.000</div>
    </a>
    <a onclick="addToCart(this)" class="product-card">
      <div class="product-image-container">
        <img class="product-image" src="https://nasukafoods.site/wireless.jpg" alt="Produk 4">
      </div>
      <div class="product-title">Produk 4</div>
      <div class="product-price">Rp 45.000</div>
    </a>
  </div>

  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeLoginModal()">&times;</span>
      <h2 style="color: #ffbb00; text-align: center;">Login Member</h2>
      <form id="modalLoginForm">
          <div class="form-group">
              <label for="modalUsername">Username:</label>
              <input type="text" id="modalUsername" name="Username" required>
          </div>
          <div class="form-group">
              <label for="modalPassword">Password:</label>
              <input type="password" id="modalPassword" name="Password" required>
          </div>
          <button type="submit" id="modalLoginButton">Masuk</button>
      </form>
      <div id="modalStatusMessage" class="status-message"></div>
      <div class="register-link">
          Belum punya akun? <a href="daftar.html">Daftar sekarang</a>
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby84KGedeLwHiRBb4O0_rkzhYQh6r2-HgwtD_gcq6ubVwFy8jn_GbSxiBjctKm2b9ruZg/exec';

    function addToCart(element) {
      const title = element.querySelector('.product-title').innerText;
      const price = element.querySelector('.product-price').innerText;
      const img = element.querySelector('.product-image').src;
      
      const product = { 
          name: title, 
          price: price, 
          image: img,
          quantity: 1 
      };

      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart.push(product);

      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function updateUIBasedOnLoginStatus() {
        const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
        const userData = localStorage.getItem('userData');
        const topBarLinks = document.getElementById('top-bar-links');
        const userGreeting = document.getElementById('user-greeting');

        let linksHTML = '';

        if (isLoggedIn && userData) {
            try {
                const user = JSON.parse(userData);
                
                if (user['Nama Lengkap']) {
                    userGreeting.textContent = user['Nama Lengkap'];
                } else if (user['Username']) {
                    userGreeting.textContent = user['Username'];
                }

                linksHTML = `
                    <a href="index.html">üè†<br>Home</a>
                    <a href="topup.html">üí∞<br>Topup</a>
                    <a href="#" onclick="logout()">üèÉ<br>Logout</a>
                    <a href="keranjang.html">üõí <br>Keranjang</a>
                `;
            } catch (e) {
                localStorage.removeItem('userLoggedIn');
                localStorage.removeItem('userData');
                updateUIBasedOnLoginStatus(); 
                return;
            }
        } else {
            userGreeting.textContent = 'Proyek Apk'; 
            // Ubah link Login ke fungsi yang membuka modal
            linksHTML = `
                <a href="index.html">üè†<br>Home</a>
                <a href="#" onclick="openLoginModal()">üì•<br>Login</a>
                <a href="daftar.html">üìù<br>Daftar</a>
                <a href="keranjang-non-member.html">üõí <br>Keranjang</a>
            `;
        }

        topBarLinks.innerHTML = linksHTML;
    }

    function logout() {
        localStorage.removeItem('userLoggedIn');
        localStorage.removeItem('userData');
        window.location.href = 'index.html'; 
    }

    // Modal Functions
    const loginModal = document.getElementById('loginModal');
    const modalLoginForm = document.getElementById('modalLoginForm');
    const modalLoginButton = document.getElementById('modalLoginButton');
    const modalStatusMessage = document.getElementById('modalStatusMessage');

    function openLoginModal() {
        loginModal.style.display = 'block';
    }

    function closeLoginModal() {
        loginModal.style.display = 'none';
        modalStatusMessage.textContent = ''; // Clear status message on close
        modalLoginButton.textContent = 'Masuk';
        modalLoginButton.disabled = false;
        modalLoginForm.reset();
    }

    // Handle login form submission inside the modal
    modalLoginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        modalLoginButton.disabled = true;
        modalLoginButton.textContent = 'Memproses...';
        modalStatusMessage.textContent = '';
        modalStatusMessage.classList.remove('success', 'error');

        const username = document.getElementById('modalUsername').value;
        const password = document.getElementById('modalPassword').value;

        const payload = new URLSearchParams({
            action: 'login',
            Username: username,
            Password: password
        });

        try {
            const response = await fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: payload.toString(),
            });

            const result = await response.json();

            if (result.status === 'success') {
                modalStatusMessage.textContent = 'Login berhasil. Mengalihkan...';
                modalStatusMessage.classList.add('success');
                
                // Store user data in localStorage
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userData', JSON.stringify(result.user));

                // Redirect or refresh UI after successful login
                setTimeout(() => {
                    window.location.href = 'index.html'; 
                }, 500);

            } else {
                modalStatusMessage.textContent = result.message || 'Login gagal. Periksa username dan password Anda.';
                modalStatusMessage.classList.add('error');
                modalLoginButton.disabled = false;
                modalLoginButton.textContent = 'Masuk';
            }
        } catch (error) {
            modalStatusMessage.textContent = 'Terjadi kesalahan jaringan atau server.';
            modalStatusMessage.classList.add('error');
            modalLoginButton.disabled = false;
            modalLoginButton.textContent = 'Masuk';
        }
    });

    document.addEventListener('DOMContentLoaded', updateUIBasedOnLoginStatus);
  </script>

</body>
</html>
