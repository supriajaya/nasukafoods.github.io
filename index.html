<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1024">
  <title>INDUK</title>
  <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-database-compat.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
  
  <script src="https://nasukafoods.site/fungsi-show.js"></script>     
  <script src="https://nasukafoods.site/fungsi-sync.js"></script>    
  <script src="https://nasukafoods.site/fungsi-signup-login.js"></script>    
  <script src="https://nasukafoods.site/fungsi-burung.js"></script>    
  <script src="https://nasukafoods.site/fungsi-search.js"></script>    
  <script src="https://nasukafoods.site/fungsi-system-roll.js"></script>    
      
  <link rel="stylesheet" href="https://nasukafoods.site/rule.css">  
  <link rel="stylesheet" href="https://nasukafoods.site/login.css">  
  <link rel="stylesheet" href="https://nasukafoods.site/signup.css">  
  <link rel="stylesheet" href="https://nasukafoods.site/burung.css">  
  <link rel="stylesheet" href="https://nasukafoods.site/roll.css">  
  <link rel="stylesheet" href="https://nasukafoods.site/show.css">    
  <link rel="stylesheet" href="https://nasukafoods.site/home.css">      
      
  <style>    
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      background-image: url('gambar.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    
    
post {
        padding:10px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      label {
        display:flex;
        justify-content:center;
        align-items:center;
        gap:6px;
        cursor:pointer;
      }
      .form-post {
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      #btnPosting {
        background: #2196f3;
        color: white;
        padding: 10px 18px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
      }
      .btnKirim {
        background: #ff9800;
        color: white;
        padding: 8px 14px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }
      body {
        margin:0;
        font-family:'Segoe UI',sans-serif;
        background-color:#f5f5f5
      }
      .container {
        display:flex;
        flex-wrap:wrap;
        justify-content:space-between;
        padding:10px
      }
      .nasuka {
        flex:0 0 48%;
        background-color:#fff;
        margin-bottom:10px;
        border-radius:8px;
        overflow:hidden;
        box-shadow:0 2px 5px rgba(0,0,0,0.1);
        text-align:center;
        box-sizing:border-box
      }
      /* Menambahkan aturan CSS yang lebih tegas */
      .nasuka img {
        width:100%;
        height:auto;
        display:block
      }
      .card img:not([src]) {
        display: none;
        height: 0;
        width: 0;
        padding: 0;
        margin: 0;
      }
      .nasuka-info {
        padding:10px
      }
      .nasuka-info.left {
        text-align:left
      }
      .form-post {
        padding:10px
      }
      .form-post input,.form-post textarea,.form-post select {
        width:100%;
        margin-bottom:10px;
        padding:8px;
        font-size:16px;
        box-sizing:border-box
      }
      .postingan {
        padding:10px
      }
      .card {
        background:#fff;
        margin-bottom:10px;
        border-radius:6px;
        box-shadow:0 1px 3px rgba(0,0,0,0.1);
        overflow:hidden;
        position:relative
      }
      .card img {
        width:100%;
        height:auto
      }
      .card-content {
        padding:10px;
        text-align:left
      }
      .hapus-btn {
        position:absolute;
        top:10px;
        right:10px;
        background-color:red;
        color:white;
        border:none;
        padding:6px 10px;
        font-size:12px;
        border-radius:4px;
        cursor:pointer
      }
      .komentar {
        padding:10px
      }
      .komentar input {
        width:100%;
        box-sizing:border-box;
        padding:5px;
        margin-bottom:5px
      }
      .komentar-list {
        max-height:100px;
        overflow-y:auto;
        font-size:14px;
        color:#333
      }
      .komentar-list div {
        margin-bottom:5px
      }
      .card-content h3 {
          margin-top: 0;
          margin-bottom: 5px;
      }
      .card-content small {
          margin: 0;
      }    
    
  </style>
</head>    
<body>  
<body id="gameBody" class="home-bg">  
  
<div id="login-container">          
  <input type="text" id="loginUsername" placeholder="Username" />    
  <input type="password" id="loginPassword" placeholder="Password" />    
  <div id="errorLogin" class="error-msg"></div>    
  <button onclick="login()">Masuk</button>      
  <span class="laik" onclick="showSignup()">Belum punya akun? Daftar disini</span>      
</div>    
  
<div id="signup-container">        
  <input type="text" id="signupNama" placeholder="Nama" />    
  <input type="text" id="signupUsername" placeholder="Username" />    
  <input type="password" id="signupPassword" placeholder="Password" />    
  <button onclick="signup()">Buat Akun Sekarang</button>    
  <span class="laik" onclick="showLogin()">Sudah punya akun? Masuk disini</span>  
</div>     
    
<div id="roll-container">          
  <div class="link-container">  
    <a href="#" class="menu-link" onclick="showRule()">Aturan Main</a>  
    <a href="#" class="menu-link" onclick="showBurung()">game burung</a>  
    <a href="#" class="menu-link" onclick="showCross()">Beranda</a>  
    <a href="#" class="menu-link" onclick="showLogin()">Login</a>  
    <a href="#" class="menu-link" onclick="showSignup()">Signup</a>  
  </div>    
  <div id="loading">Memuat Game...</div>    
  <div id="stage" class="perspective-on">    
    <div id="rotate" class="tilted">    
      <div id="ring1" class="ring"></div>    
      <div id="ring2" class="ring"></div>    
      <div id="ring3" class="ring"></div>    
      <div id="ring4" class="ring"></div>    
      <div id="ring5" class="ring"></div>    
    </div>    
    <audio id="winAudio" src="https://nasukafoods.site/slavafunk.mp3" preload="auto"></audio>    
    <audio id="slotAudio" src="https://nasukafoods.site/mesinslot.mp3" preload="auto"></audio>    
    <button id="spinButton">Putar</button>    
    <div class="mainting-panel">    
      <div>Perak Saya: <span id="perakBalance">0</span></div>    
      <div id="errorMessage" class="error-message"></div>    
      <div class="auto-main-options">    
        <div id="automainButtons">    
          <button onclick="selectmain(1)" id="main1">1</button>    
          <button onclick="selectmain(100)" id="main100">100</button>    
          <button onclick="selectmain(1000)" id="main1000">1.000</button>    
          <button onclick="selectmain(10000)" id="main10000">10.000</button>    
          <button onclick="selectmain(0)">off</button>    
        </div>    
      </div>    
      <div class="auto-spin-buttons">    
        <button id="startAutoSpinButton"> Otomatis</button>    
        <button id="stopAutoSpinButton">Hentikan</button>    
      </div>    
      <div id="mainResult" class="result-message result-hidden"></div>    
    </div>    
  </div>    
  <div class="history-link-container">    
    <a href="#" class="variansiaturan" onclick="showCross()">Beranda.</a>  
  </div>  
</div>
    
<div id="burung-container">    
  <div class="wrapper">    
    <button id="selesaiBtn" style="position: fixed; bottom: 10px; left: 10px; font-size: 50px;">Klaim Perak</button>  
    <button id="rollBtn" style="position: fixed; bottom: 10px; right: 10px; font-size: 50px;" onclick="showRoll()">Roll Game</button>    
    <div id="customAlert" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.2); z-index: 1001; text-align: center; max-width: 80%;">    
      <div id="alertIcon" style="font-size: 50px; margin-bottom: 15px;"></div>    
      <div id="alertMessage" style="font-size: 18px; margin-bottom: 20px;"></div>    
      <button id="alertOkBtn" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">OK</button>    
    </div>    
    <input class="input-circle input-circle1" type="radio" id="circle1" name="burung_group">    
    <input class="input-circle input-circle2" type="radio" id="circle2" name="burung_group">    
    <input class="input-circle input-circle3" type="radio" id="circle3" name="burung_group">    
    <input class="input-circle input-circle4" type="radio" id="circle4" name="burung_group">    
    <input class="input-circle input-circle5" type="radio" id="circle5" name="burung_group">    
    <input class="input-circle input-circle6" type="radio" id="circle6" name="burung_group">    
    <input class="input-circle input-circle7" type="radio" id="circle7" name="burung_group">    
    <input class="input-circle input-circle8" type="radio" id="circle8" name="burung_group">    
    <input class="input-circle input-circle9" type="radio" id="circle9" name="burung_group">    
    <input class="input-circle input-circle10" type="radio" id="circle10" name="burung_group">    
    <input class="input-circle input-circle11" type="radio" id="circle11" name="burung_group">    
    <input class="input-circle input-circle12" type="radio" id="circle12" name="burung_group">    
    <input class="input-circle input-circle13" type="radio" id="circle13" name="burung_group">    
    <input class="input-circle input-circle14" type="radio" id="circle14" name="burung_group">    
    <input class="input-circle input-circle15" type="radio" id="circle15" name="burung_group">    
    <input class="input-circle input-circle16" type="radio" id="circle16" name="burung_group">    
    <input class="input-circle input-circle17" type="radio" id="circle17" name="burung_group">    
    <input class="input-circle input-circle18" type="radio" id="circle18" name="burung_group">    
    <input class="input-circle input-circle19" type="radio" id="circle19" name="burung_group">    
    <input class="input-circle input-circle20" type="radio" id="circle20" name="burung_group">    
    <label for="circle1" class="pajaro pajaro1"><span></span></label>    
    <label for="circle2" class="pajaro pajaro2"><span></span></label>    
    <label for="circle3" class="pajaro pajaro3"><span></span></label>    
    <label for="circle4" class="pajaro pajaro4"><span></span></label>    
    <label for="circle5" class="pajaro pajaro5"><span></span></label>    
    <label for="circle6" class="pajaro pajaro6"><span></span></label>    
    <label for="circle7" class="pajaro pajaro7"><span></span></label>    
    <label for="circle8" class="pajaro pajaro8"><span></span></label>    
    <label for="circle9" class="pajaro pajaro9"><span></span></label>    
    <label for="circle10" class="pajaro pajaro10"><span></span></label>    
    <label for="circle11" class="pajaro pajaro11"><span></span></label>    
    <label for="circle12" class="pajaro pajaro12"><span></span></label>    
    <label for="circle13" class="pajaro pajaro13"><span></span></label>    
    <label for="circle14" class="pajaro pajaro14"><span></span></label>    
    <label for="circle15" class="pajaro pajaro15"><span></span></label>    
    <label for="circle16" class="pajaro pajaro16"><span></span></label>    
    <label for="circle17" class="pajaro pajaro17"><span></span></label>    
    <label for="circle18" class="pajaro pajaro18"><span></span></label>    
    <label for="circle19" class="pajaro pajaro19"><span></span></label>    
    <label for="circle20" class="pajaro pajaro20"><span></span></label>    
    <div class="sum">🎁<span id="total-perak">0</span> Perak Gratis</div>    
  </div>  
</div>

<div id="rule-container">        
  <div class="atasanaturan">    
    <a class="variansiaturan">Nasuka Wireless</a>    
  </div>  
  <div class="aturan">         
    <h1 class="judul-aturan">Aturan Main</h1>    
    <p>Saat anda mendapatkan angka kembar, Anda mendapatkan kemenangan bervariasi, mulai x2 x3 x4 x5 bahkan jackpot x50</p>    
    <p>Saat anda tidak mendapatkan angka kembar, Perak anda berkurang senilai nominal yang anda pasang</p>  
    <h1 class="judul-aturan">Permainan Adil</h1>    
    <p>Mesin roll bekerja mandiri, jadi, Pemain dan kami sebagai pihak pengelola dalam hal ini disebut "kita" sama sama tidak tau angka apa yang akan keluar</p>    
    <h1 class="judul-aturan">Hak & Konpensasi</h1>    
    <p>Anda berhak menukar perak dengan produk digital kami </p>    
    <p>Kami menjamin konpensasi apabila anda ingin berhenti bermain, berapa kekalahan anda, berikan kami data nya, dan kami berikan konpensasi berharga</p>    
    <h1 class="judul-aturan">Penghargaan</h1>    
    <p>Kami menyediakan souvenir menarik untuk 30 pemain dengan jumlah perak terbanyak, </p>    
    <h1 class="judul-aturan">Banned</h1>    
    <p>Kita semua tentu menginginkan permainan yang adil, segala bentuk kecurangan sebaiknya dihindari, </p>    
  </div>  
  <div class="bawahanaturan">  
    <a href="#" class="variansiaturan" onclick="showBurung()">Perak Gratis</a>  
    <a href="#" class="variansiaturan" onclick="showRoll()">Main Roll</a>  
    <a href="#" class="variansiaturan" onclick="showLabirin()">Temukan Jalan</a>  
    <a href="#" class="variansiaturan" onclick="showCross()">Beranda</a>  
  </div>  
</div>    
     
<div id="home-container">    
  <div style="padding:2px; text-align:center; margin-top: 50px;">    
    <input id="cariUser" placeholder="Cari akun....." />    
    <div id="hasilUser" style="margin-top:8px"></div>    
  </div>    
  <div class="arya-bar raya" style="position: relative;">    
    <div class="profil-overlay">    
      <a id="Profil" href="#">    
        <img src="https://nasukafoods.site/gambarkosong.jpg" class="arya-item raya" id="Foto" />    
      </a>    
      <span id="Nama" class="blink-glow">Memuat....</span>    
    </div>    
    <div class="profil-overlay" style="position: relative; display: inline-flex; align-items: center; gap: 6px;">    
      <img src="https://nasukafoods.site/nasukachat.png" class="arya-item raya" id="fol" />    
      <span></span>    
      <span id="notifInbox"></span>    
    </div>    
    <div class="arya-scol">    
      <div class="arya-overlay">    
        <a href="#" onclick="showBurung()">    
          <img src="https://nasukafoods.site/nasukabird.jpg" />  
        </a> 
      </div>  
      <div class="arya-overlay">  
        <a href="#" onclick="showRoll()">  
          <img src="https://nasukafoods.site/roll.jpg" />  
        </a> 
      </div>  
      <div class="arya-overlay">    
        <a href="https://nasukafoods.site/nasuka.apk"><img src="https://nasukafoods.site/download.png" /><span></span></a>    
        <div id="daftarPostingan" style="padding: 10px;"></div>    
        <div id="modalGambar" style="display: none;position: fixed;z-index: 9999;top: 0;left: 0;width: 100%;height: 100%;background: rgba(0,0,0,0.8);justify-content: center;align-items: center;">    
          <img id="gambarModal" src="" style="max-width: 95%; max-height: 95%; border-radius: 8px" />    
        </div>    
      </div>
    </div>
  </div>
</div>

<div id="profil-container">           
  <div class="container">
    <div class="nasuka">
      <img id="foto-profil" src="https://nasukafoods.site/gambarkosong.jpg" alt="FOTO PROFIL" onclick="showSaya()" />
      <div id="tombolAksi"></div>
    </div>
    <div class="nasuka">
      <div class="nasuka-info left" id="dataUser">
        <p>🎇 Nama</p>
        <p>🎇 Perak</p>
        <p>🎇 Jenis</p>
        <p>🎇 Kirim Pesan</p>
      </div>
    </div>
  </div>
  <div class="nasuka" style="width:100%;margin:0;">
    <div class="form-post">
      <textarea id="judul" placeholder="Tulis postingan" autocomplete="off" style="height:80px;"></textarea>
      <select id="status">
        <option value="publik">Publik</option>
        <option value="privat">Privat</option>
      </select>
      <label style="display:flex;justify-content:center;align-items:center;gap:6px;cursor:pointer;width:100%;">
        📷
        <input type="file" id="fotoInput" accept="image/*" style="display:none;" />
      </label>
      <button id="btnPosting" onclick="kirimPostingan()">Posting</button>
    </div>
  </div>
  <div class="postingan" id="dapost"></div>
</div>
          
<div id="payment-container"></div>         
<div id="editprofil-container"></div>        
<div id="leaderboard-container"></div>                    
<div id="belanja-container"></div>           
<div id="labirin-container"></div>             
<div id="saya-container"></div>              
<div id="inbox-container"></div>            
<div id="pasar-container"></div>            
<div id="disclaimer-container"></div>           
<div id="faq-container"></div>              
<div id="returnpolicy-container"></div>      
<div id="privacypolicy-container"></div>           
<div id="zona1-container"></div>         
<div id="cross-container"></div> 
          
<script>    
const firebaseConfig = { apiKey: "AIzaSyASa57fEz1c31GwQ_1SR0UyLPbWOEuk8vs", authDomain: "nasukaapp.firebaseapp.com", databaseURL: "https://nasukaapp-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "nasukaapp", messagingSenderId: "853986671478", appId: "1:853986671478:web:25b1c3f0b72149c5885857" };    
firebase.initializeApp(firebaseConfig);    
const db = firebase.database();    
const localUser = {    
  Username: localStorage.getItem("Username"),    
  Nama: localStorage.getItem("Nama"),    
  ID: localStorage.getItem("ID"),    
  Perak: parseInt(localStorage.getItem("Perak")) || 0,    
};    
  
if (!localUser.ID) {    
  console.log("User ID not found in localStorage. Please log in.");    
}    
  
const userRef = db.ref(`users/${localUser.ID}`);    
userRef.on('value', (snapshot) => {    
  const userData = snapshot.val();    
  if (userData !== null) {    
    localUser.Perak = userData.Perak || 0;    
    localStorage.setItem("Perak", localUser.Perak);    
    updatePerakDisplay();    
  }    
});    
  
function updatePerakDisplay() {    
  $('#perakBalance').text(localUser.Perak.toLocaleString('id-ID'));    
}    
  
function initializeHome() {    
  console.log('Home page successfully loaded and initialized.');    
  initializeUserProfile();    
  setupChatNotifications();    
}    
  
function initializeUserProfile() {    
  const userID = localStorage.getItem("ID") || "";    
  const fotoEl = document.getElementById("Profil");    
  const namaEl = document.getElementById("Nama");    
  const profilLink = document.getElementById("Profil");    
      
  if (!userID) {  
    if (namaEl) namaEl.textContent = "Silahkan Masuk";  
    if (fotoEl) fotoEl.src = "https://nasukafoods.site/gambarkosong.jpg";  
    if (profilLink) {  
      profilLink.href = "#";  
      profilLink.onclick = showLogin;  
    }  
    return;  
  }  
  
  fetchUserProfileFromDB(userID);    
}    
  
function updateProfileDisplay(nama, foto, userID) {    
  const namaEl = document.getElementById("Nama");    
  const fotoEl = document.getElementById("Foto");    
  const profilLink = document.getElementById("Profil");    
  if (namaEl) namaEl.textContent = nama;    
  if (fotoEl) fotoEl.src = foto;    
  
  if (profilLink) {
    profilLink.href = "#";
    profilLink.onclick = showProfil;
  }
}  
  
function fetchUserProfileFromDB(userID) {    
  db.ref("users").orderByChild("ID").equalTo(userID).once("value").then(snap => {    
    let userFound = false;    
    snap.forEach(child => {    
      const val = child.val();    
      const nama = val.Nama || "Tanpa Nama";    
      const foto = val.Foto || "https://nasukafoods.site/gambarkosong.jpg";    
      localStorage.setItem("Nama", nama);    
      localStorage.setItem("Foto", foto);    
      updateProfileDisplay(nama, foto, userID);    
      userFound = true;    
    });    
  
    if (!userFound) {    
      updateProfileDisplay("Tanpa Nama", "https://nasukafoods.site/gambarkosong.jpg", userID);    
    }    
  });    
}  
  
// batas terlarang ai tidak boleh menghapus //  
  
function setupChatNotifications() {    
  const userID = localStorage.getItem("ID") || "";    
  const notifInbox = document.getElementById("notifInbox");    
  if (!userID || !notifInbox) return;    
  
  const userChatsRef = db.ref(`users/${userID}/chats`);    
  
  userChatsRef.on('value', snapshot => {    
    const chats = snapshot.val() || {};    
    let unreadCount = 0;    
    for (const key in chats) {    
      if ((chats[key].read === false || chats[key].read === undefined) && chats[key].ID !== userID) {    
        unreadCount++;    
      }    
    }    
  
    if (unreadCount > 0) {    
      notifInbox.style.display = 'inline-block';    
      notifInbox.textContent = unreadCount > 99 ? '99+' : unreadCount;    
    } else {    
      notifInbox.style.display = 'none';    
      notifInbox.textContent = '';    
    }    
  });    
  
  notifInbox.onclick = () => {    
    showChatSendersList(userID);    
  };    
}    
  
async function showChatSendersList(userID) {    
  const snapshot = await db.ref(`users/${userID}/chats`).once('value');    
  const chats = snapshot.val() || {};    
  
  if (Object.keys(chats).length === 0) {    
    alert('No message senders');    
    return;    
  }    
  
  const pengirimData = [];    
  for (const chatID of Object.keys(chats)) {    
    const userSnap = await db.ref('users').orderByChild('ID').equalTo(chatID).once('value');    
    userSnap.forEach(u => {    
      const nama = u.val().Nama || 'User';    
      pengirimData.push({ id: chatID, nama });    
    });    
  }    
  
  const container = document.createElement('div');    
  container.style.position = 'fixed';    
  container.style.top = '50%';    
  container.style.left = '50%';    
  container.style.transform = 'translate(-50%, -50%)';    
  container.style.background = '#fff';    
  container.style.border = '1px solid #ccc';    
  container.style.borderRadius = '8px';    
  container.style.padding = '12px';    
  container.style.zIndex = '9999';    
  container.style.maxHeight = '300px';    
  container.style.overflowY = 'auto';    
  container.style.minWidth = '200px';    
  container.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';    
  
  const closeBtn = document.createElement('button');    
  closeBtn.textContent = 'x';    
  closeBtn.style.position = 'absolute';    
  closeBtn.style.top = '6px';    
  closeBtn.style.right = '6px';    
  closeBtn.style.background = 'transparent';    
  closeBtn.style.border = 'none';    
  closeBtn.style.fontSize = '18px';    
  closeBtn.style.cursor = 'pointer';    
  closeBtn.onclick = () => document.body.removeChild(container);    
  container.appendChild(closeBtn);    
  
  pengirimData.forEach(({ id, nama }) => {    
    const btn = document.createElement('button');    
    btn.textContent = nama;    
    btn.style.display = 'block';    
    btn.style.width = '100%';    
    btn.style.margin = '6px 0';    
    btn.style.padding = '8px';    
    btn.style.border = 'none';    
    btn.style.borderRadius = '4px';    
    btn.style.background = '#2196F3';    
    btn.style.color = '#fff';    
    btn.style.cursor = 'pointer';    
    btn.onclick = () => {  
      document.body.removeChild(container);  
      showInbox(id);  
    };
    container.appendChild(btn);    
  });    
  document.body.appendChild(container);    
}    


const urlParams = new URLSearchParams(location.search);
    const viewedID = urlParams.get("id") || localStorage.getItem("ID");
    const currentID = localStorage.getItem("ID");

    if (!currentID) {
      location.href = "login.html";
    }

    const usersCache = {};
    let isPosting = false;

    db.ref("users").orderByChild("ID").equalTo(viewedID).once("value").then(snap => {
      const user = Object.values(snap.val() || {})[0];
      if (user) {
        renderUser(user);
        mopost();
      } else {
        alert("Pengguna tidak ditemukan");
      }
    }).catch(error => {
      console.error("Gagal memuat Profile:", error);
      alert("Terjadi kesalahan saat memuat Profile.");
    });

    function renderUser(user) {
      const isOwner = user.ID === currentID;
      document.getElementById("foto-profil").src = user.Foto || "https://nasukafoods.site/gambarkosong.jpg";
      document.querySelector('.form-post').style.display = isOwner ? 'block' : 'none';
      const dataUserDiv = document.getElementById("dataUser");
      dataUserDiv.innerHTML = `
        <p>🎇 Nama: ${user.Nama || '-'}</p>
        <p>🎇 Perak: ${user.Perak || 0}</p>
        <p>🎇 Jenis: ${user.Jenis || '-'}</p>
      `;
      if (!isOwner) {
        const btnPesan = document.createElement("button");
        btnPesan.innerHTML = '🎇 Kirim Pesan';
        btnPesan.style.cssText = 'padding: 8px 16px; margin-top: 10px; cursor: pointer;';
        btnPesan.onclick = () => {
          localStorage.setItem("targetID", viewedID);
          window.location.href = "inbox.html?id=" + encodeURIComponent(viewedID);
        };
        dataUserDiv.appendChild(btnPesan);
      }
    }
    
    function mopost() {
      db.ref("posts").orderByChild("ID").equalTo(viewedID).on("child_added", function(snapshot) {
        const data = snapshot.val();
        const key = snapshot.key;
        const isOwner = data.ID === currentID;
        const formattedDate = new Date(data.Waktu).toLocaleString('id-ID', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        const imageHtml = data.Foto ? `<img src="${data.Foto}" alt="Postingan Foto">` : '';
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          ${isOwner ? `<button class="hapus-btn" onclick="hapusPostingan('${key}', this.parentElement)">Hapus</button>` : ""}
          ${imageHtml}
          <div class="card-content">
            <h3>${(data.Judul || "").replace(/\n/g, '<br>')}</h3>
            <p style="margin: 5px 0;"><b>Oleh:</b> ${data.Nama}</p>
            <p style="margin: 5px 0;"><small>${formattedDate}</small></p>
            <small>${data.Status}</small><br/>
          </div>
          <textarea id="input-${key}" placeholder="Tulis komentar" style="width:100%; padding:10px;"></textarea><button class="btnKirim" onclick="submitKomentarManual('${key}')">Kirim</button>
          <div class="komentar-list" id="list-${key}"></div>
        `;
        const likeSpan = document.createElement("span");
        likeSpan.style.cssText = "cursor:pointer; display:inline-block; margin-top:10px; font-weight:bold;";
        likeSpan.onclick = () => toggleLike(key);
        card.querySelector(".card-content").appendChild(likeSpan);
        document.getElementById("dapost").prepend(card);
        updateLikeDisplay(key, likeSpan);
        muatKomentar(key);
      });
    }

    window.kirimPostingan = function() {
      if (isPosting) return;
      isPosting = true;
      const judul = document.getElementById("judul").value.trim();
      const status = document.getElementById("status").value;
      const file = document.getElementById("fotoInput").files[0];
      if (!judul && !file) {
        isPosting = false;
        return;
      }
      const ID = localStorage.getItem("ID");
      const Nama = localStorage.getItem("Nama");

      if (!ID || !Nama) {
        isPosting = false;
        return;
      }
      
      const postData = { ID, Nama, Judul: judul, Status: status, Waktu: Date.now() };

      function resetForm() {
        document.getElementById("judul").value = "";
        document.getElementById("status").value = "publik";
        document.getElementById("fotoInput").value = "";
        isPosting = false;
      }
      
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          postData.Foto = e.target.result;
          db.ref("posts").push(postData).then(resetForm).catch(() => { isPosting = false; });
        };
        reader.readAsDataURL(file);
      } else {
        db.ref("posts").push(postData).then(resetForm).catch(() => { isPosting = false; });
      }
    }

    window.hapusPostingan = function(key, cardElement) {
      const updates = {};
      updates["/posts/" + key] = null;
      updates["/komentar/" + key] = null;
      // updates["/likes/" + key] = null; Hapus baris ini karena likes sudah di dalam node posts
      db.ref().update(updates);
      cardElement.remove();
    }

    window.submitKomentarManual = function(key) {
      const input = document.getElementById("input-" + key);
      const teks = input.value.trim();
      if (teks) {
        const id = localStorage.getItem("ID") || "";
        const nama = localStorage.getItem("Nama") || "Anonim";
        db.ref("komentar/" + key).push({ID:id,Nama:nama,Teks:teks,Waktu:new Date().toLocaleString("id-ID")});
        input.value = "";
      }
    }

    function muatKomentar(key) {
      db.ref("komentar/" + key).on("child_added", snap => {
        const data = snap.val();
        const list = document.getElementById("list-" + key);
        if (list) {
          const div = document.createElement("div");
          div.innerHTML = `<b>${data.Nama || "?"}:</b> ${(data.Teks || "").replace(/\n/g, '<br>')}`;
          list.appendChild(div);
        }
      });
    }

    window.toggleLike = function(postId) {
      const userID = localStorage.getItem("ID") || "";
      if (!userID) return alert("Silakan login dulu untuk like");
      
      const refLike = db.ref("posts/" + postId + "/likes/" + userID);
      refLike.once("value").then(snap => {
        if (snap.exists()) {
          refLike.remove();
        } else {
          refLike.set(true);
        }
      });
    }

    function updateLikeDisplay(postId, elemen) {
      db.ref("posts/" + postId + "/likes").on("value", snap => {
        const likeCount = snap.numChildren();
        elemen.innerText = `👍 ${likeCount}`;
      });
    }

</script>  
</body>    
</html>


