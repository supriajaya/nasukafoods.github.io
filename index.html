<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nasuka</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: black;
      color: white;
    }

    .hero-section {
      position: relative;
      height: 20vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding-top: 5vh;
    }

    .hero-section video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .promo-text {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 0 0 6px black;
      padding: 0 20px;
      z-index: 1;
    }

    .bottom-bar {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      font-size: 12px;
      z-index: 999;
    }

    .bottom-bar a {
      color: white;
      text-decoration: none;
      text-align: center;
      padding: 5px 10px;
    }

    .content-area {
      padding: 20px;
      margin-bottom: 50px;
      text-align: center;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
      justify-content: center;
    }

    .product-item {
      background-color: #333;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }

    .product-item img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 5px;
      margin-bottom: 8px;
    }

    .product-item h3 {
      font-size: 16px;
      margin: 0 0 5px 0;
    }

    .product-item p {
      font-size: 14px;
      color: #ccc;
      margin: 0;
    }

    .product-item .price {
      font-weight: bold;
      color: #ffbb00;
      margin-top: 5px;
    }

    .product-item button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 13px;
    }

    .product-item button:hover {
      background-color: #0056b3;
    }

    #paymentModal, #loginModal, #registerModal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.8);
      padding-top: 60px;
    }

    .modal-content {
      background-color: #222;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 500px;
      border-radius: 10px;
      position: relative;
    }

    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      position: absolute;
      top: 10px;
      right: 20px;
      cursor: pointer;
    }

    .close-button:hover,
    .close-button:focus {
      color: white;
      text-decoration: none;
      cursor: pointer;
    }

    .modal-content h2 {
      text-align: center;
      color: #ffbb00;
      margin-top: 0;
    }

    .modal-content label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .modal-content input[type="text"],
    .modal-content input[type="tel"],
    .modal-content input[type="password"],
    .modal-content select,
    .modal-content textarea,
    .modal-content input[type="file"],
    .modal-content input[type="email"] {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #555;
      background-color: #444;
      color: white;
    }

    .modal-content input[type="file"] {
      padding: 8px;
    }

    .modal-content button[type="submit"] {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    .modal-content button[type="submit"]:hover {
      background-color: #218838;
    }

    .product-display-in-modal {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      background-color: #3a3a3a;
      padding: 10px;
      border-radius: 5px;
    }

    .product-display-in-modal img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 5px;
      margin-right: 15px;
    }

    .product-details-in-modal {
      flex-grow: 1;
    }

    .product-details-in-modal h3 {
      margin: 0 0 5px 0;
      font-size: 18px;
    }

    .product-details-in-modal p {
      margin: 0;
      font-size: 16px;
      color: #ffbb00;
      font-weight: bold;
    }

    #orderHistorySection {
      display: none;
      padding: 20px;
      text-align: left;
    }

    #orderHistorySection h2 {
      text-align: center;
      color: #ffbb00;
      margin-bottom: 20px;
    }

    .order-item {
      background-color: #333;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .order-item img {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 5px;
    }

    .order-details {
      flex-grow: 1;
    }

    .order-details h4 {
      margin: 0 0 5px 0;
      font-size: 16px;
      color: white;
    }

    .order-details p {
      margin: 0;
      font-size: 13px;
      color: #ccc;
    }

    .order-details .status {
      font-weight: bold;
      color: #00ff00;
    }
  </style>
</head>
<body>

  <section class="hero-section" id="homeSection">
    <video src="https://nasukafoods.site/kawasakih2.mp4" autoplay muted loop playsinline></video>

    <div class="promo-text">
      Selamat Datang di Nasuka Labs<br />
      <strong>Jelajahi Produk Kami!</strong>
    </div>
  </section>

  <div class="content-area" id="productSection">
    <h2>Produk Terbaru</h2>
    <div class="product-grid">
      <div class="product-item">
        <img src="https://via.placeholder.com/150/0000FF/FFFFFF?text=Produk+1" alt="Produk 1">
        <h3>Nama Produk 1</h3>
        <p>Deskripsi singkat produk.</p>
        <div class="price" data-raw-price="150000">Rp 150.000</div>
        <button class="buy-button"
                data-product-name="Nama Produk 1"
                data-product-price="150000"
                data-product-image="https://via.placeholder.com/150/0000FF/FFFFFF?text=Produk+1">Beli Sekarang</button>
      </div>
      <div class="product-item">
        <img src="https://via.placeholder.com/150/FF0000/FFFFFF?text=Produk+2" alt="Produk 2">
        <h3>Nama Produk 2</h3>
        <p>Deskripsi singkat produk.</p>
        <div class="price" data-raw-price="250000">Rp 250.000</div>
        <button class="buy-button"
                data-product-name="Nama Produk 2"
                data-product-price="250000"
                data-product-image="https://via.placeholder.com/150/FF0000/FFFFFF?text=Produk+2">Beli Sekarang</button>
      </div>
      <div class="product-item">
        <img src="https://via.placeholder.com/150/00FF00/FFFFFF?text=Produk+3" alt="Produk 3">
        <h3>Nama Produk 3</h3>
        <p>Deskripsi singkat produk.</p>
        <div class="price" data-raw-price="100000">Rp 100.000</div>
        <button class="buy-button"
                data-product-name="Nama Produk 3"
                data-product-price="100000"
                data-product-image="https://via.placeholder.com/150/00FF00/FFFFFF?text=Produk+3">Beli Sekarang</button>
      </div>
    </div>
  </div>

  <div id="orderHistorySection">
    <h2>Riwayat Pesanan Anda</h2>
    <div id="orderList">
      <p style="text-align: center; color: #aaa;" id="noOrdersMessage">Belum ada pesanan.</p>
    </div>
  </div>

  <div class="bottom-bar">
    <a href="#home" id="navHome">üè†<br>Beranda</a>
    <a href="#order-history" id="navOrderHistory">‚ûï<br>Riwayat Pesanan</a>

    <a href="#" id="navLogin" class="logged-out-nav">‚û°Ô∏è<br>Masuk</a>
    <a href="#" id="navRegister" class="logged-out-nav">üìù<br>Daftar</a>

    <a href="#benefit" id="navBenefit" class="logged-in-nav" style="display:none;">üéÅ<br>Benefit</a>
    <a href="#notif" id="navNotif" class="logged-in-nav" style="display:none;">üîî<br>Notif</a>
    <a href="https://nasukafoods.site/profil.html" id="navProfile" class="logged-in-nav" style="display:none;">üë§<br>Profil</a>
  </div>

  <div id="paymentModal" class="modal">
    <div class="modal-content">
      <span class="close-button payment-close-button">&times;</span>
      <h2>Detail Pesanan & Pembayaran</h2>

      <div class="product-display-in-modal">
        <img id="modalProductImage" src="" alt="Foto Produk">
        <div class="product-details-in-modal">
          <h3><span id="modalProductName"></span></h3>
          <p>Total: <span id="modalProductPrice"></span></p>
        </div>
      </div>

      <form id="guestPaymentForm">
        <input type="hidden" id="hiddenProductName" name="Produk">
        <input type="hidden" id="hiddenProductPrice" name="Total Harga">
        <input type="hidden" id="hiddenProductImage" name="Gambar Produk">


        <label for="guestName">Nama Lengkap:</label>
        <input type="text" id="guestName" name="Nama" placeholder="Masukkan nama lengkap" required>

        <label for="guestAddress">Alamat Lengkap:</label>
        <textarea id="guestAddress" name="Alamat" placeholder="Masukkan alamat lengkap" rows="3" required></textarea>

        <label for="guestPhone">Nomor HP:</label>
        <input type="tel" id="guestPhone" name="Nomor HP" placeholder="Contoh: 081234567890" required>

        <label for="guestSocialMedia">Media Sosial (Opsional):</label>
        <input type="text" id="guestSocialMedia" name="Media Sosial" placeholder="Contoh: @username_ig">

        <label for="paymentMethod">Metode Pembayaran:</label>
        <select id="paymentMethod" name="Metode Pembayaran" required>
          <option value="">Pilih Metode</option>
          <option value="Transfer Bank">Transfer Bank</option>
          <option value="E-Wallet">E-Wallet</option>
          </select>

        <label for="proofOfPayment">Kirim Bukti Pembayaran:</label>
        <input type="file" id="proofOfPayment" name="Bukti Pembayaran" accept="image/*" required>
        <small style="color:#aaa; display:block; margin-top:-10px; margin-bottom:15px;">Unggah foto bukti transfer/pembayaran.</small>


        <button type="submit" id="submitOrderButton">Konfirmasi Pesanan</button>
      </form>
    </div>
  </div>

  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close-button login-close-button">&times;</span>
      <h2>Masuk ke Akun Anda</h2>
      <form id="loginForm">
        <label for="loginUsername">Username:</label>
        <input type="text" id="loginUsername" name="username" placeholder="Masukkan username Anda" required>

        <label for="loginPassword">Password:</label>
        <input type="password" id="loginPassword" name="password" placeholder="Masukkan password Anda" required>

        <button type="submit" id="submitLoginButton">Login</button>
      </form>
    </div>
  </div>

  <div id="registerModal" class="modal">
    <div class="modal-content">
      <span class="close-button register-close-button">&times;</span>
      <h2>Daftar Akun Baru</h2>
      <form id="registerForm">
        <label for="regName">Nama Lengkap:</label>
        <input type="text" id="regName" name="Nama" placeholder="Masukkan nama lengkap Anda" required>

        <label for="regAddress">Alamat Lengkap:</label>
        <textarea id="regAddress" name="Alamat" placeholder="Masukkan alamat lengkap Anda" rows="2" required></textarea>

        <label for="regPhone">Nomor HP:</label>
        <input type="tel" id="regPhone" name="Nomor HP" placeholder="Contoh: 081234567890" required>

        <label for="regSocialMedia">Media Sosial (Opsional):</label>
        <input type="text" id="regSocialMedia" name="Sosial Media" placeholder="Contoh: @username_ig">

        <label for="regUsername">Username:</label>
        <input type="text" id="regUsername" name="Username" placeholder="Buat username" required>

        <label for="regPassword">Password:</label>
        <input type="password" id="regPassword" name="Password" placeholder="Buat password" required>

        <button type="submit" id="submitRegisterButton">Daftar Sekarang</button>
      </form>
    </div>
  </div>

  <script>
    const paymentModal = document.getElementById("paymentModal");
    const loginModal = document.getElementById("loginModal");
    const registerModal = document.getElementById("registerModal");

    const paymentCloseButton = document.getElementsByClassName("payment-close-button")[0];
    const loginCloseButton = document.getElementsByClassName("login-close-button")[0];
    const registerCloseButton = document.getElementsByClassName("register-close-button")[0];

    const modalProductImage = document.getElementById("modalProductImage");
    const modalProductNameDisplay = document.getElementById("modalProductName");
    const modalProductPriceDisplay = document.getElementById("modalProductPrice");

    const hiddenProductNameInput = document.getElementById("hiddenProductName");
    const hiddenProductPriceInput = document.getElementById("hiddenProductPrice");
    const hiddenProductImageInput = document.getElementById("hiddenProductImage");

    const guestPaymentForm = document.getElementById('guestPaymentForm');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const orderListDiv = document.getElementById('orderList');
    const noOrdersMessage = document.getElementById('noOrdersMessage');
    const submitOrderButton = document.getElementById('submitOrderButton');
    const submitLoginButton = document.getElementById('submitLoginButton');
    const submitRegisterButton = document.getElementById('submitRegisterButton');

    const homeSection = document.getElementById('homeSection');
    const productSection = document.getElementById('productSection');
    const orderHistorySection = document.getElementById('orderHistorySection');

    const navLogin = document.getElementById('navLogin');
    const navRegister = document.getElementById('navRegister');
    const navBenefit = document.getElementById('navBenefit');
    const navNotif = document.getElementById('navNotif');
    const navProfile = document.getElementById('navProfile');

    // URL Apps Script Anda yang sudah diperbarui
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzZ-BSqSdaMcMrTZQqofVXw2dwIoYqddG5VzYe8Wz81GvCwvt1rnujzigzHBNo5hXZ5/exec';


    function showSection(sectionId) {
        homeSection.style.display = 'none';
        productSection.style.display = 'none';
        orderHistorySection.style.display = 'none';

        if (sectionId === 'home') {
            homeSection.style.display = 'flex';
            productSection.style.display = 'block';
        } else if (sectionId === 'order-history') {
            orderHistorySection.style.display = 'block';
            loadOrderHistory();
        }
    }

    function updateNavigation() {
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';

        if (isLoggedIn) {
            navLogin.style.display = 'none';
            navRegister.style.display = 'none';
            navBenefit.style.display = 'block';
            navNotif.style.display = 'block';
            navProfile.style.display = 'block';
        } else {
            navLogin.style.display = 'block';
            navRegister.style.display = 'block';
            navBenefit.style.display = 'none';
            navNotif.style.display = 'none';
            navProfile.style.display = 'none';
        }
    }

    document.getElementById('navHome').addEventListener('click', function(e) {
        e.preventDefault();
        showSection('home');
    });

    document.getElementById('navOrderHistory').addEventListener('click', function(e) {
        e.preventDefault();
        showSection('order-history');
    });

    document.getElementById('navLogin').addEventListener('click', function(e) {
        e.preventDefault();
        loginModal.style.display = "block";
    });

    document.getElementById('navRegister').addEventListener('click', function(e) {
        e.preventDefault();
        registerModal.style.display = "block";
    });

    navBenefit.addEventListener('click', function(e) {
        e.preventDefault();
        alert('Halaman Benefit akan datang!');
    });

    navNotif.addEventListener('click', function(e) {
        e.preventDefault();
        alert('Halaman Notifikasi akan datang!');
    });

    updateNavigation();
    showSection('home');

    document.querySelectorAll('.buy-button').forEach(button => {
      button.addEventListener('click', function() {
        const productName = this.dataset.productName;
        const productPrice = parseFloat(this.dataset.productPrice);
        const productImage = this.dataset.productImage;

        modalProductImage.src = productImage;
        modalProductNameDisplay.textContent = productName;
        modalProductPriceDisplay.textContent = "Rp " + productPrice.toLocaleString('id-ID');

        hiddenProductNameInput.value = productName;
        hiddenProductPriceInput.value = productPrice;
        hiddenProductImageInput.value = productImage;

        paymentModal.style.display = "block";
      });
    });

    paymentCloseButton.onclick = function() {
      paymentModal.style.display = "none";
    }

    loginCloseButton.onclick = function() {
      loginModal.style.display = "none";
    }

    registerCloseButton.onclick = function() {
      registerModal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == paymentModal) {
        paymentModal.style.display = "none";
      }
      if (event.target == loginModal) {
        loginModal.style.display = "none";
      }
      if (event.target == registerModal) {
        registerModal.style.display = "none";
      }
    }

    guestPaymentForm.addEventListener('submit', function(event) {
      event.preventDefault();

      submitOrderButton.disabled = true;
      submitOrderButton.textContent = 'Memproses...';

      const formData = new FormData(this);
      const data = { action: 'processGuestOrder' };
      let fileData = null;

      const readerPromises = [];

      for (let [key, value] of formData.entries()) {
        if (key === 'Bukti Pembayaran' && value instanceof File) {
            readerPromises.push(new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fileData = {
                        fileName: value.name,
                        mimeType: value.type,
                        data: e.target.result.split(',')[1]
                    };
                    resolve();
                };
                reader.readAsDataURL(value);
            }));
        } else {
            data[key] = value;
        }
      }

      Promise.all(readerPromises).then(() => {
        if (fileData) {
            data['Bukti Pembayaran'] = fileData;
        }
        sendDataToGAS(data, submitOrderButton, 'Konfirmasi Pesanan');
      }).catch(error => {
          console.error("Error reading file:", error);
          alert("Gagal membaca file bukti pembayaran.");
          submitOrderButton.disabled = false;
          submitOrderButton.textContent = 'Konfirmasi Pesanan';
      });
    });

    async function sendDataToGAS(dataToSend, buttonElement, originalButtonText) {
      // --- Revisi: Tambahan untuk debugging ---
      console.log('Data yang akan dikirim ke GAS:', dataToSend);
      console.log('Body JSON yang akan dikirim:', JSON.stringify(dataToSend));
      // --- Akhir revisi debugging ---

      try {
        const response = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(dataToSend)
        });
        const result = await response.json();

        buttonElement.disabled = false;
        buttonElement.textContent = originalButtonText;

        if (result.success) {
          if (dataToSend.action === 'processGuestOrder') {
            alert('Pesanan Anda berhasil dibuat! ' + result.message);
            const orderData = {};
            for (const key in dataToSend) {
                orderData[key] = dataToSend[key];
            }
            orderData['ID Orders'] = result.orderId;
            orderData['Tanggal'] = new Date().toLocaleString('id-ID');
            orderData['Status Pesanan'] = 'Menunggu Konfirmasi';
            orderData['Gambar Produk'] = hiddenProductImageInput.value;

            const existingOrders = JSON.parse(localStorage.getItem('guestOrders')) || [];
            existingOrders.push(orderData);
            localStorage.setItem('guestOrders', JSON.stringify(existingOrders));

            guestPaymentForm.reset();
            paymentModal.style.display = "none";
            showSection('order-history');
          } else if (dataToSend.action === 'loginUser') {
            alert('Login berhasil! Selamat datang, ' + result.username);
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('loggedInUsername', result.username);
            loginModal.style.display = "none";
            updateNavigation();
          } else if (dataToSend.action === 'registerUser') {
            alert('Pendaftaran berhasil! Silakan login. ' + result.message);
            registerForm.reset();
            registerModal.style.display = "none";
            loginModal.style.display = "block";
          }
        } else {
          alert(dataToSend.action.includes('Order') ? 'Gagal membuat pesanan: ' + result.message :
                dataToSend.action === 'loginUser' ? 'Login gagal: ' + result.message :
                'Pendaftaran gagal: ' + result.message);
        }
      } catch (error) {
        buttonElement.disabled = false;
        buttonElement.textContent = originalButtonText;
        alert('Terjadi kesalahan saat menghubungi server: ' + error.message);
        console.error('GAS Error (frontend catch block):', error); // Ubah log ini agar lebih spesifik
      }
    }

    loginForm.addEventListener('submit', function(event) {
        event.preventDefault();

        submitLoginButton.disabled = true;
        submitLoginButton.textContent = 'Memproses...';

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());
        data.action = 'loginUser';

        sendDataToGAS(data, submitLoginButton, 'Login');
    });

    registerForm.addEventListener('submit', function(event) {
        event.preventDefault();

        submitRegisterButton.disabled = true;
        submitRegisterButton.textContent = 'Memproses...';

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());
        data.action = 'registerUser';

        sendDataToGAS(data, submitRegisterButton, 'Daftar Sekarang');
    });


    function loadOrderHistory() {
        const orders = JSON.parse(localStorage.getItem('guestOrders')) || [];
        orderListDiv.innerHTML = '';

        if (orders.length === 0) {
            noOrdersMessage.style.display = 'block';
        } else {
            noOrdersMessage.style.display = 'none';
            orders.reverse().forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.classList.add('order-item');
                orderItem.innerHTML = `
                    <img src="${order['Gambar Produk']}" alt="${order['Produk']}">
                    <div class="order-details">
                        <h4>${order['Produk']} - Rp${parseFloat(order['Total Harga']).toLocaleString('id-ID')}</h4>
                        <p>ID Pesanan: ${order['ID Orders']}</p>
                        <p>Tanggal: ${order['Tanggal']}</p>
                        <p>Nama: ${order['Nama']}</p>
                        <p>Status: <span class="status">${order['Status Pesanan']}</span></p>
                    </div>
                `;
                orderListDiv.appendChild(orderItem);
            });
        }
    }

    loadOrderHistory();

  </script>
</body>
</html>
