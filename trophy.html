<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leaderboard Podium Sultan</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: url('https://nasukafoods.site/kempangapi.gif') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      margin: 0;
      padding: 20px 10px;
      text-align: center;
    }
    h1 {
      font-size: 26px;
      margin-bottom: 40px;
      text-shadow: 1px 1px 4px #000;
    }
    .podium {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 15px;
      margin-bottom: 50px;
      flex-wrap: wrap;
    }
    .step {
      position: relative;
      width: 90px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      border-radius: 10px 10px 0 0;
      box-shadow: inset 0 2px 5px rgba(255,255,255,0.1),
                  0 0 15px rgba(255,255,255,0.15);
      padding-top: 60px;
      box-sizing: border-box;
    }
    .step .photo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #fff;
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 0 8px rgba(255,255,255,0.3);
    }
    .step h2 {
      font-size: 14px;
      margin: 10px 0 5px;
    }
    .step p {
      font-size: 13px;
      margin: 2px 0;
      padding: 0 4px;
    }

    .first {
      height: 160px;
      background: linear-gradient(to top, #FFD700, #fff9c4);
    }
    .second {
      height: 130px;
      background: linear-gradient(to top, #C0C0C0, #e0e0e0);
    }
    .third {
      height: 110px;
      background: linear-gradient(to top, #cd7f32, #ffcc99);
    }

    .others {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    .others .person {
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 14px;
      border-radius: 12px;
      max-width: 400px;
      width: 95%;
      display: flex;
      align-items: center;
      gap: 12px;
      text-align: left;
      box-shadow: 0 0 5px rgba(255,255,255,0.1);
    }
    .others .person img {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #555;
    }

    @media (max-width: 600px) {
      .step {
        width: 70px;
        padding-top: 50px;
      }
      .step .photo {
        width: 50px;
        height: 50px;
        top: -25px;
      }
      .step h2, .step p {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <h1>Top 3 Sultan</h1>
  <div class="podium">
    <div class="step second" id="podium-2">
      <img class="photo" src="" alt="">
      <h2>High</h2>
      <p class="name">-</p>
      <p class="poin">0 Poin</p>
    </div>
    <div class="step first" id="podium-1">
      <img class="photo" src="" alt="">
      <h2>King</h2>
      <p class="name">-</p>
      <p class="poin">0 Poin</p>
    </div>
    <div class="step third" id="podium-3">
      <img class="photo" src="" alt="">
      <h2>Mentri</h2>
      <p class="name">-</p>
      <p class="poin">0 Poin</p>
    </div>
  </div>
  <div class="others"></div>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbwL9L9lI4GViVClRwcGN4dg2iyqhN_bPGnuwFL5v1Q_UMp5uZqdbQJmy9LIYwG81Dqy/exec';

    document.addEventListener('DOMContentLoaded', () => {
      fetch(`${GAS_URL}?action=leaderboard`)
        .then(res => res.json())
        .then(data => {
          const formatted = data.map(d => ({
            nama: d.nama,
            poin: Math.floor((parseFloat(d.total) || 0) / 1000),
            foto: d.foto || 'https://via.placeholder.com/70'
          }));
          isiLeaderboard(formatted);
        })
        .catch(err => {
          console.error('Gagal memuat leaderboard:', err);
        });
    });

    function isiLeaderboard(data) {
      const urutanPodiumIds = ['podium-1', 'podium-2', 'podium-3'];
      const podiumMapping = {
        'podium-1': data[0],
        'podium-2': data[1],
        'podium-3': data[2]
      };
      urutanPodiumIds.forEach(id => {
        const el = document.getElementById(id);
        const peserta = podiumMapping[id];
        if (el && peserta) {
          el.style.display = 'flex';
          el.querySelector('.photo').src = peserta.foto;
          el.querySelector('.photo').alt = peserta.nama;
          el.querySelector('.name').textContent = peserta.nama;
          el.querySelector('.poin').textContent = `${peserta.poin} Poin`;
        } else if (el) {
          el.style.display = 'none';
        }
      });

      const othersContainer = document.querySelector('.others');
      othersContainer.innerHTML = '';
      for (let i = 3; i < data.length; i++) {
        const p = data[i];
        const div = document.createElement('div');
        div.classList.add('person');
        div.innerHTML = `
          <img src="${p.foto}" alt="${p.nama}">
          <div>
            <strong>${p.nama}</strong><br>
            <span>${p.poin} Poin</span>
          </div>
        `;
        othersContainer.appendChild(div);
      }
    }
  </script>
</body>
</html>
